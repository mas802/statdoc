<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<!-- Generated by statdoc (version v0.9.2-beta) on 2015-09-18 03:37:04 -->
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<title>base</title>
<meta name="date" content="2015-09-18">
<script src="../d3.min.js"></script>
<script src="../statdoc.js"></script>
</head>
<body>

<!-- ========= START OF TOP NAVBAR ========= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/a_adopath.ado.html" title="a/adopath.ado">Prev</a>	
	</li>
<li>
    <a href="../files/a_adoupdate.dlg.html" title="a/adoupdate.dlg">Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../compare.html?files/a_adoupdate.ado.html" target="_top">Compare</a></li>
<li><a href="../index.html?files/a_adoupdate.ado.html" target="_top">Frames</a></li>
<li><a href="../files/a_adoupdate.ado.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= --><!-- ======== START OF FILE DATA ======== -->
<div class="header">
<div class="subTitle">base</div>
<h2 title="Statdoc File adoupdate.ado" class="title">File adoupdate.ado</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>
<table border="0" style="border-collapse: collapse;table-layout: auto;width: auto;">
  <colgroup>
    <col span="1" width="200px">
    <col width="10px" style="text-align:center;">
    <col width="200px">
    <col width="10px" style="text-align:center;">
    <col span="1" width="200px">
  </colgroup>
<tr class="inheritance">
<td style="border: none;"></td>
<td style="text-align:center;background: #eeeeee;">&rarr;</td>
<td  style="background: #eeeeee;">
<span style="background: #eeeeee;"><b>a/adoupdate.ado</b></span>
</td>
<td style="text-align:center;background: #eeeeee;">&#8600;</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>

<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><span class="strong">a/adoupdate.ado <a href="../a/adoupdate.ado">open</a></span>
file:script:ado</pre>
</li>
</ul>

</div>
<ul class="blockList">
<li class="blockList">
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">date</td>
  <td class="colLast">Fri Jun 17 07:37:02 AEST 2011</td>
  </tr>
    </tbody>
  </table>
</li>
</ul>




<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Variable Summary table, listing datasets and labels">
<caption><span><a name="variables"><!-- --></a>All commands</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" style="width:30px" scope="col">#</th>
<th class="colLast" width="100%" scope="col">content
<!-- <span style="float: right;">&nbsp;<a title="Raw Source" onclick="toggle('rawframe');setIframeHeight('rawframe');">raw</a> -->
</th>
<!--
<td style="display:none;" id="rawframe" rowspan="92" height="100%">
<iframe scrolling="yes" width="600px" height="100%" src="../files/a_adoupdate.ado.html#content" name="statdocSubFrame_raw" title="Raw File" style="height: 100%; width: 600px; overflow-x:scroll; overflow-y:scroll; -ms-overflow-x:scroll; -ms-overflow-y:scroll;"></iframe>
</td>
-->
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *! version 1.1.0  09jun2011</div></td>
</tr>
<tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="2" title="program"><!-- -->
    2</a>&nbsp;<a onclick='toggle("cmd_510097547");' title="program">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">program</span>
  <span class="cmdparameters"><a href="../tokens/a.html#adoupdate">adoupdate</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#rclass">rclass</a></span>
<div id="cmd_510097547" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">*! version 1.1.0  09jun2011
program adoupdate, rclass</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">program</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#rclass">rclass</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/a.html#adoupdate">adoupdate</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="3" title="version"><!-- -->
    3</a>&nbsp;<a onclick='toggle("cmd_1905864697");' title="version">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">version</span>
  <span class="cmdparameters">9</span>
<div id="cmd_1905864697" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	version 9</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">version</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">9</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="5" title="syntax"><!-- -->
    5</a>&nbsp;<a onclick='toggle("cmd_-2042745038");' title="syntax">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">syntax</span>
  <span class="cmdparameters">[<a href="../tokens/a.html#anything">anything(</a><a href="../tokens/n.html#name">name</a>=<a href="../tokens/p.html#pkglist">pkglist</a> <a href="../tokens/i.html#id">id</a>="<a href="../tokens/p.html#package">package</a> <a href="../tokens/l.html#list">list</a>")] [, 	///
		<a href="../tokens/a.html#ALL">ALL</a>			///
		<a href="../files/a_adoupdate.ado.html#5">DIR(</a><a href="../tokens/s.html#string">string</a>)		///
		<a href="../files/a_adoupdate.ado.html#5">SSConly</a> 		///
		<a href="../tokens/u.html#UPDATE">UPDATE</a>			///
		<a href="../tokens/v.html#VERBOSE">VERBOSE</a>			///
	       ]</span>
<div id="cmd_-2042745038" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	syntax [anything(name=pkglist id="package list")] [, 	///
		ALL			///
		DIR(string)		///
		SSConly 		///
		UPDATE			///
		VERBOSE			///
	       ]</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">syntax</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">[<a href="../tokens/a.html#anything">anything(</a><a href="../tokens/n.html#name">name</a>=<a href="../tokens/p.html#pkglist">pkglist</a> <a href="../tokens/i.html#id">id</a>="<a href="../tokens/p.html#package">package</a> <a href="../tokens/l.html#list">list</a>")] [, 	///
		<a href="../tokens/a.html#ALL">ALL</a>			///
		<a href="../files/a_adoupdate.ado.html#5">DIR(</a><a href="../tokens/s.html#string">string</a>)		///
		<a href="../files/a_adoupdate.ado.html#5">SSConly</a> 		///
		<a href="../tokens/u.html#UPDATE">UPDATE</a>			///
		<a href="../tokens/v.html#VERBOSE">VERBOSE</a>			///
	       ]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="13" title="local"><!-- -->
    13</a>&nbsp;<a onclick='toggle("cmd_-1163684390");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/u.html#upd">upd</a>      = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/u.html#update">`update'</a>"=="", 0, 1)</span>
<div id="cmd_-1163684390" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local upd      = cond("`update'"=="", 0, 1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/u.html#upd">upd</a>      = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/u.html#update">`update'</a>"=="", 0, 1)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="14" title="local"><!-- -->
    14</a>&nbsp;<a onclick='toggle("cmd_-1660823146");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/b.html#bos">bos</a>      = <a href="../tokens/c.html#cond">cond(</a>"<a href="../files/a_adoupdate.ado.html#14">`ssconly'</a>"=="", 0, 1)</span>
<div id="cmd_-1660823146" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local bos      = cond("`ssconly'"=="", 0, 1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/b.html#bos">bos</a>      = <a href="../tokens/c.html#cond">cond(</a>"<a href="../files/a_adoupdate.ado.html#14">`ssconly'</a>"=="", 0, 1)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="15" title="local"><!-- -->
    15</a>&nbsp;<a onclick='toggle("cmd_-1322340825");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/n.html#notall">notall</a>   = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/a.html#all">`all'</a>"=="", 1, 0)</span>
<div id="cmd_-1322340825" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local notall   = cond("`all'"=="", 1, 0)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/n.html#notall">notall</a>   = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/a.html#all">`all'</a>"=="", 1, 0)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="16" title="local"><!-- -->
    16</a>&nbsp;<a onclick='toggle("cmd_1605553932");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/n.html#noisily">noisily</a>  = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/v.html#verbose">`verbose'</a>"=="", 0, 1)</span>
<div id="cmd_1605553932" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local noisily  = cond("`verbose'"=="", 0, 1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/n.html#noisily">noisily</a>  = <a href="../tokens/c.html#cond">cond(</a>"<a href="../tokens/v.html#verbose">`verbose'</a>"=="", 0, 1)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="18" title="set"><!-- -->
    18</a>&nbsp;<a onclick='toggle("cmd_1106126303");' title="set">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">set</span>
  <span class="cmdparameters"><a href="../tokens/m.html#more">more</a> <a href="../tokens/o.html#off">off</a></span>
<div id="cmd_1106126303" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	set more off</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">set</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/m.html#more">more</a> <a href="../tokens/o.html#off">off</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="19" title="pkg_chk_and_update("`dir'","><!-- -->
    19</a>&nbsp;<a onclick='toggle("cmd_1815888165");' title="pkg_chk_and_update("`dir'",">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdprefix"><a href="../tokens/m.html#mata">mata</a>:</span>
 <span class="cmdcommand">pkg_chk_and_update("`dir'",</span>
  <span class="cmdparameters"> "<a href="../tokens/p.html#pkglist">`pkglist'</a>", ///
			<a href="../tokens/u.html#upd">`upd'</a>, <a href="../tokens/b.html#bos">`bos'</a>, <a href="../tokens/n.html#notall">`notall'</a>, <a href="../tokens/n.html#noisily">`noisily'</a>)</span>
<div id="cmd_1815888165" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	mata: pkg_chk_and_update("`dir'", "`pkglist'", ///
			`upd', `bos', `notall', `noisily')</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">pkg_chk_and_update("`dir'",</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"> "<a href="../tokens/p.html#pkglist">`pkglist'</a>", ///
			<a href="../tokens/u.html#upd">`upd'</a>, <a href="../tokens/b.html#bos">`bos'</a>, <a href="../tokens/n.html#notall">`notall'</a>, <a href="../tokens/n.html#noisily">`noisily'</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">prefix</td>
  <td class="colLast"><a href="../tokens/m.html#mata">mata</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="21" title="return"><!-- -->
    21</a>&nbsp;<a onclick='toggle("cmd_-1030695060");' title="return">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">return</span>
  <span class="cmdparameters"><a href="../tokens/l.html#local">local</a> <a href="../tokens/p.html#pkglist">pkglist</a> "<a href="../tokens/p.html#pkglist">`pkglist'</a>"</span>
<div id="cmd_-1030695060" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	return local pkglist "`pkglist'"</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">return</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/l.html#local">local</a> <a href="../tokens/p.html#pkglist">pkglist</a> "<a href="../tokens/p.html#pkglist">`pkglist'</a>"</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="22" title="end"><!-- -->
    22</a>&nbsp;<a onclick='toggle("cmd_1011299887");' title="end">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">end</span>
  <span class="cmdparameters"></span>
<div id="cmd_1011299887" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">end</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">end</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_comment rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="25" title="comment"><!-- -->
    25</a>&nbsp;<a onclick='toggle("cmd_1597801759");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
  <span class="cmdcomment">
/* ==================================================================== */</span>
<div id="cmd_1597801759" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* ==================================================================== */</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">
/* ==================================================================== */</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="27" title="version"><!-- -->
    27</a>&nbsp;<a onclick='toggle("cmd_213356568");' title="version">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">version</span>
  <span class="cmdparameters">9</span>
<div id="cmd_213356568" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">version 9</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">version</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">9</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="29" title="local"><!-- -->
    29</a>&nbsp;<a onclick='toggle("cmd_1673590057");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/c.html#CMDNAME">CMDNAME</a>		<a href="../tokens/a.html#adoupdate">adoupdate</a></span>
<div id="cmd_1673590057" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local CMDNAME		adoupdate</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#CMDNAME">CMDNAME</a>		<a href="../tokens/a.html#adoupdate">adoupdate</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="30" title="local"><!-- -->
    30</a>&nbsp;<a onclick='toggle("cmd_-1985245317");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#30">DEFAULT_DIR</a>	"<a href="../tokens/p.html#PLUS">PLUS</a>"</span>
<div id="cmd_-1985245317" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local DEFAULT_DIR	"PLUS"</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#30">DEFAULT_DIR</a>	"<a href="../tokens/p.html#PLUS">PLUS</a>"</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="32" title="local"><!-- -->
    32</a>&nbsp;<a onclick='toggle("cmd_1926573667");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#32">SJupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</span>
  <span class="cmdcomment">//www.stata-journal.com/software/filelist.php""'</span>
<div id="cmd_1926573667" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local SJupfile		`""http://www.stata-journal.com/software/filelist.php""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">//www.stata-journal.com/software/filelist.php""'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#32">SJupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="33" title="local"><!-- -->
    33</a>&nbsp;<a onclick='toggle("cmd_826776622");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#33">SJbasesrc</a>		`""<a href="../tokens/h.html#http">http</a>:</span>
  <span class="cmdcomment">//www.stata-journal.com/software/""'</span>
<div id="cmd_826776622" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local SJbasesrc		`""http://www.stata-journal.com/software/""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">//www.stata-journal.com/software/""'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#33">SJbasesrc</a>		`""<a href="../tokens/h.html#http">http</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="34" title="local"><!-- -->
    34</a>&nbsp;<a onclick='toggle("cmd_1960408341");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#34">STBupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</span>
  <span class="cmdcomment">//www.stata.com/stb/filelist.php""'</span>
<div id="cmd_1960408341" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local STBupfile		`""http://www.stata.com/stb/filelist.php""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">//www.stata.com/stb/filelist.php""'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#34">STBupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="35" title="local"><!-- -->
    35</a>&nbsp;<a onclick='toggle("cmd_1888567747");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#35">STBbasesrc</a>	`""<a href="../tokens/h.html#http">http</a>:</span>
  <span class="cmdcomment">//www.stata.com/stb/""'</span>
<div id="cmd_1888567747" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local STBbasesrc	`""http://www.stata.com/stb/""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">//www.stata.com/stb/""'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#35">STBbasesrc</a>	`""<a href="../tokens/h.html#http">http</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="36" title="local"><!-- -->
    36</a>&nbsp;<a onclick='toggle("cmd_849276829");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#36">SSCupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</span>
  <span class="cmdcomment">//repec.org/docs/sscDD.php""'</span>
<div id="cmd_849276829" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local SSCupfile		`""http://repec.org/docs/sscDD.php""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">//repec.org/docs/sscDD.php""'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#36">SSCupfile</a>		`""<a href="../tokens/h.html#http">http</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="38" title="local"><!-- -->
    38</a>&nbsp;<a onclick='toggle("cmd_-1533385782");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#38">NEGRC_NORESPONSE</a>	(-677)</span>
<div id="cmd_-1533385782" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local NEGRC_NORESPONSE	(-677)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#38">NEGRC_NORESPONSE</a>	(-677)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="39" title="local"><!-- -->
    39</a>&nbsp;<a onclick='toggle("cmd_779026447");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#39">NEGRC_NOHOST</a>	(-631)</span>
<div id="cmd_779026447" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local NEGRC_NOHOST	(-631)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#39">NEGRC_NOHOST</a>	(-631)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="40" title="local"><!-- -->
    40</a>&nbsp;<a onclick='toggle("cmd_1481854299");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#40">NEGRC_NOFILE</a>	(-601)</span>
<div id="cmd_1481854299" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local NEGRC_NOFILE	(-601)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#40">NEGRC_NOFILE</a>	(-601)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="43" title="local"><!-- -->
    43</a>&nbsp;<a onclick='toggle("cmd_123277378");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/b.html#boolean">boolean</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></span>
<div id="cmd_123277378" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local boolean		real scalar</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/b.html#boolean">boolean</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="45" title="local"><!-- -->
    45</a>&nbsp;<a onclick='toggle("cmd_-1658163077");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/i.html#instpkg">instpkg</a>		<a href="../tokens/s.html#string">string</a> <a href="../tokens/c.html#colvector">colvector</a></span>
<div id="cmd_-1658163077" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local instpkg		string colvector</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/i.html#instpkg">instpkg</a>		<a href="../tokens/s.html#string">string</a> <a href="../tokens/c.html#colvector">colvector</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="46" title="local"><!-- -->
    46</a>&nbsp;<a onclick='toggle("cmd_-872019330");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/i.html#instlist">instlist</a>		<a href="../tokens/p.html#pointer">pointer(</a><a href="../tokens/i.html#instpkg">`instpkg'</a>) <a href="../tokens/c.html#colvector">colvector</a></span>
<div id="cmd_-872019330" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local instlist		pointer(`instpkg') colvector</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/i.html#instlist">instlist</a>		<a href="../tokens/p.html#pointer">pointer(</a><a href="../tokens/i.html#instpkg">`instpkg'</a>) <a href="../tokens/c.html#colvector">colvector</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="47" title="local"><!-- -->
    47</a>&nbsp;<a onclick='toggle("cmd_-1003009117");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#47">EL_relno</a>		1</span>
<div id="cmd_-1003009117" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local EL_relno		1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#47">EL_relno</a>		1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="48" title="local"><!-- -->
    48</a>&nbsp;<a onclick='toggle("cmd_1089807606");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#48">EL_upsrc</a>		2</span>
<div id="cmd_1089807606" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local EL_upsrc		2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#48">EL_upsrc</a>		2</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="49" title="local"><!-- -->
    49</a>&nbsp;<a onclick='toggle("cmd_-603917131");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#49">EL_uppkgname</a>	3</span>
<div id="cmd_-603917131" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local EL_uppkgname	3</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#49">EL_uppkgname</a>	3</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="50" title="local"><!-- -->
    50</a>&nbsp;<a onclick='toggle("cmd_-916408934");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#50">EL_FIRST</a>		4</span>
<div id="cmd_-916408934" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local EL_FIRST		4</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#50">EL_FIRST</a>		4</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="52" title="local"><!-- -->
    52</a>&nbsp;<a onclick='toggle("cmd_-59600921");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#52">updlist</a>		<a href="../tokens/p.html#pointer">pointer(</a><a href="../tokens/s.html#string">string</a> <a href="../tokens/c.html#colvector">colvector</a>) <a href="../tokens/c.html#colvector">colvector</a></span>
<div id="cmd_-59600921" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local updlist		pointer(string colvector) colvector</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#52">updlist</a>		<a href="../tokens/p.html#pointer">pointer(</a><a href="../tokens/s.html#string">string</a> <a href="../tokens/c.html#colvector">colvector</a>) <a href="../tokens/c.html#colvector">colvector</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="53" title="local"><!-- -->
    53</a>&nbsp;<a onclick='toggle("cmd_2141876002");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#53">L_SJ</a>		1</span>
<div id="cmd_2141876002" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local L_SJ		1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#53">L_SJ</a>		1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="54" title="local"><!-- -->
    54</a>&nbsp;<a onclick='toggle("cmd_1069820261");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#54">L_STB</a>		2</span>
<div id="cmd_1069820261" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local L_STB		2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#54">L_STB</a>		2</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="55" title="local"><!-- -->
    55</a>&nbsp;<a onclick='toggle("cmd_1818321537");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#55">L_SSC</a>		3</span>
<div id="cmd_1818321537" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local L_SSC		3</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#55">L_SSC</a>		3</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="56" title="local"><!-- -->
    56</a>&nbsp;<a onclick='toggle("cmd_-469987277");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#56">UPDLIST_DIM</a>	3</span>
<div id="cmd_-469987277" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local UPDLIST_DIM	3</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#56">UPDLIST_DIM</a>	3</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="58" title="local"><!-- -->
    58</a>&nbsp;<a onclick='toggle("cmd_2123918491");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#58">pkgcode</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></span>
<div id="cmd_2123918491" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local pkgcode		real scalar</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#58">pkgcode</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="59" title="local"><!-- -->
    59</a>&nbsp;<a onclick='toggle("cmd_-441023848");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#59">PKG_OKAY</a>		0</span>
<div id="cmd_-441023848" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_OKAY		0</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#59">PKG_OKAY</a>		0</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="60" title="local"><!-- -->
    60</a>&nbsp;<a onclick='toggle("cmd_-1397368252");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#60">PKG_NOLONGER</a>	1</span>
<div id="cmd_-1397368252" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_NOLONGER	1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#60">PKG_NOLONGER</a>	1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="61" title="local"><!-- -->
    61</a>&nbsp;<a onclick='toggle("cmd_-2018269873");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#61">PKG_NORESPONSE</a>	2</span>
<div id="cmd_-2018269873" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_NORESPONSE	2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#61">PKG_NORESPONSE</a>	2</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="62" title="local"><!-- -->
    62</a>&nbsp;<a onclick='toggle("cmd_2069808902");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#62">PKG_CANNOTOPEN</a>	3</span>
<div id="cmd_2069808902" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_CANNOTOPEN	3</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#62">PKG_CANNOTOPEN</a>	3</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="63" title="local"><!-- -->
    63</a>&nbsp;<a onclick='toggle("cmd_-83215785");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#63">PKG_UNKNOWN</a>	4</span>
<div id="cmd_-83215785" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_UNKNOWN	4</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#63">PKG_UNKNOWN</a>	4</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="64" title="local"><!-- -->
    64</a>&nbsp;<a onclick='toggle("cmd_1817642508");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#64">PKG_UPDATED</a>	5</span>
<div id="cmd_1817642508" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PKG_UPDATED	5</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#64">PKG_UPDATED</a>	5</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="66" title="local"><!-- -->
    66</a>&nbsp;<a onclick='toggle("cmd_196425011");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#66">pkgtype</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></span>
<div id="cmd_196425011" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local pkgtype		real scalar</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#66">pkgtype</a>		<a href="../tokens/r.html#real">real</a> <a href="../tokens/s.html#scalar">scalar</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="67" title="local"><!-- -->
    67</a>&nbsp;<a onclick='toggle("cmd_-1337573439");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#67">PT_INSTALLED</a>	1</span>
<div id="cmd_-1337573439" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PT_INSTALLED	1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#67">PT_INSTALLED</a>	1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="68" title="local"><!-- -->
    68</a>&nbsp;<a onclick='toggle("cmd_-1584207110");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/a_adoupdate.ado.html#68">PT_NET</a>		2</span>
<div id="cmd_-1584207110" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local PT_NET		2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/a_adoupdate.ado.html#68">PT_NET</a>		2</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_mata rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="70" title="mata"><!-- -->
    70</a>&nbsp;<a onclick='toggle("cmd_283969253");' title="mata">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">mata</span>
  <span class="cmdcomment">block (1121 lines)</span>
<div id="cmd_283969253" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
mata:

/* -------------------------------------------------------------------- */

void pkg_chk_and_update(
		string scalar dir, string scalar pkglist,
		`boolean' update, `boolean' ssconly, `boolean' certainonly,
		`boolean' noisily)
{
	`instlist'	trk
	`updlist'	upd
	string scalar	click

	/* ------------------------------------------------------------ */
	openingmsg()
	upd = J(`UPDLIST_DIM', 1, NULL)

	/* ------------------------------------------------------------ */
	find_and_uninst_dups(dir, 1)

	/* ------------------------------------------------------------ */
	trk = read_statatrk(dir)
	if (ssconly)     trk = extract_ssc(trk)
	if (pkglist!="") trk = extract_matches(trk, pkglist)

	/* ------------------------------------------------------------ */
	if (rows(trk)==0) {
		printf("{txt}")
		if ("pkglist"!="") {
			printf(`"(no packages match "%s")\n"', pkglist)
		}
		else if (ssconly) {
			printf("(no packages installed from SSC\n")
		}
		else {
			printf("(no user-written packages installed)\n")
		}
		st_local("pkglist", "")
		return
	}

	/* ------------------------------------------------------------ */
	printf("\n") 
	printf("{txt}Checking status of ")
	printf(pkglist=="" ?  "installed packages...\n":
			      "specified packages...\n")
	trk = extract_update_exists(trk, upd, certainonly)

	/* ------------------------------------------------------------ */
	printf("\n")
	if (rows(trk)==0) {
		printf("{txt}(no packages require updating)\n")
		st_local("pkglist", "")
		return
	}

	printf(update ?  "{txt}Packages to be updated are...\n" :
			 "{txt}Packages that need to be updated are...\n"
	      )
	printf("\n")
	list_packages(trk)
	set_local_pkglist(trk)
	displayflush()

	/* ------------------------------------------------------------ */
	printf("\n") 
	if (!update) {
		click = rebuildcmdwupdate(dir, pkglist, ssconly, certainonly)
		printf("{txt}Recommendation:  type\n")
		printf(`"    {stata `"%s"':%s}\n"', click, click)
		return
	}

	/* ------------------------------------------------------------ */
	printf("{txt}Installing updates...\n")
	printf("\n")
	update_packages(dir, trk, noisily)

	/* ------------------------------------------------------------ */
	printf("\n")
	printf("{txt}Cleaning up...")
	displayflush()
	find_and_uninst_dups(dir, 0)
	printf("{txt} Done\n")
	displayflush()
}

void openingmsg()
{
	printf("{txt}{p 0 7 2}\n")
	printf("(note: {cmd:`CMDNAME'} updates user-written files;\n")
	printf("type -{cmd:update}- to check for updates to official Stata)\n")
	printf("{p_end}\n")
}

string scalar rebuildcmdwupdate(
		string scalar dir, string scalar pkglist,
		`boolean' ssconly, `boolean' certainonly)
{
	string scalar	cmd

	cmd = "`CMDNAME'"
	if (strtrim(pkglist)!="") cmd = cmd + " " + strtrim(pkglist)
	cmd = cmd + ","
	if (dir!="") cmd = cmd + " dir(" + dir + ")"
	if (ssconly) cmd = cmd + " ssconly"
	if (!certainonly) cmd = cmd + " all"
	return(cmd + " update")
}


/* -------------------------------------------------------------------- */

`instlist' extract_ssc(`instlist' trk)
{
	real scalar	i
	`instlist'	b

	pragma unset b

	for (i=1; i<=rows(trk); i++) {
		if (isssc(srcof(*trk[i]))) b = b \ trk[i]
	}
	return(b)
}

`instlist' extract_matches(`instlist' trk, string scalar pkglist)
{
	real scalar		i, j
	`instlist'		in
	string rowvector	pat

	pragma unset in

	pat = tokens(pkglist)
	for (i=1; i<=rows(trk); i++) {
		for (j=1; j<=cols(pat); j++) {
			if (strmatch(pkgnameof(*trk[i]), pat[j])) {
				in = in \ trk[i]
				break 
			}
		}
	}
	return(in)
}

/* -------------------------------------------------------------------- */


void update_packages(string scalar dir, `instlist' trk, 
						`boolean' noisily)
{
	real scalar	i
	string scalar	names

	names = ""
	for (i=1; i<=rows(trk); i++) {
		if (netinstall(dir, *trk[i], noisily)) {
			names = names + " " + pkgnameof(*trk[i])
		}
	}
	st_local("pkgname", strtrim(names))
}

`boolean' netinstall(string scalar dir, `instpkg' pkg, `boolean' noisily)
{
	string scalar	uppkgname, pkgname, upsrc, cmd, cmd0
	real scalar	rc, relno

	pkgname   = pkgnameof(pkg)
	uppkgname = uppkgnameof(pkg)
	upsrc     = upsrcof(pkg)
	relno     = relnoof(pkg)

	printf("{txt}")
	printf(relno<10 ? "    " : (relno<100 ? "   " : "  "))

	if (pkgname == uppkgname) {
		printf("[%g] {res:%s}\n", relno, pkgname)
	}
	else {
		printf("[%g] {res:%s} using {res:%s}\n",  
				relno, pkgname, uppkgname)
	}
	displayflush()

	cmd0 = sprintf("net set ado %s", dir=="" ? "`DEFAULT_DIR'" : dir)

	if (isssc(upsrc)) {
		cmd = sprintf("ssc install %s, replace", uppkgname)
	}
	else {
		cmd  = sprintf("net install %s, from(%s) replace force",
				uppkgname, upsrc)
	}

	if (noisily) {
		printf("\n")
		printf("{txt}{hline}\n")
		printf("{txt}-> . %s\n", cmd0) 
		if ((rc = _stata(cmd0))) exit(rc)
		printf("{txt}-> . %s\n", cmd)
		rc = _stata(cmd)
		printf("{txt}{hline}\n")
	}
	else {
		if ((rc = _stata(cmd0, 1))) {
			if (rc==1) exit(1)
			(void) _stata(cmd0)
			exit(rc)
			/*NOTREACHED*/
		}
		rc = _stata(cmd, 1)
	}
		
	if (rc) {
		if (rc==1) exit(1)
		printf("{p 8 8 2}\n")
		printf("{txt}{res:%s} not updated; return code was %g{break}\n",
							pkgname, rc)
		printf("Try updating {res:%s} again later,\n", pkgname)
		printf("type -{cmd:`CMDNAME' %s, update}-.\n", pkgname)
		printf("If that still does not work, type\n")
		printf("-{cmd:`CMDNAME' %s, update verbose}-.\n", pkgname)
		printf("\n")
		return(0)
	}
	return(1)
}


void set_local_pkglist(`instlist' trk)
{
	real scalar	i
	string scalar	list

	if (rows(list)==0) {
		st_local("pkglist", "")
		return
	}

	list = pkgnameof(*trk[1])
	for (i=2; i<=rows(trk); i++) list = list + " " + pkgnameof(*trk[i])
	st_local("pkglist", list)
}


void list_packages(`instlist' trk)
{
	real scalar	i, n, relno
	string scalar	pkgname, pad

	for (i=1; i<=rows(trk); i++) {
		pkgname = pkgnameof(*trk[i])

		if ((n = 12 - strlen(pkgname)) > 0) {
			pad = "{bind:" + n*" " + "}"
		}
		else	pad = ""

		relno = relnoof(*trk[i])
		if (relno<10) 		printf("{p 4 24 2}\n")
		else if (relno<100) 	printf("{p 3 24 2}\n")
		else 			printf("{p 2 24 2}\n")

		printf("[%g] {res:%s}%s -- %s\n",  relno, pkgname, pad,
				titleof(*trk[i]))
		printf("{p_end}\n")
	}
}

`instlist' extract_update_exists(`instlist' trk, `updlist' upd, 
						`boolean' certainonly)
{
	real scalar	i
	`pkgcode'	status
	`instlist'	res

	pragma unset res

	status = J(rows(trk), 1, .)
	for (i=1; i<=rows(trk); i++) {
		status = pkg_update_status_noisily(*trk[i], upd)
		if (status==`PKG_UPDATED' | 
		   (certainonly==0 & status==`PKG_UNKNOWN')) {
			res = res \ trk[i]
		}
	}

	return(res)
}

`pkgcode' pkg_update_status_noisily(`instpkg' pkg, `updlist' upd)
{
	real scalar	relno
	`pkgcode'	res

	printf("\n")
	relno = relnoof(pkg)
	if (relno<10)       printf("{p 4 8 2}\n")
	else if (relno<100) printf("{p 3 8 2}\n")
	else 		    printf("{p 2 8 2}\n")
	printf("{txt}[%g] {res:%s} at %s:{break}\n", 
				relno, pkgnameof(pkg), srcof(pkg))
	displayflush()

	res = pkg_update_status(pkg, upd)

	if (res==`PKG_OKAY') {
		printf("installed package is up to date\n") 
	}
	else if (res==`PKG_CANNOTOPEN') {
		printf(
		"server not responding or package is no longer available\n")
	}
	else if (res==`PKG_NOLONGER') {
		printf("package no longer available\n")
	}
	else if (res==`PKG_NORESPONSE') {
		printf("server not responding\n") 
	}
	else if (res==`PKG_UPDATED') {
		printf("{res:package has been updated on server}\n")
	}
	else {
		printf(
		"cannot tell because distribution dates not provided by source\n")
	}
	printf("{p_end}\n")
	displayflush()

	return(res)
}

`pkgcode' pkg_update_status(`instpkg' pkg, `updlist' upd)
{
	string scalar	src

	src = srcof(pkg)
	if (isssc(src))          return(pkg_update_status_ssc(pkg, upd))
	if (isstatajournal(src)) return(pkg_update_status_sj( pkg, upd))
	if (isstb(src))          return(pkg_update_status_stb(pkg, upd))

	return(pkg_update_status_default(pkg))
}

`boolean' isstb(string scalar s)
{
	string scalar sl

	sl = strlower(s)
	if (pstrcmp("http://www.stata.com/stb/", sl)) return(1)
	return(0)
}

`boolean' isstatajournal(string scalar s)
{	
	string scalar sl

	sl = strlower(s)
	if (pstrcmp("http://www.stata-journal.com/software/", sl)) return(1)
	if (pstrcmp("http://www.statajournal.com/software/",  sl)) return(1)
	if (pstrcmp("http://www.stata-journal.org/software/", sl)) return(1)
	if (pstrcmp("http://www.statajournal.org/software/",  sl)) return(1)
	return(0)
}

`boolean' isssc(string scalar s)
{
	string scalar	sl

	sl = strlower(s)
	if (pstrcmp("http://fmwww.bc.edu/repec/", sl)) return(1)
	return(0)
}
	
`boolean' pstrcmp(string scalar substr, string scalar fullstr)
{
	return( (substr == substr(fullstr, 1, strlen(substr))) )
}

`pkgcode' pkg_update_status_ssc(`instpkg' pkg, `updlist' upd)
{
	real scalar	dinstalled, dnet
	string scalar	strdate

	if (upd[`L_SSC']==NULL) {
		upd[`L_SSC'] = &(loadsscupfile())
		/*
		testing of bsearch:
		printf("\n")
		i = rows(*upd[`L_SSC'])
		i
		(*upd[`L_SSC'])[1]
		(*upd[`L_SSC'])[i]
		bsearch_ssclist("_gclsort", *upd[`L_SSC'], 0)
		bsearch_ssclist("ztg", *upd[`L_SSC'], 0)
		*/
	}


	strdate = search_ssclist(pkgnameof(pkg), *upd[`L_SSC'])
	if (strdate=="") return(`PKG_NOLONGER')

	dinstalled = distributiondateof(pkg, `PT_INSTALLED')
	dnet       = edateofstr(strdate)

	if (dinstalled<. & dnet<.) {
		if (dinstalled<dnet) {
			set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
			return(`PKG_UPDATED')
		}
		return(`PKG_OKAY')
	}

	if (dnet<. & dinstalled>=.) {
		set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
		return(`PKG_UPDATED')
	}
	return(`PKG_UNKNOWN')
}

string scalar search_ssclist(string scalar pkgname, string colvector ssclist)
{
	real scalar	i

	if (i = bsearch_ssclist(strlower(pkgname), ssclist, 0)) {
		return(tokens(ssclist[i])[2])
	}
	return("")
}

/*
	i = bsearch_ssclist(name, ssclist, i0)

        Look for name in strictly ascending ssclist[] between i0 and 
	end-of-list.  Specify i0=0 to search entire list.
*/

real scalar bsearch_ssclist(string scalar name,
			   string vector ssclist, 
			   real scalar j0)
{
	real scalar	n, jl, ju, jm

	jl = j0   
	ju = (n=length(ssclist)) + 1 

	while (ju-jl>1) {
		jm = trunc((ju+jl)/2)
		if ( name > (tokens(ssclist[jm])[1]) ) 	jl = jm 
		else 					ju = jm 
	}
	if (jl<n) { 
		ju = jl
		if ( name == (tokens(ssclist[++ju])[1]) ) return(ju)
	}
	return(0)
}

	
`pkgcode' pkg_update_status_default(`instpkg' pkg)
{
	string colvector	net
	string scalar		ffn
	real scalar		dinstalled, dnet
	real scalar		negrc

	ffn = srcffnof(pkg)

	pragma unset net
	if ((negrc=read_pkg_file(ffn, net))) {
		if (negrc==`NEGRC_NORESPONSE') return(`PKG_NORESPONSE')
		if (negrc==`NEGRC_NOHOST')     return(`PKG_NORESPONSE')
		if (negrc==`NEGRC_NOFILE')     return(`PKG_NOLONGER')
		return(`PKG_CANNOTOPEN')
	}

	dinstalled = distributiondateof(pkg, `PT_INSTALLED')
	dnet       = distributiondateof(net, `PT_NET')

	if (dinstalled<. & dnet<.) {
		if (dinstalled<dnet) {
			set_upinfoof(pkg, srcof(pkg),pkgnameof(pkg))
			return(`PKG_UPDATED')
		}
		return(`PKG_OKAY')
	}

	if (dnet<. & dinstalled>=.) {
		set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
		return(`PKG_UPDATED')
	}
	return(`PKG_UNKNOWN')
}

`pkgcode' pkg_update_status_stb(`instpkg' pkg, `updlist' upd)
{
	real scalar	idx
	string scalar	pkgname

	if (pkg_update_status_sj(pkg, upd)==`PKG_UPDATED') {
		return(`PKG_UPDATED')
	}

	pkgname = pkgnameof(pkg)
	if (upd[`L_STB']==NULL) upd[`L_STB'] = &loadupfile(`STBupfile')

	if (idx = findbestinlist(pkgname, *upd[`L_STB'])) {
		set_upinfo_fromupd(pkg, upd, `L_STB', idx, `STBbasesrc')
		return(`PKG_UPDATED')
	}
	return(`PKG_OKAY')
}


`pkgcode' pkg_update_status_sj(`instpkg' pkg, `updlist' upd)
{
	real scalar		idx
	string scalar		pkgname

	pkgname = pkgnameof(pkg)
	if (upd[`L_SJ']==NULL) upd[`L_SJ'] = &loadupfile(`SJupfile')
	if (idx = findbestinlist(pkgname, *upd[`L_SJ'])) {
		set_upinfo_fromupd(pkg, upd, `L_SJ', idx, `SJbasesrc')
		return(`PKG_UPDATED')
	}
	return(`PKG_OKAY')
}

void set_upinfo_fromupd(`instpkg' pkg, 
		`updlist' upd, real scalar l, real scalar i, 
		string scalar basesrc)
{
	string rowvector	toks

	toks = tokens((*upd[l])[i])
	set_upinfoof(pkg, pathjoin(basesrc,toks[1]), toks[2])
}


string colvector loadupfile(string scalar ffn)
{
	real scalar		fh
	string scalar		line
	string colvector	res

	fh = fopen(ffn, "r")

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (strpos(line, "_")) res = res \ line
	}
	fclose(fh)
	return(res)
}

string colvector loadsscupfile()
{
	real scalar	fh
	string scalar	line
	string colvector res

	fh = fopen(`SSCupfile', "r")

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="") {
			res = res \ strlower(subinstr(line,":","",1))
		}
	}
	fclose(fh)
	_sort(res, 1)
	return(res)
}


real scalar findbestinlist(string scalar name, string colvector list)
{
	string scalar	curlhs, newlhs, newname
	real scalar	currhs, newrhs
	real scalar	i, bestidx, bestrhs

	pragma unset newlhs
	pragma unset newrhs
	pragma unset curlhs
	pragma unset currhs

	splitname(name, curlhs, currhs)

	bestrhs = currhs
	bestidx = 0
	for (i=1; i<=rows(list); i++) {
		newname = tokens(list[i])[2]
		splitname(newname, newlhs, newrhs)
		if (newlhs == curlhs) {
			if (newrhs>bestrhs) {
				bestrhs = newrhs
				bestidx = i 
			}
		}
	}
	return(bestidx)
}

void splitname(string scalar name, lhs, rhs)
{
	real scalar	i

	if (i = strpos(name, "_")) {
		lhs = substr(name, 1, i-1)
		rhs = strtoreal(substr(name, i+1, .))
		if (rhs<.) return
	}
	lhs = name
	rhs = -1
}
		

string scalar basepkgname(string scalar name)
{
	real scalar	i

	i = strpos(name, "_")
	return(i ? substr(name, 1, i-1) : name)
}
	
	
/* -------------------------------------------------------------------- */

void find_and_uninst_dups(string scalar dir, `boolean' noisily)
{
	while (1) {
		if (find_and_uninst_1dup_std(dir, noisily)==0) break
	}

	while (1) {
		if (find_and_uninst_1dup_sjstb(dir, noisily)==0) break
	}

	while (1) {
		if (find_and_uninst_1dup_ssc(dir, noisily)==0) break
	}
}

`boolean' find_and_uninst_1dup_std(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	string colvector	lcffn
	string scalar		lcpkgname
	real scalar		i, j

	trk = read_statatrk(dir)

	lcffn = J(rows(trk), 1, "")
	for (i=1; i<=rows(trk); i++) lcffn[i] = strlower(srcffnof(*trk[i]))

	for (i=1; i<rows(lcffn) /*sic*/; i++) {
		for (j=i+1; j<=rows(lcffn); j++) {
			if (lcffn[i]==lcffn[j]) {
				rmdup(dir, trk, i, j, noisily)
				return(1)
			}
		}
	}
	return(0)
}

`boolean' find_and_uninst_1dup_ssc(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	real colvector		isssc
	string colvector	lcpkgname
	real scalar		i, j

	trk = read_statatrk(dir)

	isssc = J(rows(trk), 1, .)
	lcpkgname = J(rows(trk), 1, "")
	for (i=1; i<=rows(trk); i++) {
		isssc[i] = isssc(srcof(*trk[i]))
		lcpkgname[i] = strlower(pkgnameof(*trk[i]))
	}

	for (i=1; i<rows(trk) /*sic*/; i++) {
		if (isssc[i]) {
			for (j=i+1; j<=rows(trk); j++) {
				if (isssc[j]) {
					if (lcpkgname[i]==lcpkgname[j]) {
						rmdup(dir, trk, i, j,
								noisily)
						return(1)
					}
				}
			}
		}
	}
	return(0)
}

`boolean' find_and_uninst_1dup_sjstb(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	string colvector	lhs
	real colvector		rhs
	string scalar		pkgname, curlhs, src
	`boolean'		touse, hassjstb
	real scalar		i, j, currhs, torm

	trk = read_statatrk(dir)

	lhs = J(rows(trk), 1, "")
	rhs = J(rows(trk), 1, .)
	hassjstb = 0
	for (i=1; i<=rows(trk); i++) {
		src = srcof(*trk[i])
		touse = 0
		if (isstatajournal(src)) touse = 1 
		else if (isstb(src)) touse = 1 
		if (touse) {
			hassjstb = 1
			pkgname = pkgnameof(*trk[i])
			pragma unset curlhs
			pragma unset currhs
			splitname(pkgname, curlhs, currhs)
			lhs[i] = curlhs
			rhs[i] = currhs
		}
	}

	if (!hassjstb) return(0)

	for (i=1; i<rows(trk) /*sic*/; i++) {		
		if (rhs[i]<.) {
			for (j=i+1; j<=rows(trk); j++) {
				if (rhs[j]<.) {
					if (lhs[i]==lhs[j]) {
						torm = (rhs[i]>rhs[j] ? j:i)
						netrm(dir, *trk[torm], noisily)
						return(1)
					}
				}
			}
		}
	}
	return(0)
}

void rmdup(string scalar dir, `instlist' trk, real scalar i, 
					real scalar j, `boolean' noisily)
{
	real scalar	idate, jdate, torm

	idate = installdateof(*trk[i])
	jdate = installdateof(*trk[j])

	if (idate>jdate) 	torm = j
	else if (idate<jdate)	torm = i
	else {
		if (uniqidof(*trk[i])>uniqidof(*trk[j])) torm = j
		else				         torm = i 
	}

	netrm(dir, *trk[torm], noisily)
}

void netrm(string scalar dir, `instpkg' pkg, `boolean' noisily)
{
	string scalar	cmd

	if (noisily) {
		printf("{p}\n")
		printf(
		"{txt}(note: package {res:%s} was installed more than once;\n", 
		 		pkgnameof(pkg))
		printf("older copy removed)\n")
		printf("{p_end}\n") 
	}

	cmd = sprintf("quietly ado uninstall [%g]", relnoof(pkg))
	if (dir!="") cmd = cmd + ", from("+dir+")"
	stata(cmd)
}
/* -------------------------------------------------------------------- */


`instlist' read_statatrk(string scalar dir)
{
	real scalar	fh, i
	string scalar	element
	`instlist'	res
	
	res = J(0,1,NULL)

	if ((fh = _fopen(ffn_of_statatrk(dir), "r")) < 0) {
		errprintf(
		"directory %s does not have user-installed files\n", dir)
		exit(601)
	}

	i = 0
	while((element=read_statatrk_element(fh, ++i))!=J(0,1,"")) {
		res = res \ &acopy(element)
	}
	fclose(fh)
	return(res) 
}


string scalar ffn_of_statatrk(string scalar dir)
{
	string scalar	basedir

	basedir = pathsubsysdir(dir=="" ? "`DEFAULT_DIR'" : dir)
	return(pathjoin(basedir, "stata.trk"))
}

transmorphic matrix acopy(transmorphic matrix x)
{
	transmorphic matrix copy 
	copy = x 
	return(copy)
}

void read_statatrk_skiphdr(real scalar fh)
{
	string scalar	line
	real scalar	pos

	pos = ftell(fh)
	while ((line=fget(fh))!=J(0,0,"")) {
		if (!(substr(line,1,1)=="*" | strtrim(line)=="")) {
			fseek(fh, pos, -1)
			return
		}
		pos = ftell(fh)
	}
}


`instpkg' read_statatrk_element(real scalar fh, real scalar i)
{
	`instpkg' 	res
	string scalar	line

	res = J(`EL_FIRST', 1, "")
	res[`EL_relno'] = sprintf("%g", i)

	read_statatrk_skiphdr(fh)
	if ((line = fget(fh))==J(0,0,"")) return(J(0,1,""))

	if (substr(line, 1, 1)!="S") {
		errprintf("stata.trk file invalid header\n") 
		exit(610)
	}
	res[`EL_FIRST'] = line

	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="" & substr(line,1,1)!="*") {
			res = res \ strrtrim(line)
			if (substr(line,1,1)=="e") return(res)
		}
	}
	errprintf("stata.trk file invalid contents\n") 
	exit(610)
	/*NOTREACHED*/
}



/* -------------------------------------------------------------------- */

real scalar read_pkg_file(string scalar ffn, string colvector res)
{
	real scalar 	fh

	if ((fh = _fopen(ffn, "r")) < 0) {
		res = J(0, 1, "")
		return(fh)
	}
	res = read_pkg_element(fh)
	fclose(fh)
	return(0)
}


string colvector read_pkg_element(real scalar fh)
{
	string colvector res
	string scalar	line

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="" & substr(line,1,1)!="*") {
			res = res \ strrtrim(line)
		}
	}
	return(res)
}

/* -------------------------------------------------------------------- */

string scalar srcof(`instpkg' pkg)
{
	return(subelementof(pkg, "S"))
}

string scalar titleof(`instpkg' pkg)
{
	string colvector	res

	res = subelementof(pkg, "d")
	return(rows(res)==0 ? "" : res[1])
}

string scalar upsrcof(`instpkg' pkg)
{
	return(pkg[`EL_upsrc'])
}

string scalar srcffnof(`instpkg' pkg)
{
	string scalar	src, fn

	src = srcof(pkg)
	fn  = subelementof(pkg, "N")

	if (rows(src)!=1 | rows(fn)!=1) return("")
	return(pathjoin(src, fn))
}

string scalar pkgnameof(`instpkg' pkg)
{
	string colvector	res
	real scalar		len

	res = subelementof(pkg, "N")
	if (rows(res)!=1) return("")

	len = strlen(res)
	if (substr(res, len-3, .) == ".pkg") return(substr(res, 1, len-4))
	return(res)
}

string scalar uppkgnameof(`instpkg' pkg)
{
	return(pkg[`EL_uppkgname'])
}


real scalar uniqidof(`instpkg' pkg)
{
	string colvector	res
	real scalar		uid

	res = subelementof(pkg, "U")
	if (rows(res)==1) {
		uid = strtoreal(res)
		if (uid<.) return(uid)
	}
		
	pkg_corrupt()
	/*NOTREACHED*/
}

real scalar relnoof(`instpkg' pkg)
{
	real scalar	rel

	if ((rel = strtoreal(pkg[`EL_relno'])) < .) return(rel)
	pkg_corrupt()
	/*NOTREACHED*/
}


real scalar installdateof(`instpkg' pkg)
{
	string colvector	res
	real scalar		edate

	res = subelementof(pkg, "D")
	if (rows(res)==1) {
		edate = date(res, "dmy")
		if (edate<.) return(edate)
	}
	pkg_corrupt()
	/*NOTREACHED*/
}
		

real scalar distributiondateof(`instpkg' pkg, `pkgtype' ptype)
{
	real scalar		i
	string colvector	d
	real scalar		e, emax

	d = distributiondatesof(pkg, ptype)
	
	emax = 0
	for (i=1; i<=rows(d); i++) {
		e = edateofstr(d[i])
		if (e>emax & e<.) emax = e
	}
	return(emax ? emax : .)
}

	
string colvector distributiondatesof(`instpkg' pkg, `pkgtype' ptype)
{
	real scalar		i
	string colvector	d
	string colvector	res

	d = (ptype==`PT_INSTALLED' ? 
		subelementof(pkg, "d") : 
		subelementnet(pkg, "d")
	    )

	pragma unset res
	for (i=1; i<=rows(d); i++) {
		/* ----+----1----+--- */
                /* Distribution-Date: */
		if (strlower(substr(d[i], 1, 18))=="distribution-date:") {
			res = res \ strlower(strtrim(substr(d[i], 19, .)))
		}
	}
	return(res)
}
		

string colvector subelementof(`instpkg' pkg, string scalar ltr)
{
	real scalar		i
	string colvector	res

	pragma unset res
	for (i=`EL_FIRST'; i<=rows(pkg); i++) {
		if (substr(pkg[i],1,1)==ltr) {
			res = res \ strtrim(substr(pkg[i],2,.))
		}
	}
	return(res)
}

string colvector subelementnet(string colvector gel, string scalar ltr)
{
	real scalar		i
	string colvector	res

	pragma unset res
	for (i=1; i<=rows(gel); i++) {
		if (substr(gel[i],1,1)==ltr) {
			res = res \ strtrim(substr(gel[i],2,.))
		}
	}
	return(res)
}

void set_upinfoof(`instpkg' pkg, string scalar src, string scalar pkgname)
{
	pkg[`EL_upsrc']     = src
	pkg[`EL_uppkgname'] = pkgname
}

void pkg_corrupt()
{
	errprintf("stata.trk file invalid or corrupted\n")
	errprintf("no action taken\n")
	exit(610)
	/*NOTREACHED*/
}


/* -------------------------------------------------------------------- */

real scalar edateofstr(string scalar s)
{
	real scalar	res
	real scalar	yr, mo, da

	if (strlen(s)==8) {
		yr = strtoreal(substr(s, 1, 4))
		mo = strtoreal(substr(s, 5, 2))
		da = strtoreal(substr(s, 7, 2))
		if (yr<. & mo<. & da<.) {
			res = mdy(mo, da, yr)
			if (res!=.) return(res)
		}
	}
	return(date(s, "dmy"))
}


real scalar docmd(string scalar rhs)
{
	real scalar	res
	
	stata("scalar DoCmdStringScalar = " + rhs)
	res = st_numscalar("DoCmdStringScalar")
	stata("scalar drop DoCmdStringScalar")
	return(res)
}
	

/*
real scalar mdy(real mo, real da, real yr)
{
	return(docmd(sprintf("mdy(%g, %g, %g)", mo, da, yr)))
}

real scalar date(string scalar str, string scalar pattern)
{
	return(docmd(sprintf(`"date("%s", "%s")"', str, pattern)))
}
*/



/* -------------------------------------------------------------------- */

end</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">mata</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">block (1121 lines)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
</table>
</li>
</ul>


<a name="content"><!--   --></a>
<!-- ========== CONTENT =========== -->
<ul class="blockList">
<li class="blockList">
<ul class="blockList">
<li class="blockList">
<h3>Content</h3>
<pre>
*! version 1.1.0  09jun2011
program adoupdate, rclass
	version 9

	syntax [anything(name=pkglist id="package list")] [, 	///
		ALL			///
		DIR(string)		///
		SSConly 		///
		UPDATE			///
		VERBOSE			///
	       ]

	local upd      = cond("`update'"=="", 0, 1)
	local bos      = cond("`ssconly'"=="", 0, 1)
	local notall   = cond("`all'"=="", 1, 0)
	local noisily  = cond("`verbose'"=="", 0, 1)

	set more off
	mata: pkg_chk_and_update("`dir'", "`pkglist'", ///
			`upd', `bos', `notall', `noisily')
	return local pkglist "`pkglist'"
end


/* ==================================================================== */

version 9

local CMDNAME		adoupdate
local DEFAULT_DIR	"PLUS"

local SJupfile		`""http://www.stata-journal.com/software/filelist.php""'
local SJbasesrc		`""http://www.stata-journal.com/software/""'
local STBupfile		`""http://www.stata.com/stb/filelist.php""'
local STBbasesrc	`""http://www.stata.com/stb/""'
local SSCupfile		`""http://repec.org/docs/sscDD.php""'

local NEGRC_NORESPONSE	(-677)
local NEGRC_NOHOST	(-631)
local NEGRC_NOFILE	(-601)


local boolean		real scalar

local instpkg		string colvector
local instlist		pointer(`instpkg') colvector
local EL_relno		1
local EL_upsrc		2
local EL_uppkgname	3
local EL_FIRST		4

local updlist		pointer(string colvector) colvector
local L_SJ		1
local L_STB		2
local L_SSC		3
local UPDLIST_DIM	3

local pkgcode		real scalar
local PKG_OKAY		0
local PKG_NOLONGER	1
local PKG_NORESPONSE	2
local PKG_CANNOTOPEN	3
local PKG_UNKNOWN	4
local PKG_UPDATED	5

local pkgtype		real scalar
local PT_INSTALLED	1
local PT_NET		2

mata:

/* -------------------------------------------------------------------- */

void pkg_chk_and_update(
		string scalar dir, string scalar pkglist,
		`boolean' update, `boolean' ssconly, `boolean' certainonly,
		`boolean' noisily)
{
	`instlist'	trk
	`updlist'	upd
	string scalar	click

	/* ------------------------------------------------------------ */
	openingmsg()
	upd = J(`UPDLIST_DIM', 1, NULL)

	/* ------------------------------------------------------------ */
	find_and_uninst_dups(dir, 1)

	/* ------------------------------------------------------------ */
	trk = read_statatrk(dir)
	if (ssconly)     trk = extract_ssc(trk)
	if (pkglist!="") trk = extract_matches(trk, pkglist)

	/* ------------------------------------------------------------ */
	if (rows(trk)==0) {
		printf("{txt}")
		if ("pkglist"!="") {
			printf(`"(no packages match "%s")\n"', pkglist)
		}
		else if (ssconly) {
			printf("(no packages installed from SSC\n")
		}
		else {
			printf("(no user-written packages installed)\n")
		}
		st_local("pkglist", "")
		return
	}

	/* ------------------------------------------------------------ */
	printf("\n") 
	printf("{txt}Checking status of ")
	printf(pkglist=="" ?  "installed packages...\n":
			      "specified packages...\n")
	trk = extract_update_exists(trk, upd, certainonly)

	/* ------------------------------------------------------------ */
	printf("\n")
	if (rows(trk)==0) {
		printf("{txt}(no packages require updating)\n")
		st_local("pkglist", "")
		return
	}

	printf(update ?  "{txt}Packages to be updated are...\n" :
			 "{txt}Packages that need to be updated are...\n"
	      )
	printf("\n")
	list_packages(trk)
	set_local_pkglist(trk)
	displayflush()

	/* ------------------------------------------------------------ */
	printf("\n") 
	if (!update) {
		click = rebuildcmdwupdate(dir, pkglist, ssconly, certainonly)
		printf("{txt}Recommendation:  type\n")
		printf(`"    {stata `"%s"':%s}\n"', click, click)
		return
	}

	/* ------------------------------------------------------------ */
	printf("{txt}Installing updates...\n")
	printf("\n")
	update_packages(dir, trk, noisily)

	/* ------------------------------------------------------------ */
	printf("\n")
	printf("{txt}Cleaning up...")
	displayflush()
	find_and_uninst_dups(dir, 0)
	printf("{txt} Done\n")
	displayflush()
}

void openingmsg()
{
	printf("{txt}{p 0 7 2}\n")
	printf("(note: {cmd:`CMDNAME'} updates user-written files;\n")
	printf("type -{cmd:update}- to check for updates to official Stata)\n")
	printf("{p_end}\n")
}

string scalar rebuildcmdwupdate(
		string scalar dir, string scalar pkglist,
		`boolean' ssconly, `boolean' certainonly)
{
	string scalar	cmd

	cmd = "`CMDNAME'"
	if (strtrim(pkglist)!="") cmd = cmd + " " + strtrim(pkglist)
	cmd = cmd + ","
	if (dir!="") cmd = cmd + " dir(" + dir + ")"
	if (ssconly) cmd = cmd + " ssconly"
	if (!certainonly) cmd = cmd + " all"
	return(cmd + " update")
}


/* -------------------------------------------------------------------- */

`instlist' extract_ssc(`instlist' trk)
{
	real scalar	i
	`instlist'	b

	pragma unset b

	for (i=1; i<=rows(trk); i++) {
		if (isssc(srcof(*trk[i]))) b = b \ trk[i]
	}
	return(b)
}

`instlist' extract_matches(`instlist' trk, string scalar pkglist)
{
	real scalar		i, j
	`instlist'		in
	string rowvector	pat

	pragma unset in

	pat = tokens(pkglist)
	for (i=1; i<=rows(trk); i++) {
		for (j=1; j<=cols(pat); j++) {
			if (strmatch(pkgnameof(*trk[i]), pat[j])) {
				in = in \ trk[i]
				break 
			}
		}
	}
	return(in)
}

/* -------------------------------------------------------------------- */


void update_packages(string scalar dir, `instlist' trk, 
						`boolean' noisily)
{
	real scalar	i
	string scalar	names

	names = ""
	for (i=1; i<=rows(trk); i++) {
		if (netinstall(dir, *trk[i], noisily)) {
			names = names + " " + pkgnameof(*trk[i])
		}
	}
	st_local("pkgname", strtrim(names))
}

`boolean' netinstall(string scalar dir, `instpkg' pkg, `boolean' noisily)
{
	string scalar	uppkgname, pkgname, upsrc, cmd, cmd0
	real scalar	rc, relno

	pkgname   = pkgnameof(pkg)
	uppkgname = uppkgnameof(pkg)
	upsrc     = upsrcof(pkg)
	relno     = relnoof(pkg)

	printf("{txt}")
	printf(relno<10 ? "    " : (relno<100 ? "   " : "  "))

	if (pkgname == uppkgname) {
		printf("[%g] {res:%s}\n", relno, pkgname)
	}
	else {
		printf("[%g] {res:%s} using {res:%s}\n",  
				relno, pkgname, uppkgname)
	}
	displayflush()

	cmd0 = sprintf("net set ado %s", dir=="" ? "`DEFAULT_DIR'" : dir)

	if (isssc(upsrc)) {
		cmd = sprintf("ssc install %s, replace", uppkgname)
	}
	else {
		cmd  = sprintf("net install %s, from(%s) replace force",
				uppkgname, upsrc)
	}

	if (noisily) {
		printf("\n")
		printf("{txt}{hline}\n")
		printf("{txt}-> . %s\n", cmd0) 
		if ((rc = _stata(cmd0))) exit(rc)
		printf("{txt}-> . %s\n", cmd)
		rc = _stata(cmd)
		printf("{txt}{hline}\n")
	}
	else {
		if ((rc = _stata(cmd0, 1))) {
			if (rc==1) exit(1)
			(void) _stata(cmd0)
			exit(rc)
			/*NOTREACHED*/
		}
		rc = _stata(cmd, 1)
	}
		
	if (rc) {
		if (rc==1) exit(1)
		printf("{p 8 8 2}\n")
		printf("{txt}{res:%s} not updated; return code was %g{break}\n",
							pkgname, rc)
		printf("Try updating {res:%s} again later,\n", pkgname)
		printf("type -{cmd:`CMDNAME' %s, update}-.\n", pkgname)
		printf("If that still does not work, type\n")
		printf("-{cmd:`CMDNAME' %s, update verbose}-.\n", pkgname)
		printf("\n")
		return(0)
	}
	return(1)
}


void set_local_pkglist(`instlist' trk)
{
	real scalar	i
	string scalar	list

	if (rows(list)==0) {
		st_local("pkglist", "")
		return
	}

	list = pkgnameof(*trk[1])
	for (i=2; i<=rows(trk); i++) list = list + " " + pkgnameof(*trk[i])
	st_local("pkglist", list)
}


void list_packages(`instlist' trk)
{
	real scalar	i, n, relno
	string scalar	pkgname, pad

	for (i=1; i<=rows(trk); i++) {
		pkgname = pkgnameof(*trk[i])

		if ((n = 12 - strlen(pkgname)) > 0) {
			pad = "{bind:" + n*" " + "}"
		}
		else	pad = ""

		relno = relnoof(*trk[i])
		if (relno<10) 		printf("{p 4 24 2}\n")
		else if (relno<100) 	printf("{p 3 24 2}\n")
		else 			printf("{p 2 24 2}\n")

		printf("[%g] {res:%s}%s -- %s\n",  relno, pkgname, pad,
				titleof(*trk[i]))
		printf("{p_end}\n")
	}
}

`instlist' extract_update_exists(`instlist' trk, `updlist' upd, 
						`boolean' certainonly)
{
	real scalar	i
	`pkgcode'	status
	`instlist'	res

	pragma unset res

	status = J(rows(trk), 1, .)
	for (i=1; i<=rows(trk); i++) {
		status = pkg_update_status_noisily(*trk[i], upd)
		if (status==`PKG_UPDATED' | 
		   (certainonly==0 & status==`PKG_UNKNOWN')) {
			res = res \ trk[i]
		}
	}

	return(res)
}

`pkgcode' pkg_update_status_noisily(`instpkg' pkg, `updlist' upd)
{
	real scalar	relno
	`pkgcode'	res

	printf("\n")
	relno = relnoof(pkg)
	if (relno<10)       printf("{p 4 8 2}\n")
	else if (relno<100) printf("{p 3 8 2}\n")
	else 		    printf("{p 2 8 2}\n")
	printf("{txt}[%g] {res:%s} at %s:{break}\n", 
				relno, pkgnameof(pkg), srcof(pkg))
	displayflush()

	res = pkg_update_status(pkg, upd)

	if (res==`PKG_OKAY') {
		printf("installed package is up to date\n") 
	}
	else if (res==`PKG_CANNOTOPEN') {
		printf(
		"server not responding or package is no longer available\n")
	}
	else if (res==`PKG_NOLONGER') {
		printf("package no longer available\n")
	}
	else if (res==`PKG_NORESPONSE') {
		printf("server not responding\n") 
	}
	else if (res==`PKG_UPDATED') {
		printf("{res:package has been updated on server}\n")
	}
	else {
		printf(
		"cannot tell because distribution dates not provided by source\n")
	}
	printf("{p_end}\n")
	displayflush()

	return(res)
}

`pkgcode' pkg_update_status(`instpkg' pkg, `updlist' upd)
{
	string scalar	src

	src = srcof(pkg)
	if (isssc(src))          return(pkg_update_status_ssc(pkg, upd))
	if (isstatajournal(src)) return(pkg_update_status_sj( pkg, upd))
	if (isstb(src))          return(pkg_update_status_stb(pkg, upd))

	return(pkg_update_status_default(pkg))
}

`boolean' isstb(string scalar s)
{
	string scalar sl

	sl = strlower(s)
	if (pstrcmp("http://www.stata.com/stb/", sl)) return(1)
	return(0)
}

`boolean' isstatajournal(string scalar s)
{	
	string scalar sl

	sl = strlower(s)
	if (pstrcmp("http://www.stata-journal.com/software/", sl)) return(1)
	if (pstrcmp("http://www.statajournal.com/software/",  sl)) return(1)
	if (pstrcmp("http://www.stata-journal.org/software/", sl)) return(1)
	if (pstrcmp("http://www.statajournal.org/software/",  sl)) return(1)
	return(0)
}

`boolean' isssc(string scalar s)
{
	string scalar	sl

	sl = strlower(s)
	if (pstrcmp("http://fmwww.bc.edu/repec/", sl)) return(1)
	return(0)
}
	
`boolean' pstrcmp(string scalar substr, string scalar fullstr)
{
	return( (substr == substr(fullstr, 1, strlen(substr))) )
}

`pkgcode' pkg_update_status_ssc(`instpkg' pkg, `updlist' upd)
{
	real scalar	dinstalled, dnet
	string scalar	strdate

	if (upd[`L_SSC']==NULL) {
		upd[`L_SSC'] = &(loadsscupfile())
		/*
		testing of bsearch:
		printf("\n")
		i = rows(*upd[`L_SSC'])
		i
		(*upd[`L_SSC'])[1]
		(*upd[`L_SSC'])[i]
		bsearch_ssclist("_gclsort", *upd[`L_SSC'], 0)
		bsearch_ssclist("ztg", *upd[`L_SSC'], 0)
		*/
	}


	strdate = search_ssclist(pkgnameof(pkg), *upd[`L_SSC'])
	if (strdate=="") return(`PKG_NOLONGER')

	dinstalled = distributiondateof(pkg, `PT_INSTALLED')
	dnet       = edateofstr(strdate)

	if (dinstalled<. & dnet<.) {
		if (dinstalled<dnet) {
			set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
			return(`PKG_UPDATED')
		}
		return(`PKG_OKAY')
	}

	if (dnet<. & dinstalled>=.) {
		set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
		return(`PKG_UPDATED')
	}
	return(`PKG_UNKNOWN')
}

string scalar search_ssclist(string scalar pkgname, string colvector ssclist)
{
	real scalar	i

	if (i = bsearch_ssclist(strlower(pkgname), ssclist, 0)) {
		return(tokens(ssclist[i])[2])
	}
	return("")
}

/*
	i = bsearch_ssclist(name, ssclist, i0)

        Look for name in strictly ascending ssclist[] between i0 and 
	end-of-list.  Specify i0=0 to search entire list.
*/

real scalar bsearch_ssclist(string scalar name,
			   string vector ssclist, 
			   real scalar j0)
{
	real scalar	n, jl, ju, jm

	jl = j0   
	ju = (n=length(ssclist)) + 1 

	while (ju-jl>1) {
		jm = trunc((ju+jl)/2)
		if ( name > (tokens(ssclist[jm])[1]) ) 	jl = jm 
		else 					ju = jm 
	}
	if (jl<n) { 
		ju = jl
		if ( name == (tokens(ssclist[++ju])[1]) ) return(ju)
	}
	return(0)
}

	
`pkgcode' pkg_update_status_default(`instpkg' pkg)
{
	string colvector	net
	string scalar		ffn
	real scalar		dinstalled, dnet
	real scalar		negrc

	ffn = srcffnof(pkg)

	pragma unset net
	if ((negrc=read_pkg_file(ffn, net))) {
		if (negrc==`NEGRC_NORESPONSE') return(`PKG_NORESPONSE')
		if (negrc==`NEGRC_NOHOST')     return(`PKG_NORESPONSE')
		if (negrc==`NEGRC_NOFILE')     return(`PKG_NOLONGER')
		return(`PKG_CANNOTOPEN')
	}

	dinstalled = distributiondateof(pkg, `PT_INSTALLED')
	dnet       = distributiondateof(net, `PT_NET')

	if (dinstalled<. & dnet<.) {
		if (dinstalled<dnet) {
			set_upinfoof(pkg, srcof(pkg),pkgnameof(pkg))
			return(`PKG_UPDATED')
		}
		return(`PKG_OKAY')
	}

	if (dnet<. & dinstalled>=.) {
		set_upinfoof(pkg, srcof(pkg), pkgnameof(pkg))
		return(`PKG_UPDATED')
	}
	return(`PKG_UNKNOWN')
}

`pkgcode' pkg_update_status_stb(`instpkg' pkg, `updlist' upd)
{
	real scalar	idx
	string scalar	pkgname

	if (pkg_update_status_sj(pkg, upd)==`PKG_UPDATED') {
		return(`PKG_UPDATED')
	}

	pkgname = pkgnameof(pkg)
	if (upd[`L_STB']==NULL) upd[`L_STB'] = &loadupfile(`STBupfile')

	if (idx = findbestinlist(pkgname, *upd[`L_STB'])) {
		set_upinfo_fromupd(pkg, upd, `L_STB', idx, `STBbasesrc')
		return(`PKG_UPDATED')
	}
	return(`PKG_OKAY')
}


`pkgcode' pkg_update_status_sj(`instpkg' pkg, `updlist' upd)
{
	real scalar		idx
	string scalar		pkgname

	pkgname = pkgnameof(pkg)
	if (upd[`L_SJ']==NULL) upd[`L_SJ'] = &loadupfile(`SJupfile')
	if (idx = findbestinlist(pkgname, *upd[`L_SJ'])) {
		set_upinfo_fromupd(pkg, upd, `L_SJ', idx, `SJbasesrc')
		return(`PKG_UPDATED')
	}
	return(`PKG_OKAY')
}

void set_upinfo_fromupd(`instpkg' pkg, 
		`updlist' upd, real scalar l, real scalar i, 
		string scalar basesrc)
{
	string rowvector	toks

	toks = tokens((*upd[l])[i])
	set_upinfoof(pkg, pathjoin(basesrc,toks[1]), toks[2])
}


string colvector loadupfile(string scalar ffn)
{
	real scalar		fh
	string scalar		line
	string colvector	res

	fh = fopen(ffn, "r")

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (strpos(line, "_")) res = res \ line
	}
	fclose(fh)
	return(res)
}

string colvector loadsscupfile()
{
	real scalar	fh
	string scalar	line
	string colvector res

	fh = fopen(`SSCupfile', "r")

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="") {
			res = res \ strlower(subinstr(line,":","",1))
		}
	}
	fclose(fh)
	_sort(res, 1)
	return(res)
}


real scalar findbestinlist(string scalar name, string colvector list)
{
	string scalar	curlhs, newlhs, newname
	real scalar	currhs, newrhs
	real scalar	i, bestidx, bestrhs

	pragma unset newlhs
	pragma unset newrhs
	pragma unset curlhs
	pragma unset currhs

	splitname(name, curlhs, currhs)

	bestrhs = currhs
	bestidx = 0
	for (i=1; i<=rows(list); i++) {
		newname = tokens(list[i])[2]
		splitname(newname, newlhs, newrhs)
		if (newlhs == curlhs) {
			if (newrhs>bestrhs) {
				bestrhs = newrhs
				bestidx = i 
			}
		}
	}
	return(bestidx)
}

void splitname(string scalar name, lhs, rhs)
{
	real scalar	i

	if (i = strpos(name, "_")) {
		lhs = substr(name, 1, i-1)
		rhs = strtoreal(substr(name, i+1, .))
		if (rhs<.) return
	}
	lhs = name
	rhs = -1
}
		

string scalar basepkgname(string scalar name)
{
	real scalar	i

	i = strpos(name, "_")
	return(i ? substr(name, 1, i-1) : name)
}
	
	
/* -------------------------------------------------------------------- */

void find_and_uninst_dups(string scalar dir, `boolean' noisily)
{
	while (1) {
		if (find_and_uninst_1dup_std(dir, noisily)==0) break
	}

	while (1) {
		if (find_and_uninst_1dup_sjstb(dir, noisily)==0) break
	}

	while (1) {
		if (find_and_uninst_1dup_ssc(dir, noisily)==0) break
	}
}

`boolean' find_and_uninst_1dup_std(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	string colvector	lcffn
	string scalar		lcpkgname
	real scalar		i, j

	trk = read_statatrk(dir)

	lcffn = J(rows(trk), 1, "")
	for (i=1; i<=rows(trk); i++) lcffn[i] = strlower(srcffnof(*trk[i]))

	for (i=1; i<rows(lcffn) /*sic*/; i++) {
		for (j=i+1; j<=rows(lcffn); j++) {
			if (lcffn[i]==lcffn[j]) {
				rmdup(dir, trk, i, j, noisily)
				return(1)
			}
		}
	}
	return(0)
}

`boolean' find_and_uninst_1dup_ssc(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	real colvector		isssc
	string colvector	lcpkgname
	real scalar		i, j

	trk = read_statatrk(dir)

	isssc = J(rows(trk), 1, .)
	lcpkgname = J(rows(trk), 1, "")
	for (i=1; i<=rows(trk); i++) {
		isssc[i] = isssc(srcof(*trk[i]))
		lcpkgname[i] = strlower(pkgnameof(*trk[i]))
	}

	for (i=1; i<rows(trk) /*sic*/; i++) {
		if (isssc[i]) {
			for (j=i+1; j<=rows(trk); j++) {
				if (isssc[j]) {
					if (lcpkgname[i]==lcpkgname[j]) {
						rmdup(dir, trk, i, j,
								noisily)
						return(1)
					}
				}
			}
		}
	}
	return(0)
}

`boolean' find_and_uninst_1dup_sjstb(string scalar dir, `boolean' noisily)
{
	`instlist'		trk
	string colvector	lhs
	real colvector		rhs
	string scalar		pkgname, curlhs, src
	`boolean'		touse, hassjstb
	real scalar		i, j, currhs, torm

	trk = read_statatrk(dir)

	lhs = J(rows(trk), 1, "")
	rhs = J(rows(trk), 1, .)
	hassjstb = 0
	for (i=1; i<=rows(trk); i++) {
		src = srcof(*trk[i])
		touse = 0
		if (isstatajournal(src)) touse = 1 
		else if (isstb(src)) touse = 1 
		if (touse) {
			hassjstb = 1
			pkgname = pkgnameof(*trk[i])
			pragma unset curlhs
			pragma unset currhs
			splitname(pkgname, curlhs, currhs)
			lhs[i] = curlhs
			rhs[i] = currhs
		}
	}

	if (!hassjstb) return(0)

	for (i=1; i<rows(trk) /*sic*/; i++) {		
		if (rhs[i]<.) {
			for (j=i+1; j<=rows(trk); j++) {
				if (rhs[j]<.) {
					if (lhs[i]==lhs[j]) {
						torm = (rhs[i]>rhs[j] ? j:i)
						netrm(dir, *trk[torm], noisily)
						return(1)
					}
				}
			}
		}
	}
	return(0)
}

void rmdup(string scalar dir, `instlist' trk, real scalar i, 
					real scalar j, `boolean' noisily)
{
	real scalar	idate, jdate, torm

	idate = installdateof(*trk[i])
	jdate = installdateof(*trk[j])

	if (idate>jdate) 	torm = j
	else if (idate<jdate)	torm = i
	else {
		if (uniqidof(*trk[i])>uniqidof(*trk[j])) torm = j
		else				         torm = i 
	}

	netrm(dir, *trk[torm], noisily)
}

void netrm(string scalar dir, `instpkg' pkg, `boolean' noisily)
{
	string scalar	cmd

	if (noisily) {
		printf("{p}\n")
		printf(
		"{txt}(note: package {res:%s} was installed more than once;\n", 
		 		pkgnameof(pkg))
		printf("older copy removed)\n")
		printf("{p_end}\n") 
	}

	cmd = sprintf("quietly ado uninstall [%g]", relnoof(pkg))
	if (dir!="") cmd = cmd + ", from("+dir+")"
	stata(cmd)
}
/* -------------------------------------------------------------------- */


`instlist' read_statatrk(string scalar dir)
{
	real scalar	fh, i
	string scalar	element
	`instlist'	res
	
	res = J(0,1,NULL)

	if ((fh = _fopen(ffn_of_statatrk(dir), "r")) < 0) {
		errprintf(
		"directory %s does not have user-installed files\n", dir)
		exit(601)
	}

	i = 0
	while((element=read_statatrk_element(fh, ++i))!=J(0,1,"")) {
		res = res \ &acopy(element)
	}
	fclose(fh)
	return(res) 
}


string scalar ffn_of_statatrk(string scalar dir)
{
	string scalar	basedir

	basedir = pathsubsysdir(dir=="" ? "`DEFAULT_DIR'" : dir)
	return(pathjoin(basedir, "stata.trk"))
}

transmorphic matrix acopy(transmorphic matrix x)
{
	transmorphic matrix copy 
	copy = x 
	return(copy)
}

void read_statatrk_skiphdr(real scalar fh)
{
	string scalar	line
	real scalar	pos

	pos = ftell(fh)
	while ((line=fget(fh))!=J(0,0,"")) {
		if (!(substr(line,1,1)=="*" | strtrim(line)=="")) {
			fseek(fh, pos, -1)
			return
		}
		pos = ftell(fh)
	}
}


`instpkg' read_statatrk_element(real scalar fh, real scalar i)
{
	`instpkg' 	res
	string scalar	line

	res = J(`EL_FIRST', 1, "")
	res[`EL_relno'] = sprintf("%g", i)

	read_statatrk_skiphdr(fh)
	if ((line = fget(fh))==J(0,0,"")) return(J(0,1,""))

	if (substr(line, 1, 1)!="S") {
		errprintf("stata.trk file invalid header\n") 
		exit(610)
	}
	res[`EL_FIRST'] = line

	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="" & substr(line,1,1)!="*") {
			res = res \ strrtrim(line)
			if (substr(line,1,1)=="e") return(res)
		}
	}
	errprintf("stata.trk file invalid contents\n") 
	exit(610)
	/*NOTREACHED*/
}



/* -------------------------------------------------------------------- */

real scalar read_pkg_file(string scalar ffn, string colvector res)
{
	real scalar 	fh

	if ((fh = _fopen(ffn, "r")) < 0) {
		res = J(0, 1, "")
		return(fh)
	}
	res = read_pkg_element(fh)
	fclose(fh)
	return(0)
}


string colvector read_pkg_element(real scalar fh)
{
	string colvector res
	string scalar	line

	pragma unset res
	while ((line=fget(fh))!=J(0,0,"")) {
		if (line!="" & substr(line,1,1)!="*") {
			res = res \ strrtrim(line)
		}
	}
	return(res)
}

/* -------------------------------------------------------------------- */

string scalar srcof(`instpkg' pkg)
{
	return(subelementof(pkg, "S"))
}

string scalar titleof(`instpkg' pkg)
{
	string colvector	res

	res = subelementof(pkg, "d")
	return(rows(res)==0 ? "" : res[1])
}

string scalar upsrcof(`instpkg' pkg)
{
	return(pkg[`EL_upsrc'])
}

string scalar srcffnof(`instpkg' pkg)
{
	string scalar	src, fn

	src = srcof(pkg)
	fn  = subelementof(pkg, "N")

	if (rows(src)!=1 | rows(fn)!=1) return("")
	return(pathjoin(src, fn))
}

string scalar pkgnameof(`instpkg' pkg)
{
	string colvector	res
	real scalar		len

	res = subelementof(pkg, "N")
	if (rows(res)!=1) return("")

	len = strlen(res)
	if (substr(res, len-3, .) == ".pkg") return(substr(res, 1, len-4))
	return(res)
}

string scalar uppkgnameof(`instpkg' pkg)
{
	return(pkg[`EL_uppkgname'])
}


real scalar uniqidof(`instpkg' pkg)
{
	string colvector	res
	real scalar		uid

	res = subelementof(pkg, "U")
	if (rows(res)==1) {
		uid = strtoreal(res)
		if (uid<.) return(uid)
	}
		
	pkg_corrupt()
	/*NOTREACHED*/
}

real scalar relnoof(`instpkg' pkg)
{
	real scalar	rel

	if ((rel = strtoreal(pkg[`EL_relno'])) < .) return(rel)
	pkg_corrupt()
	/*NOTREACHED*/
}


real scalar installdateof(`instpkg' pkg)
{
	string colvector	res
	real scalar		edate

	res = subelementof(pkg, "D")
	if (rows(res)==1) {
		edate = date(res, "dmy")
		if (edate<.) return(edate)
	}
	pkg_corrupt()
	/*NOTREACHED*/
}
		

real scalar distributiondateof(`instpkg' pkg, `pkgtype' ptype)
{
	real scalar		i
	string colvector	d
	real scalar		e, emax

	d = distributiondatesof(pkg, ptype)
	
	emax = 0
	for (i=1; i<=rows(d); i++) {
		e = edateofstr(d[i])
		if (e>emax & e<.) emax = e
	}
	return(emax ? emax : .)
}

	
string colvector distributiondatesof(`instpkg' pkg, `pkgtype' ptype)
{
	real scalar		i
	string colvector	d
	string colvector	res

	d = (ptype==`PT_INSTALLED' ? 
		subelementof(pkg, "d") : 
		subelementnet(pkg, "d")
	    )

	pragma unset res
	for (i=1; i<=rows(d); i++) {
		/* ----+----1----+--- */
                /* Distribution-Date: */
		if (strlower(substr(d[i], 1, 18))=="distribution-date:") {
			res = res \ strlower(strtrim(substr(d[i], 19, .)))
		}
	}
	return(res)
}
		

string colvector subelementof(`instpkg' pkg, string scalar ltr)
{
	real scalar		i
	string colvector	res

	pragma unset res
	for (i=`EL_FIRST'; i<=rows(pkg); i++) {
		if (substr(pkg[i],1,1)==ltr) {
			res = res \ strtrim(substr(pkg[i],2,.))
		}
	}
	return(res)
}

string colvector subelementnet(string colvector gel, string scalar ltr)
{
	real scalar		i
	string colvector	res

	pragma unset res
	for (i=1; i<=rows(gel); i++) {
		if (substr(gel[i],1,1)==ltr) {
			res = res \ strtrim(substr(gel[i],2,.))
		}
	}
	return(res)
}

void set_upinfoof(`instpkg' pkg, string scalar src, string scalar pkgname)
{
	pkg[`EL_upsrc']     = src
	pkg[`EL_uppkgname'] = pkgname
}

void pkg_corrupt()
{
	errprintf("stata.trk file invalid or corrupted\n")
	errprintf("no action taken\n")
	exit(610)
	/*NOTREACHED*/
}


/* -------------------------------------------------------------------- */

real scalar edateofstr(string scalar s)
{
	real scalar	res
	real scalar	yr, mo, da

	if (strlen(s)==8) {
		yr = strtoreal(substr(s, 1, 4))
		mo = strtoreal(substr(s, 5, 2))
		da = strtoreal(substr(s, 7, 2))
		if (yr<. & mo<. & da<.) {
			res = mdy(mo, da, yr)
			if (res!=.) return(res)
		}
	}
	return(date(s, "dmy"))
}


real scalar docmd(string scalar rhs)
{
	real scalar	res
	
	stata("scalar DoCmdStringScalar = " + rhs)
	res = st_numscalar("DoCmdStringScalar")
	stata("scalar drop DoCmdStringScalar")
	return(res)
}
	

/*
real scalar mdy(real mo, real da, real yr)
{
	return(docmd(sprintf("mdy(%g, %g, %g)", mo, da, yr)))
}

real scalar date(string scalar str, string scalar pattern)
{
	return(docmd(sprintf(`"date("%s", "%s")"', str, pattern)))
}
*/



/* -------------------------------------------------------------------- */

end

</pre>
</li>
</ul>
</li>
</ul>


<ul class="blockList">
<li class="blockList">
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== TOKENS =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Tokens</h3>
 <span style="font-size: 24pt;"><a class="tokens" href="../tokens/a.html#ado">ado</a></span>&nbsp;&nbsp;
<span style="font-size: 11pt;"><a class="tokens" href="../tokens/a.html#adoupdate">adoupdate</a></span>&nbsp;&nbsp;
<span style="font-size: 7pt;"><a class="tokens" href="../files/a_adoupdate.ado.html">adoupdate ado</a></span>&nbsp;&nbsp;
</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ========= START OF BOTTOM NAVBAR ========= -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/a_adopath.ado.html" title="a/adopath.ado">Prev</a>	
	</li>
<li>
    <a href="../files/a_adoupdate.dlg.html" title="a/adoupdate.dlg" >Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../index.html?files/a_adoupdate.ado.html" target="_top">Frames</a></li>
<li><a href="../files/a_adoupdate.ado.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ========= END OF BOTTOM NAVBAR ========= -->
</body>
</html>