<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<!-- Generated by statdoc (version v0.9.2-beta) on 2015-09-18 03:37:04 -->
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<title>base</title>
<meta name="date" content="2015-09-18">
<script src="../d3.min.js"></script>
<script src="../statdoc.js"></script>
</head>
<body>

<!-- ========= START OF TOP NAVBAR ========= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/h_hreg.sthlp.html" title="h/hreg.sthlp">Prev</a>	
	</li>
<li>
    <a href="../files/h_hsearch.dlg.html" title="h/hsearch.dlg">Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../compare.html?files/h_hsearch.ado.html" target="_top">Compare</a></li>
<li><a href="../index.html?files/h_hsearch.ado.html" target="_top">Frames</a></li>
<li><a href="../files/h_hsearch.ado.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= --><!-- ======== START OF FILE DATA ======== -->
<div class="header">
<div class="subTitle">base</div>
<h2 title="Statdoc File hsearch.ado" class="title">File hsearch.ado</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>
<table border="0" style="border-collapse: collapse;table-layout: auto;width: auto;">
  <colgroup>
    <col span="1" width="200px">
    <col width="10px" style="text-align:center;">
    <col width="200px">
    <col width="10px" style="text-align:center;">
    <col span="1" width="200px">
  </colgroup>
<tr class="inheritance">
<td style="border: none;"></td>
<td style="text-align:center;background: #eeeeee;">&rarr;</td>
<td  style="background: #eeeeee;">
<span style="background: #eeeeee;"><b>h/hsearch.ado</b></span>
</td>
<td style="text-align:center;background: #eeeeee;">&#8600;</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>

<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><span class="strong">h/hsearch.ado <a href="../h/hsearch.ado">open</a></span>
file:script:ado</pre>
</li>
</ul>

</div>
<ul class="blockList">
<li class="blockList">
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">date</td>
  <td class="colLast">Fri Jun 17 07:42:40 AEST 2011</td>
  </tr>
    </tbody>
  </table>
</li>
</ul>




<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Variable Summary table, listing datasets and labels">
<caption><span><a name="variables"><!-- --></a>All commands</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" style="width:30px" scope="col">#</th>
<th class="colLast" width="100%" scope="col">content
<!-- <span style="float: right;">&nbsp;<a title="Raw Source" onclick="toggle('rawframe');setIframeHeight('rawframe');">raw</a> -->
</th>
<!--
<td style="display:none;" id="rawframe" rowspan="50" height="100%">
<iframe scrolling="yes" width="600px" height="100%" src="../files/h_hsearch.ado.html#content" name="statdocSubFrame_raw" title="Raw File" style="height: 100%; width: 600px; overflow-x:scroll; overflow-y:scroll; -ms-overflow-x:scroll; -ms-overflow-y:scroll;"></iframe>
</td>
-->
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *! version 1.2.0  09jun2011</div></td>
</tr>
<tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="2" title="program"><!-- -->
    2</a>&nbsp;<a onclick='toggle("cmd_983109047");' title="program">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">program</span>
  <span class="cmdparameters"><a href="../tokens/h.html#hsearch">hsearch</a></span>
<div id="cmd_983109047" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">*! version 1.2.0  09jun2011
program hsearch</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">program</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/h.html#hsearch">hsearch</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="3" title="version"><!-- -->
    3</a>&nbsp;<a onclick='toggle("cmd_2138018493");' title="version">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">version</span>
  <span class="cmdparameters">9</span>
<div id="cmd_2138018493" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	version 9</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">version</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">9</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="5" title="syntax"><!-- -->
    5</a>&nbsp;<a onclick='toggle("cmd_220665338");' title="syntax">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">syntax</span>
  <span class="cmdparameters">[<a href="../tokens/a.html#anything">anything(</a><a href="../tokens/e.html#equalok">equalok</a> <a href="../tokens/e.html#everything">everything</a>)] [, <a href="../files/h_hsearch.ado.html#5">BUILD</a>]</span>
<div id="cmd_220665338" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	syntax [anything(equalok everything)] [, BUILD]</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">syntax</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">[<a href="../tokens/a.html#anything">anything(</a><a href="../tokens/e.html#equalok">equalok</a> <a href="../tokens/e.html#everything">everything</a>)] [, <a href="../files/h_hsearch.ado.html#5">BUILD</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="7" title="local"><!-- -->
    7</a>&nbsp;<a onclick='toggle("cmd_-1023531236");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/d.html#didsomething">didsomething</a> 0</span>
<div id="cmd_-1023531236" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local didsomething 0</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/d.html#didsomething">didsomething</a> 0</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="8" title="if"><!-- -->
    8</a>&nbsp;<a onclick='toggle("cmd_-96914208");' title="if">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">if</span>
  <span class="cmdparameters">("<a href="../tokens/b.html#build">`build'</a>"!="") {</span>
<div id="cmd_-96914208" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	if ("`build'"!="") {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">if</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">("<a href="../tokens/b.html#build">`build'</a>"!="") {</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="9" title="hsearch_build()"><!-- -->
    9</a>&nbsp;<a onclick='toggle("cmd_1966825039");' title="hsearch_build()">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdprefix"><a href="../tokens/m.html#mata">mata</a>:</span>
 <span class="cmdcommand">hsearch_build()</span>
  <span class="cmdparameters"></span>
<div id="cmd_1966825039" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		mata: hsearch_build()</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">hsearch_build()</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">prefix</td>
  <td class="colLast"><a href="../tokens/m.html#mata">mata</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="10" title="local"><!-- -->
    10</a>&nbsp;<a onclick='toggle("cmd_-99686463");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/d.html#didsomething">didsomething</a> 1</span>
<div id="cmd_-99686463" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		local didsomething 1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/d.html#didsomething">didsomething</a> 1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="11" title="}"><!-- -->
    11</a>&nbsp;<a onclick='toggle("cmd_1558205729");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_1558205729" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="13" title="if"><!-- -->
    13</a>&nbsp;<a onclick='toggle("cmd_-947129032");' title="if">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">if</span>
  <span class="cmdparameters">(`"<a href="../tokens/a.html#anything">`anything'</a>"' != "") {</span>
<div id="cmd_-947129032" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	if (`"`anything'"' != "") {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">if</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(`"<a href="../tokens/a.html#anything">`anything'</a>"' != "") {</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="14" title="local"><!-- -->
    14</a>&nbsp;<a onclick='toggle("cmd_570927919");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/d.html#didsomething">didsomething</a> 1</span>
<div id="cmd_570927919" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		local didsomething 1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/d.html#didsomething">didsomething</a> 1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="15" title="tempfile"><!-- -->
    15</a>&nbsp;<a onclick='toggle("cmd_1790898306");' title="tempfile">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">tempfile</span>
  <span class="cmdparameters"><a href="../tokens/f.html#fn">fn</a></span>
<div id="cmd_1790898306" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		tempfile fn</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">tempfile</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/f.html#fn">fn</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="16" title="hsearch_search(`"`anything'"',"><!-- -->
    16</a>&nbsp;<a onclick='toggle("cmd_-175396235");' title="hsearch_search(`"`anything'"',">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdprefix"><a href="../tokens/m.html#mata">mata</a>:</span>
 <span class="cmdcommand">hsearch_search(`"`anything'"',</span>
  <span class="cmdparameters"> `"<a href="../tokens/f.html#fn">`fn'</a>"')</span>
<div id="cmd_-175396235" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		mata: hsearch_search(`"`anything'"', `"`fn'"')</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">hsearch_search(`"`anything'"',</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"> `"<a href="../tokens/f.html#fn">`fn'</a>"')</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">prefix</td>
  <td class="colLast"><a href="../tokens/m.html#mata">mata</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="17" title="if"><!-- -->
    17</a>&nbsp;<a onclick='toggle("cmd_412135994");' title="if">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">if</span>
  <span class="cmdparameters">("<a href="../tokens/s.html#S_CONSOLE">$S_CONSOLE</a>"=="") <a href="../tokens/v.html#view">view</a> `"<a href="../tokens/f.html#fn">`fn'</a>"'</span>
, <span class="cmdoptions"> <a href="../tokens/s.html#smcl">smcl</a></span>
<div id="cmd_412135994" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		if ("$S_CONSOLE"=="") view `"`fn'"', smcl</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">if</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/s.html#smcl">smcl</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">("<a href="../tokens/s.html#S_CONSOLE">$S_CONSOLE</a>"=="") <a href="../tokens/v.html#view">view</a> `"<a href="../tokens/f.html#fn">`fn'</a>"'</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="18" title="else"><!-- -->
    18</a>&nbsp;<a onclick='toggle("cmd_2040082248");' title="else">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">else</span>
  <span class="cmdparameters"><a href="../variables/type.html">type</a> `"<a href="../tokens/f.html#fn">`fn'</a>"'</span>
, <span class="cmdoptions"> <a href="../tokens/s.html#smcl">smcl</a></span>
<div id="cmd_2040082248" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		else 		      type `"`fn'"', smcl</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">else</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/s.html#smcl">smcl</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/type.html">type</a> `"<a href="../tokens/f.html#fn">`fn'</a>"'</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="19" title="}"><!-- -->
    19</a>&nbsp;<a onclick='toggle("cmd_1061960313");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_1061960313" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="20" title="if"><!-- -->
    20</a>&nbsp;<a onclick='toggle("cmd_740409232");' title="if">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">if</span>
  <span class="cmdparameters">(<a href="../tokens/d.html#didsomething">`didsomething'</a>==0) {</span>
<div id="cmd_740409232" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	if (`didsomething'==0) {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">if</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/d.html#didsomething">`didsomething'</a>==0) {</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="21" title="di"><!-- -->
    21</a>&nbsp;<a onclick='toggle("cmd_109063089");' title="di">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">di</span>
  <span class="cmdparameters"><a href="../tokens/a.html#as">as</a> <a href="../tokens/e.html#err">err</a></span>
  <span class="cmdcomment">///
"type {cmd:hsearch} followed by keyword(s), such as {cmd:hsearch Mills' ratio}"</span>
<div id="cmd_109063089" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		di as err ///
"type {cmd:hsearch} followed by keyword(s), such as {cmd:hsearch Mills' ratio}"</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">di</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">///
"type {cmd:hsearch} followed by keyword(s), such as {cmd:hsearch Mills' ratio}"</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/a.html#as">as</a> <a href="../tokens/e.html#err">err</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="23" title="exit"><!-- -->
    23</a>&nbsp;<a onclick='toggle("cmd_1161150647");' title="exit">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">exit</span>
  <span class="cmdparameters">198</span>
<div id="cmd_1161150647" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		exit 198</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">exit</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">198</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="24" title="}"><!-- -->
    24</a>&nbsp;<a onclick='toggle("cmd_245530898");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_245530898" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="25" title="end"><!-- -->
    25</a>&nbsp;<a onclick='toggle("cmd_1676564764");' title="end">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">end</span>
  <span class="cmdparameters"></span>
<div id="cmd_1676564764" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">end</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">end</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> /* -------------------------------------------------------------------- */</div></td>
</tr>
<tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="28" title="local"><!-- -->
    28</a>&nbsp;<a onclick='toggle("cmd_-439379930");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/h_hsearch.ado.html#28">PARSECHARS</a>	`"" ()[]:;</span>
, <span class="cmdoptions">+-/{}\'.<=>?^|~#" + <a href="../tokens/c.html#char">char(</a>96)"'</span>
<div id="cmd_-439379930" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* -------------------------------------------------------------------- */
local PARSECHARS	`"" ()[]:;,+-/{}\'.<=>?^|~#" + char(96)"'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast">+-/{}\'.<=>?^|~#" + <a href="../tokens/c.html#char">char(</a>96)"'</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/h_hsearch.ado.html#28">PARSECHARS</a>	`"" ()[]:;</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="29" title="local"><!-- -->
    29</a>&nbsp;<a onclick='toggle("cmd_1722816036");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/h_hsearch.ado.html#29">IDXFILENAME</a>	`""<a href="../tokens/s.html#sthlpindex">sthlpindex</a>.<a href="../tokens/i.html#idx">idx</a>""'</span>
<div id="cmd_1722816036" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local IDXFILENAME	`""sthlpindex.idx""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/h_hsearch.ado.html#29">IDXFILENAME</a>	`""<a href="../tokens/s.html#sthlpindex">sthlpindex</a>.<a href="../tokens/i.html#idx">idx</a>""'</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="30" title="local"><!-- -->
    30</a>&nbsp;<a onclick='toggle("cmd_-351183879");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../files/h_hsearch.ado.html#30">SIGNATURE</a>		`""<a href="../tokens/s.html#sthlpindex">sthlpindex</a>.<a href="../tokens/i.html#idx">idx</a> 1.02""'</span>
<div id="cmd_-351183879" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">local SIGNATURE		`""sthlpindex.idx 1.02""'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/h_hsearch.ado.html#30">SIGNATURE</a>		`""<a href="../tokens/s.html#sthlpindex">sthlpindex</a>.<a href="../tokens/i.html#idx">idx</a> 1.02""'</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="32" title="version"><!-- -->
    32</a>&nbsp;<a onclick='toggle("cmd_2139637306");' title="version">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">version</span>
  <span class="cmdparameters">9</span>
<div id="cmd_2139637306" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">version 9</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">version</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">9</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_mata altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="34" title="mata"><!-- -->
    34</a>&nbsp;<a onclick='toggle("cmd_979334358");' title="mata">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">mata</span>
  <span class="cmdcomment">block (547 lines)</span>
<div id="cmd_979334358" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
mata: 

void hsearch_build()
{
	real scalar		fh, i, target, incr, inccnt
	string scalar		tmpfile
	string colvector	filenames
	string colvector	uniq, line5
	real colvector		cnt


	fh = hsearch_fopenidx("w")

	filenames = uniqrows(dirsearch("*.sthlp") \ dirsearch("*.hlp"))
	tmpfile = st_tempfilename()

	printf("{txt}(building index ") 
	displayflush()

	incr = target = round(rows(filenames)/50, 1)
	inccnt = 0

	for (i=1; i<=rows(filenames); i++) {
		filenames[i] = FindHelpFile(filenames[i])
		if (i >= target) {
			if (mod(2*(++inccnt), 10)==0) {
				printf("%g%%", 2*inccnt)
			}
			else	printf(".")
			displayflush() 
			target = target + incr
		}
		hsearch_build_1(findfile(filenames[i]), tmpfile, 
							uniq, cnt, line5)
		fputmatrix(fh, filenames[i])
		fputmatrix(fh, line5)
		fputmatrix(fh, uniq)
		fputmatrix(fh, cnt)
	}
	fclose(fh)
	printf(")\n")
}


void hsearch_search(string scalar txt, string scalar logfilename)
{
	real scalar		i, j, nh, builton, days
	real scalar		fh, score
	transmorphic		filename
	string colvector	uniq, resfn, line5
	string matrix		rescm
	real colvector		cnt, ressc, idx
	string rowvector	ctxt

	ctxt = hsearch_search_cleantxt(txt)

	resfn = J(0, 1, "")
	ressc = J(0, 1, .)
	rescm = J(0, 5, "")

	pragma unset builton
	fh = hsearch_fopenidx("r", builton)

	nh = 0 
	while ( (filename=_fgetmatrix(fh))!=J(0,0,.) ) {
		nh++
		line5= fgetmatrix(fh)
		uniq = fgetmatrix(fh)
		cnt  = fgetmatrix(fh)
		if (score = hsearch_search_score(ctxt, uniq, cnt)) {
			if (strpos(filename, "whatsnew")) score = 0
			resfn = resfn \ filename
			ressc = ressc \ score
			rescm = rescm \ line5'
		}
	}
	fclose(fh)
	idx = order(ressc, -1)
	_collate(ressc, idx)
	_collate(resfn, idx)
	_collate(rescm, idx)


	/* --------------------------------------------------------------- */

	fh = fopen(logfilename, "w")

	fput(fh, "{smcl}")
	fput(fh, "")

	fput(fh, "        {c TLC}{hline 60}{c TRC}")
	fwrite(fh, "hsearch {c |}")
	st_global("HSEARCH_QUERY", txt)
	fwrite(fh, sprintf(`"{bf:{dialog hsearch:%s}}"', txt))
	fput(fh, "{col 70}{c |}")

	fput(fh, "        {c BLC}{hline 60}{c BRC}")

	fput(fh, sprintf(
		"{col 9}{rm}(%g help files searched; %g matches found)",
		nh, rows(ressc)))

	days = hsearch_todaysdate()-builton
	fput(fh, "")
	fput(fh, "{p 8 9 2}")
	fwrite(fh, "(results based on help index built ")
	if (days==0) fput(fh, "today;")
	else if (days==1) fput(fh, "yesterday;")
	else	fput(fh, sprintf("%g days ago;", days))
	fput(fh, `"type -{bf:{stata "hsearch, build"}}- to rebuild index.)"')
	fput(fh, "{p_end}")

	fput(fh, "{rm}{hline}")
	fput(fh, "")

	
	for (i=1; i<=rows(ressc); i++) {

		if (i<10) fput(fh, sprintf("{p 6 10 2}"))
		else if (i<100)  fput(fh, sprintf("{p 5 10 2}"))
		else if (i<1000) fput(fh, sprintf("{p 4 10 2}"))
		else 		 fput(fh, sprintf("{p 3 10 2}"))
		fwrite(fh, sprintf("{txt}"))
		fput(fh, sprintf("%g.", i))
		fput(fh, sprintf("{ul:{bf:{help %s}}}{break}", 
				pathrmsuffix(resfn[i])
				))
		fput(fh, sprintf("(score %g){break}", ressc[i]) )
		for (j=1; j<cols(rescm); j++) {
			fput(fh, sprintf("%s /", rescm[i,j]))
		}
		fput(fh, sprintf("%s", rescm[i,j]))
		fput(fh, "")
	}
	fclose(fh)
}

/* ----------------------------------------------------------------------- */

real scalar hsearch_fopenidx(string scalar mode, |builton)
{
	real scalar	fh, done
	string scalar	basedir, idxfullname, signature
	
	basedir     = pathsubsysdir("PERSONAL")
	idxfullname = pathjoin(basedir, `IDXFILENAME')
	signature   = `SIGNATURE'

	/* ------------------------------------------------------------ */
	if (mode=="w") {
		if (fileexists(idxfullname)) unlink(idxfullname)
		recursive_mkdir(basedir)
		fh = fopen(idxfullname, "w")
		fput(fh, signature)
		fputmatrix(fh, hsearch_todaysdate())
		return(fh)
	}
	/* ------------------------------------------------------------ */

	for (done=0; 1; done=1) {
		if ( (fh = _fopen(idxfullname, "r")) >= 0) {
			if (fget(fh) == signature) { 
				builton = fgetmatrix(fh)
				if (builton >= hsearch_updatedate()) return(fh)
			}
			fclose(fh)
		}
		if (done) _error("hsearch failure")
		hsearch_build()
	}
	/*NOTREACHED*/
}

real scalar hsearch_todaysdate() return(hsearch_dmy(c("current_date")))

real scalar hsearch_updatedate()
{
	real scalar	fh, res
	string scalar	s

	if ((fh = _fopen(findfile("update"), "r"))<0) return(0) 
	s = fget(fh)
	fclose(fh)

	res = hsearch_dmy(s)
	return(res<. ? res : 0)
}

real scalar hsearch_dmy(string scalar dmystr)
{
	real scalar	result
	string scalar 	name

	name = st_tempname()
	stata("scalar " + name + `"=date(""' + dmystr + `"", "dmy")"')
	result = st_numscalar(name)
	stata("scalar drop " + name)
	return(result)
}


	
void hsearch_build_1(string scalar fullfilename, string scalar tmpname, 
		uniq, cnt, line5)
{
	real scalar		i, k, n
	real scalar		complete
	real scalar		fh
	string scalar		str, line, parse, base
	string colvector	words

	parse = `PARSECHARS'

	stata(`"quietly translate ""' + 
		fullfilename + `"" ""' + 
		tmpname + `"", trans(smcl2txt) logo(off)"')

	str = ""
	line5 = J(5,1,"")
	fh = fopen(tmpname, "r")
	i = 1
	while ((line=fget(fh))!=J(0,0,"")) {
		line = strtrim(line)
		if (line != "") {
			if (line != strlen(line)*"-") {
				if (i<=5) line5[i++] = strtrim(line)
				line = subinstr(line, `"""', "")
				str = str + " " + strlower(line)
			}
		}
	}
	fclose(fh)
	unlink(tmpname)
	words = sort(tokens(str, parse)', 1)

	uniq = J(rows(words), 1, "")
	cnt  = J(rows(words), 1, 0)
	if (rows(words)==0) return

	k = n = 0 
	base = words[1]
	for (i=2; i<=rows(words)+1; i++) {
		if (i>rows(words)) 	 complete = 2 
		else if (words[i]!=base) complete = 1 
		else 			 complete = 0 

		if (complete) {
			if (strlen(base)==0) complete = 0 
			else if (strlen(base)==1) {
				if (strpos(parse, base)) complete = 0
			}
			if (complete) {
				uniq[++k] = base
				cnt[k]    = n
			}
			if (i<=rows(words)) {
				base = words[i]
				n    = 1 
			}
		}
		else	n = n + 1
	}
	uniq = uniq[|1 \ k|]
	cnt  = cnt[|1 \ k|]
}

/* ----------------------------------------------------------------------- */

string colvector dirsearch(string scalar pattern, |string scalar upath)
{
	real scalar		i
	string rowvector	path, tok
	string colvector	res
	
	/* ----------------------------------------------- obtain path --- */
	if (upath=="") path = pathlist() 
	else {
		tok = tokens(upath)
		res = J(1, 0, "")
		for (i=1; i<=length(tok); i++) {
			if (tok[i]!=";") path = path, tok[i]
		}
	}
	/* --------------------------------------------------------------- */

	res = J(0, 1, "")
	for (i=1; i<=length(path); i++) {
		res = res \ dirsearch_dir(path[i], pattern)
	}
	return(uniqrows(res))
}

/*static*/ string colvector dirsearch_dir(string scalar udir, 
						string scalar pattern)
{
	real scalar		i
	string scalar		dir, c
	string colvector	subdirs, res, files
	real scalar		lenext

	dir = (udir=="." ? "." : pathsubsysdir(udir))

	res = J(0, 1, "")
	if (pattern=="") return(res)


	c = substr(pattern,1,2)
	lenext = strlen(pattern) - 1
	if (c=="*.") {
		subdirs = dir(dir, "dirs", "*")
		for (i=1; i<=length(subdirs); i++) {
			if (strlen(subdirs[i])==1) {
				files = dir(pathjoin(dir, subdirs[i]), "files",
								pattern)
				if (length(files) > 0) {
					res = res \
						substr(files, 1,
							 strlen(files):-lenext)
				}
			}
		}
	}
	else 	{
		errprintf("hsearch: assumption failure")
		exit(9653)
	}

	files = dir(dir, "files", pattern)
	if (length(files) > 0) {
		return(uniqrows(res\ substr(files, 1, strlen(files):-lenext)))
	}
	return(uniqrows(res))
}

/* ----------------------------------------------------------------------- */

string scalar FindHelpFile(string scalar fname, |string scalar upath)
{
	real scalar		i
	string rowvector	path, tok
	string scalar		res
	
	/* ----------------------------------------------- obtain path --- */
	if (upath=="") path = pathlist() 
	else {
		tok = tokens(upath)
		for (i=1; i<=length(tok); i++) {
			if (tok[i]!=";") path = path, tok[i]
		}
	}
	/* --------------------------------------------------------------- */

	for (i=1; i<=length(path); i++) {
		res = FindHelpFileWrk(path[i], fname)
		if (res != "") {
			return(res)
		}
	}
	return(fname+".sthlp")	// should be rare, and will cause an error
				// message later
}

/*static*/ string scalar FindHelpFileWrk(string scalar udir,
						string scalar fname)
{
	real scalar		i
	string scalar		dir, c
	string scalar		totry1, totry2, totry3

	dir = (udir=="." ? "." : pathsubsysdir(udir))

	// main directory search
	totry2 = fname + ".sthlp"
	totry3 = pathjoin(dir, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}
	totry2 = fname + ".hlp"
	totry3 = pathjoin(dir, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}

	// lettered subdirectory search
	totry1 = pathjoin(dir, adosubdir(fname))
	totry2 = fname + ".sthlp"
	totry3 = pathjoin(totry1, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}
	totry2 = fname + ".hlp"
	totry3 = pathjoin(totry1, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}

	// not found
	return("")
}

/* ----------------------------------------------------------------------- */

void recursive_mkdir(string scalar path, |real scalar pub)
{
	real scalar		i
	string scalar		head, tail
	string colvector	pieces

	if (!strlen(pieces = path)) return
	if (pathisurl(pieces)) _error("URL found where path required")
	if (direxists(pieces)) return	

	pragma unset head
	pragma unset tail

	mypathsplit(pieces, head, tail)
	while (strlen(head)) {
		pieces = pieces \ head
		mypathsplit(head, head, tail)
	}

	if (args()==1) pub = 0
	for (i=rows(pieces); i; i--) {
		if (!direxists(pieces[i])) mkdir(pieces[i], pub)
	}
}

/*
	what follows is official replacement code for built-in function 
	pathsplit().
*/

void mypathsplit(string scalar upath, ulhs, urhs)
{
	real scalar 	len, i1, i2, i
	string scalar	path
	string scalar	c

	len = strlen(path = upath)
	if (!len) {
		ulhs = urhs = ""
		return
	}
	if (len==1) {
		ulhs = ""
		urhs = path
		return 
	}

	/* ------------------------------------------------------------ */
	if (pathisurl(path)) {
		c = substr(path, 1, 7)
		mypathsplit(substr(path, 8, .), ulhs, urhs)
		if (ulhs!="") ulhs = c + ulhs
		else	      urhs = c + urhs
		return 
	}
	if (substr(path, 2, 1)==":") {
		c = substr(path, 1, 2)
		mypathsplit(substr(path, 3, .), ulhs, urhs)
		if (ulhs!="") ulhs = c + ulhs
		else	      urhs = c + urhs
		return 
	}
	if (substr(path,1,1)=="\" & substr(path,2,1)=="\") {
		mypathsplit(substr(path, 3, .), ulhs, urhs)
		if (ulhs!="") ulhs = "\\" + ulhs
		else	      urhs = "\\" + urhs
		return 
	}
	/* ------------------------------------------------------------ */


	path = strreverse(path)
	c = substr(path, 1, 1)
	if (c=="/" | c=="\") path = substr(path, 2, .)

	i1 = strpos(path, "/")
	i2 = strpos(path, "\") 

	if (!i1 & !i2) {
		ulhs = ""
		urhs = strreverse(path)
		return 
	}
	i = (i1 ? (i2 ? (i1<i2 ? i1: i2) : i1) : i2)

	urhs = strreverse(substr(path, 1, i-1))
	if ((ulhs = strreverse(substr(path, i+1, .)))=="") {
		ulhs = substr(path, i, 1)
	}
}



/* ----------------------------------------------------------------------- */


string rowvector hsearch_search_cleantxt(string scalar txt)
{
	string scalar	s

	s = subinstr(strlower(txt), `"""', "")
	s = subinstr(s, `"'"', "")
	return(tokens(s, `PARSECHARS'))
}


real scalar hsearch_search_score(string vector words, 
			string vector uniq, real vector cnt)
{
	real scalar	i, m, a
	real scalar	idx
	
	m = 1 
	a = 0
	for (i=1; i<=length(words); i++) {
		if (idx=hsearch_binsearch(words[i], uniq)) {
			m = m * cnt[idx]
			a = a + cnt[idx]
		}
		else {
			m = 0 
		}
	}
	// return(trunc((100*m+a)/sqrt(colsum(cnt))))
	return(100*m+a)
}
		

real scalar hsearch_binsearch(string scalar word, string vector list)
{
	real scalar	top, bot, k

	bot = 1 
	top = length(list)

	while (bot <= top) {
		k = trunc((top+bot)/2)
		if (word==list[k]) return(k)
		if (word < list[k]) top = k - 1
		else 		    bot = k + 1
	}
	return(0) 
}

end</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">mata</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">block (547 lines)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
</table>
</li>
</ul>


<a name="content"><!--   --></a>
<!-- ========== CONTENT =========== -->
<ul class="blockList">
<li class="blockList">
<ul class="blockList">
<li class="blockList">
<h3>Content</h3>
<pre>
*! version 1.2.0  09jun2011
program hsearch
	version 9

	syntax [anything(equalok everything)] [, BUILD]

	local didsomething 0
	if ("`build'"!="") {
		mata: hsearch_build()
		local didsomething 1
	}

	if (`"`anything'"' != "") {
		local didsomething 1
		tempfile fn
		mata: hsearch_search(`"`anything'"', `"`fn'"')
		if ("$S_CONSOLE"=="") view `"`fn'"', smcl
		else 		      type `"`fn'"', smcl
	}
	if (`didsomething'==0) {
		di as err ///
"type {cmd:hsearch} followed by keyword(s), such as {cmd:hsearch Mills' ratio}"
		exit 198
	}
end

/* -------------------------------------------------------------------- */
local PARSECHARS	`"" ()[]:;,+-/{}\'.<=>?^|~#" + char(96)"'
local IDXFILENAME	`""sthlpindex.idx""'
local SIGNATURE		`""sthlpindex.idx 1.02""'

version 9

mata: 

void hsearch_build()
{
	real scalar		fh, i, target, incr, inccnt
	string scalar		tmpfile
	string colvector	filenames
	string colvector	uniq, line5
	real colvector		cnt


	fh = hsearch_fopenidx("w")

	filenames = uniqrows(dirsearch("*.sthlp") \ dirsearch("*.hlp"))
	tmpfile = st_tempfilename()

	printf("{txt}(building index ") 
	displayflush()

	incr = target = round(rows(filenames)/50, 1)
	inccnt = 0

	for (i=1; i<=rows(filenames); i++) {
		filenames[i] = FindHelpFile(filenames[i])
		if (i >= target) {
			if (mod(2*(++inccnt), 10)==0) {
				printf("%g%%", 2*inccnt)
			}
			else	printf(".")
			displayflush() 
			target = target + incr
		}
		hsearch_build_1(findfile(filenames[i]), tmpfile, 
							uniq, cnt, line5)
		fputmatrix(fh, filenames[i])
		fputmatrix(fh, line5)
		fputmatrix(fh, uniq)
		fputmatrix(fh, cnt)
	}
	fclose(fh)
	printf(")\n")
}


void hsearch_search(string scalar txt, string scalar logfilename)
{
	real scalar		i, j, nh, builton, days
	real scalar		fh, score
	transmorphic		filename
	string colvector	uniq, resfn, line5
	string matrix		rescm
	real colvector		cnt, ressc, idx
	string rowvector	ctxt

	ctxt = hsearch_search_cleantxt(txt)

	resfn = J(0, 1, "")
	ressc = J(0, 1, .)
	rescm = J(0, 5, "")

	pragma unset builton
	fh = hsearch_fopenidx("r", builton)

	nh = 0 
	while ( (filename=_fgetmatrix(fh))!=J(0,0,.) ) {
		nh++
		line5= fgetmatrix(fh)
		uniq = fgetmatrix(fh)
		cnt  = fgetmatrix(fh)
		if (score = hsearch_search_score(ctxt, uniq, cnt)) {
			if (strpos(filename, "whatsnew")) score = 0
			resfn = resfn \ filename
			ressc = ressc \ score
			rescm = rescm \ line5'
		}
	}
	fclose(fh)
	idx = order(ressc, -1)
	_collate(ressc, idx)
	_collate(resfn, idx)
	_collate(rescm, idx)


	/* --------------------------------------------------------------- */

	fh = fopen(logfilename, "w")

	fput(fh, "{smcl}")
	fput(fh, "")

	fput(fh, "        {c TLC}{hline 60}{c TRC}")
	fwrite(fh, "hsearch {c |}")
	st_global("HSEARCH_QUERY", txt)
	fwrite(fh, sprintf(`"{bf:{dialog hsearch:%s}}"', txt))
	fput(fh, "{col 70}{c |}")

	fput(fh, "        {c BLC}{hline 60}{c BRC}")

	fput(fh, sprintf(
		"{col 9}{rm}(%g help files searched; %g matches found)",
		nh, rows(ressc)))

	days = hsearch_todaysdate()-builton
	fput(fh, "")
	fput(fh, "{p 8 9 2}")
	fwrite(fh, "(results based on help index built ")
	if (days==0) fput(fh, "today;")
	else if (days==1) fput(fh, "yesterday;")
	else	fput(fh, sprintf("%g days ago;", days))
	fput(fh, `"type -{bf:{stata "hsearch, build"}}- to rebuild index.)"')
	fput(fh, "{p_end}")

	fput(fh, "{rm}{hline}")
	fput(fh, "")

	
	for (i=1; i<=rows(ressc); i++) {

		if (i<10) fput(fh, sprintf("{p 6 10 2}"))
		else if (i<100)  fput(fh, sprintf("{p 5 10 2}"))
		else if (i<1000) fput(fh, sprintf("{p 4 10 2}"))
		else 		 fput(fh, sprintf("{p 3 10 2}"))
		fwrite(fh, sprintf("{txt}"))
		fput(fh, sprintf("%g.", i))
		fput(fh, sprintf("{ul:{bf:{help %s}}}{break}", 
				pathrmsuffix(resfn[i])
				))
		fput(fh, sprintf("(score %g){break}", ressc[i]) )
		for (j=1; j<cols(rescm); j++) {
			fput(fh, sprintf("%s /", rescm[i,j]))
		}
		fput(fh, sprintf("%s", rescm[i,j]))
		fput(fh, "")
	}
	fclose(fh)
}

/* ----------------------------------------------------------------------- */

real scalar hsearch_fopenidx(string scalar mode, |builton)
{
	real scalar	fh, done
	string scalar	basedir, idxfullname, signature
	
	basedir     = pathsubsysdir("PERSONAL")
	idxfullname = pathjoin(basedir, `IDXFILENAME')
	signature   = `SIGNATURE'

	/* ------------------------------------------------------------ */
	if (mode=="w") {
		if (fileexists(idxfullname)) unlink(idxfullname)
		recursive_mkdir(basedir)
		fh = fopen(idxfullname, "w")
		fput(fh, signature)
		fputmatrix(fh, hsearch_todaysdate())
		return(fh)
	}
	/* ------------------------------------------------------------ */

	for (done=0; 1; done=1) {
		if ( (fh = _fopen(idxfullname, "r")) >= 0) {
			if (fget(fh) == signature) { 
				builton = fgetmatrix(fh)
				if (builton >= hsearch_updatedate()) return(fh)
			}
			fclose(fh)
		}
		if (done) _error("hsearch failure")
		hsearch_build()
	}
	/*NOTREACHED*/
}

real scalar hsearch_todaysdate() return(hsearch_dmy(c("current_date")))

real scalar hsearch_updatedate()
{
	real scalar	fh, res
	string scalar	s

	if ((fh = _fopen(findfile("update"), "r"))<0) return(0) 
	s = fget(fh)
	fclose(fh)

	res = hsearch_dmy(s)
	return(res<. ? res : 0)
}

real scalar hsearch_dmy(string scalar dmystr)
{
	real scalar	result
	string scalar 	name

	name = st_tempname()
	stata("scalar " + name + `"=date(""' + dmystr + `"", "dmy")"')
	result = st_numscalar(name)
	stata("scalar drop " + name)
	return(result)
}


	
void hsearch_build_1(string scalar fullfilename, string scalar tmpname, 
		uniq, cnt, line5)
{
	real scalar		i, k, n
	real scalar		complete
	real scalar		fh
	string scalar		str, line, parse, base
	string colvector	words

	parse = `PARSECHARS'

	stata(`"quietly translate ""' + 
		fullfilename + `"" ""' + 
		tmpname + `"", trans(smcl2txt) logo(off)"')

	str = ""
	line5 = J(5,1,"")
	fh = fopen(tmpname, "r")
	i = 1
	while ((line=fget(fh))!=J(0,0,"")) {
		line = strtrim(line)
		if (line != "") {
			if (line != strlen(line)*"-") {
				if (i<=5) line5[i++] = strtrim(line)
				line = subinstr(line, `"""', "")
				str = str + " " + strlower(line)
			}
		}
	}
	fclose(fh)
	unlink(tmpname)
	words = sort(tokens(str, parse)', 1)

	uniq = J(rows(words), 1, "")
	cnt  = J(rows(words), 1, 0)
	if (rows(words)==0) return

	k = n = 0 
	base = words[1]
	for (i=2; i<=rows(words)+1; i++) {
		if (i>rows(words)) 	 complete = 2 
		else if (words[i]!=base) complete = 1 
		else 			 complete = 0 

		if (complete) {
			if (strlen(base)==0) complete = 0 
			else if (strlen(base)==1) {
				if (strpos(parse, base)) complete = 0
			}
			if (complete) {
				uniq[++k] = base
				cnt[k]    = n
			}
			if (i<=rows(words)) {
				base = words[i]
				n    = 1 
			}
		}
		else	n = n + 1
	}
	uniq = uniq[|1 \ k|]
	cnt  = cnt[|1 \ k|]
}

/* ----------------------------------------------------------------------- */

string colvector dirsearch(string scalar pattern, |string scalar upath)
{
	real scalar		i
	string rowvector	path, tok
	string colvector	res
	
	/* ----------------------------------------------- obtain path --- */
	if (upath=="") path = pathlist() 
	else {
		tok = tokens(upath)
		res = J(1, 0, "")
		for (i=1; i<=length(tok); i++) {
			if (tok[i]!=";") path = path, tok[i]
		}
	}
	/* --------------------------------------------------------------- */

	res = J(0, 1, "")
	for (i=1; i<=length(path); i++) {
		res = res \ dirsearch_dir(path[i], pattern)
	}
	return(uniqrows(res))
}

/*static*/ string colvector dirsearch_dir(string scalar udir, 
						string scalar pattern)
{
	real scalar		i
	string scalar		dir, c
	string colvector	subdirs, res, files
	real scalar		lenext

	dir = (udir=="." ? "." : pathsubsysdir(udir))

	res = J(0, 1, "")
	if (pattern=="") return(res)


	c = substr(pattern,1,2)
	lenext = strlen(pattern) - 1
	if (c=="*.") {
		subdirs = dir(dir, "dirs", "*")
		for (i=1; i<=length(subdirs); i++) {
			if (strlen(subdirs[i])==1) {
				files = dir(pathjoin(dir, subdirs[i]), "files",
								pattern)
				if (length(files) > 0) {
					res = res \
						substr(files, 1,
							 strlen(files):-lenext)
				}
			}
		}
	}
	else 	{
		errprintf("hsearch: assumption failure")
		exit(9653)
	}

	files = dir(dir, "files", pattern)
	if (length(files) > 0) {
		return(uniqrows(res\ substr(files, 1, strlen(files):-lenext)))
	}
	return(uniqrows(res))
}

/* ----------------------------------------------------------------------- */

string scalar FindHelpFile(string scalar fname, |string scalar upath)
{
	real scalar		i
	string rowvector	path, tok
	string scalar		res
	
	/* ----------------------------------------------- obtain path --- */
	if (upath=="") path = pathlist() 
	else {
		tok = tokens(upath)
		for (i=1; i<=length(tok); i++) {
			if (tok[i]!=";") path = path, tok[i]
		}
	}
	/* --------------------------------------------------------------- */

	for (i=1; i<=length(path); i++) {
		res = FindHelpFileWrk(path[i], fname)
		if (res != "") {
			return(res)
		}
	}
	return(fname+".sthlp")	// should be rare, and will cause an error
				// message later
}

/*static*/ string scalar FindHelpFileWrk(string scalar udir,
						string scalar fname)
{
	real scalar		i
	string scalar		dir, c
	string scalar		totry1, totry2, totry3

	dir = (udir=="." ? "." : pathsubsysdir(udir))

	// main directory search
	totry2 = fname + ".sthlp"
	totry3 = pathjoin(dir, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}
	totry2 = fname + ".hlp"
	totry3 = pathjoin(dir, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}

	// lettered subdirectory search
	totry1 = pathjoin(dir, adosubdir(fname))
	totry2 = fname + ".sthlp"
	totry3 = pathjoin(totry1, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}
	totry2 = fname + ".hlp"
	totry3 = pathjoin(totry1, totry2)
	if (fileexists(totry3)) {
		return(totry2)
	}

	// not found
	return("")
}

/* ----------------------------------------------------------------------- */

void recursive_mkdir(string scalar path, |real scalar pub)
{
	real scalar		i
	string scalar		head, tail
	string colvector	pieces

	if (!strlen(pieces = path)) return
	if (pathisurl(pieces)) _error("URL found where path required")
	if (direxists(pieces)) return	

	pragma unset head
	pragma unset tail

	mypathsplit(pieces, head, tail)
	while (strlen(head)) {
		pieces = pieces \ head
		mypathsplit(head, head, tail)
	}

	if (args()==1) pub = 0
	for (i=rows(pieces); i; i--) {
		if (!direxists(pieces[i])) mkdir(pieces[i], pub)
	}
}

/*
	what follows is official replacement code for built-in function 
	pathsplit().
*/

void mypathsplit(string scalar upath, ulhs, urhs)
{
	real scalar 	len, i1, i2, i
	string scalar	path
	string scalar	c

	len = strlen(path = upath)
	if (!len) {
		ulhs = urhs = ""
		return
	}
	if (len==1) {
		ulhs = ""
		urhs = path
		return 
	}

	/* ------------------------------------------------------------ */
	if (pathisurl(path)) {
		c = substr(path, 1, 7)
		mypathsplit(substr(path, 8, .), ulhs, urhs)
		if (ulhs!="") ulhs = c + ulhs
		else	      urhs = c + urhs
		return 
	}
	if (substr(path, 2, 1)==":") {
		c = substr(path, 1, 2)
		mypathsplit(substr(path, 3, .), ulhs, urhs)
		if (ulhs!="") ulhs = c + ulhs
		else	      urhs = c + urhs
		return 
	}
	if (substr(path,1,1)=="\" & substr(path,2,1)=="\") {
		mypathsplit(substr(path, 3, .), ulhs, urhs)
		if (ulhs!="") ulhs = "\\" + ulhs
		else	      urhs = "\\" + urhs
		return 
	}
	/* ------------------------------------------------------------ */


	path = strreverse(path)
	c = substr(path, 1, 1)
	if (c=="/" | c=="\") path = substr(path, 2, .)

	i1 = strpos(path, "/")
	i2 = strpos(path, "\") 

	if (!i1 & !i2) {
		ulhs = ""
		urhs = strreverse(path)
		return 
	}
	i = (i1 ? (i2 ? (i1<i2 ? i1: i2) : i1) : i2)

	urhs = strreverse(substr(path, 1, i-1))
	if ((ulhs = strreverse(substr(path, i+1, .)))=="") {
		ulhs = substr(path, i, 1)
	}
}



/* ----------------------------------------------------------------------- */


string rowvector hsearch_search_cleantxt(string scalar txt)
{
	string scalar	s

	s = subinstr(strlower(txt), `"""', "")
	s = subinstr(s, `"'"', "")
	return(tokens(s, `PARSECHARS'))
}


real scalar hsearch_search_score(string vector words, 
			string vector uniq, real vector cnt)
{
	real scalar	i, m, a
	real scalar	idx
	
	m = 1 
	a = 0
	for (i=1; i<=length(words); i++) {
		if (idx=hsearch_binsearch(words[i], uniq)) {
			m = m * cnt[idx]
			a = a + cnt[idx]
		}
		else {
			m = 0 
		}
	}
	// return(trunc((100*m+a)/sqrt(colsum(cnt))))
	return(100*m+a)
}
		

real scalar hsearch_binsearch(string scalar word, string vector list)
{
	real scalar	top, bot, k

	bot = 1 
	top = length(list)

	while (bot <= top) {
		k = trunc((top+bot)/2)
		if (word==list[k]) return(k)
		if (word < list[k]) top = k - 1
		else 		    bot = k + 1
	}
	return(0) 
}

end

</pre>
</li>
</ul>
</li>
</ul>


<ul class="blockList">
<li class="blockList">
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== TOKENS =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Tokens</h3>
 <span style="font-size: 24pt;"><a class="tokens" href="../tokens/a.html#ado">ado</a></span>&nbsp;&nbsp;
<span style="font-size: 10pt;"><a class="tokens" href="../tokens/h.html#hsearch">hsearch</a></span>&nbsp;&nbsp;
<span style="font-size: 7pt;"><a class="tokens" href="../files/h_hsearch.ado.html">hsearch ado</a></span>&nbsp;&nbsp;
</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ========= START OF BOTTOM NAVBAR ========= -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/h_hreg.sthlp.html" title="h/hreg.sthlp">Prev</a>	
	</li>
<li>
    <a href="../files/h_hsearch.dlg.html" title="h/hsearch.dlg" >Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../index.html?files/h_hsearch.ado.html" target="_top">Frames</a></li>
<li><a href="../files/h_hsearch.ado.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ========= END OF BOTTOM NAVBAR ========= -->
</body>
</html>