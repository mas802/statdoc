<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<!-- Generated by statdoc (version v0.9.2-beta) on 2015-09-23 04:00:38 -->
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<title>Lightbulbs</title>
<meta name="date" content="2015-09-23">
<script src="../d3.min.js"></script>
<script src="../statdoc.js"></script>
</head>
<body>

<!-- ========= START OF TOP NAVBAR ========= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do">Prev</a>	
	</li>
<li>
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do">Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../compare.html?files/Analysis_Code_TESSExcessMassTest.do.html" target="_top">Compare</a></li>
<li><a href="../index.html?files/Analysis_Code_TESSExcessMassTest.do.html" target="_top">Frames</a></li>
<li><a href="../files/Analysis_Code_TESSExcessMassTest.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= --><!-- ======== START OF FILE DATA ======== -->
<div class="header">
<div class="subTitle">Lightbulbs</div>
<h2 title="Statdoc File TESSExcessMassTest.do" class="title">File TESSExcessMassTest.do</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>
<table border="0" style="border-collapse: collapse;table-layout: auto;width: auto;">
  <colgroup>
    <col span="1" width="200px">
    <col width="10px" style="text-align:center;">
    <col width="200px">
    <col width="10px" style="text-align:center;">
    <col span="1" width="200px">
  </colgroup>
<tr class="inheritance">
	<!-- DEBUG match11_hash_-1172810931 -->
<!-- DEBUG [PreppedTESSData.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fffffd;">
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >Analysis/Co..SLightbulbsDataPrep.do</a><b>:</b><a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html#510" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >510</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#11" title="Analysis/Code/TESSExcessMassTest.do:11 (use)">11</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_PreppedTESSData.dta.html" title="Analysis/Calculations/PreppedTESSData.dta"  target="classFrame" >Analysis/Ca..ns/PreppedTESSData.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match19_hash_-1042290171 -->
<!-- DEBUG [PreppedTESSData.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fffffd;">
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >Analysis/Co..SLightbulbsDataPrep.do</a><b>:</b><a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html#510" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >510</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#19" title="Analysis/Code/TESSExcessMassTest.do:19 (use)">19</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_PreppedTESSData.dta.html" title="Analysis/Calculations/PreppedTESSData.dta"  target="classFrame" >Analysis/Ca..ns/PreppedTESSData.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match79_hash_-770510413 -->
<!-- DEBUG [PreppedTESSData.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fffffd;">
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >Analysis/Co..SLightbulbsDataPrep.do</a><b>:</b><a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html#510" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >510</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#79" title="Analysis/Code/TESSExcessMassTest.do:79 (use)">79</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_PreppedTESSData.dta.html" title="Analysis/Calculations/PreppedTESSData.dta"  target="classFrame" >Analysis/Ca..ns/PreppedTESSData.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match83_hash_-752456679 -->
<!-- DEBUG [ExcessMass.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fff8d8;">
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do:75 (save)"  target="classFrame" >Analysis/Code/TESSExcessMassTest.do</a><b>:</b><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#75" title="Analysis/Code/TESSExcessMassTest.do:75 (save)"  target="classFrame" >75</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#83" title="Analysis/Code/TESSExcessMassTest.do:83 (merge)">83</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_ExcessMass.dta.html" title="Analysis/Calculations/ExcessMass.dta"  target="classFrame" >Analysis/Ca..lations/ExcessMass.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match94_hash_418582687 -->
<!-- DEBUG [PreppedTESSData.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fffffd;">
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >Analysis/Co..SLightbulbsDataPrep.do</a><b>:</b><a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html#510" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >510</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#94" title="Analysis/Code/TESSExcessMassTest.do:94 (use)">94</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_PreppedTESSData.dta.html" title="Analysis/Calculations/PreppedTESSData.dta"  target="classFrame" >Analysis/Ca..ns/PreppedTESSData.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match97_hash_391708805 -->
<!-- DEBUG [ExcessMass.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fff8d8;">
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do:75 (save)"  target="classFrame" >Analysis/Code/TESSExcessMassTest.do</a><b>:</b><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#75" title="Analysis/Code/TESSExcessMassTest.do:75 (save)"  target="classFrame" >75</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#97" title="Analysis/Code/TESSExcessMassTest.do:97 (merge)">97</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_ExcessMass.dta.html" title="Analysis/Calculations/ExcessMass.dta"  target="classFrame" >Analysis/Ca..lations/ExcessMass.dta</a>
</td>  
</tr>
<tr class="inheritance">
<td style="border: none;"></td>
<td style="text-align:center;background: #fff8d8;">&rarr;</td>
<td  style="background: #fff8d8;">
<span style="background: #fff8d8;"><b>Analysis/Code/TESSExcessMassTest.do</b></span>
</td>
<td style="text-align:center;background: #fff8d8;">&#8600;</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [ExcessMassShare.csv] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #eeeeff ;" colspan="1">
      <span style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Output_ExcessMassShare.csv.html" title="Analysis/Output/ExcessMassShare.csv"  target="classFrame" >Analysis/Output/ExcessMassShare.csv</a><br>
</span>  
</td> 
<td style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#89" title="Analysis/Code/TESSExcessMassTest.do:89 (outsheet)">89</a>]&nbsp;</i>
</td>
<td>

</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [ExcessMass.dta] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #eeeeff ;" colspan="1">
      <span style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_ExcessMass.dta.html" title="Analysis/Calculations/ExcessMass.dta"  target="classFrame" >Analysis/Ca..lations/ExcessMass.dta</a><br>
</span>  
</td> 
<td style="text-align:center; background: #fff8d8;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSExcessMassTest.do.html#75" title="Analysis/Code/TESSExcessMassTest.do:75 (save)">75</a>]&nbsp;</i>
</td>
<td>

      <span style="white-space: nowrap; background: #fff8d8;">
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do:83 (merge)"  target="classFrame" >Analysis/Code/TESSExcessMassTest.do</a><b>:</b><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#83" title="Analysis/Code/TESSExcessMassTest.do:83 (merge)"  target="classFrame" >83</a><br>
</span>  
      <span style="white-space: nowrap; background: #fff8d8;">
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do:97 (merge)"  target="classFrame" >Analysis/Code/TESSExcessMassTest.do</a><b>:</b><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#97" title="Analysis/Code/TESSExcessMassTest.do:97 (merge)"  target="classFrame" >97</a><br>
</span>  
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>

<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><span class="strong">Analysis/Code/TESSExcessMassTest.do <a href="../Analysis/Code/TESSExcessMassTest.do">open</a></span>
file:script:do</pre>
</li>
</ul>
<ul class="blockList">
<li class="blockList">
<div class="block"> This carries out the excess mass test and welfare correction</div>
</li>
</ul>

</div>
<ul class="blockList">
<li class="blockList">
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">author</td>
  <td class="colLast">Allcott and Taubinsky</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">date</td>
  <td class="colLast">Wed Sep 16 16:27:24 EST 2015</td>
  </tr>
    </tbody>
  </table>
</li>
</ul>




<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Variable Summary table, listing datasets and labels">
<caption><span><a name="variables"><!-- --></a>All commands</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" style="width:30px" scope="col">#</th>
<th class="colLast" width="100%" scope="col">content
<!-- <span style="float: right;">&nbsp;<a title="Raw Source" onclick="toggle('rawframe');setIframeHeight('rawframe');">raw</a> -->
</th>
<!--
<td style="display:none;" id="rawframe" rowspan="108" height="100%">
<iframe scrolling="yes" width="600px" height="100%" src="../files/Analysis_Code_TESSExcessMassTest.do.html#content" name="statdocSubFrame_raw" title="Raw File" style="height: 100%; width: 600px; overflow-x:scroll; overflow-y:scroll; -ms-overflow-x:scroll; -ms-overflow-y:scroll;"></iframe>
</td>
-->
</tr>
 <tr class="cmd_comment altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="1" title="comment"><!-- -->
    1</a>&nbsp;<a onclick='toggle("cmd_816227956");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:${ind}em">
  <span class="cmdcomment">
/* TESSExcessMassTest.do */
* This carries out the excess mass test and welfare correction </span>
<div id="cmd_816227956" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* TESSExcessMassTest.do */
* This carries out the excess mass test and welfare correction </pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">
/* TESSExcessMassTest.do */
* This carries out the excess mass test and welfare correction </td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *********************************************************** *** PRELIMINARY: Are there more renters in the excess mass region?</div></td>
</tr>
<tr class="cmd_importcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="11" title="use"><!-- -->
    11</a>&nbsp;<a onclick='toggle("cmd_-274995001");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_-274995001" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">***********************************************************
*** PRELIMINARY: Are there more renters in the excess mass region?
use Calculations/PreppedTESSData.dta, clear	</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="12" title="keep"><!-- -->
    12</a>&nbsp;<a onclick='toggle("cmd_370748859");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"></span>
if <span class="cmdif">T==1</span>
<div id="cmd_370748859" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">keep if T==1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_estcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="13" title="reg"><!-- -->
    13</a>&nbsp;<a onclick='toggle("cmd_259452951");' title="reg">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">reg</span>
  <span class="cmdparameters"><a href="../tokens/e.html#ExcessArea">ExcessArea</a> <a href="../tokens/o.html#OwnHome">OwnHome</a> [<a href="../tokens/p.html#pweight">pweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</span>
, <span class="cmdoptions"> <a href="../tokens/r.html#robust">robust</a></span>
<div id="cmd_259452951" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">reg ExcessArea OwnHome [pweight=Weight], robust</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">reg</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#robust">robust</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessArea">ExcessArea</a> <a href="../tokens/o.html#OwnHome">OwnHome</a> [<a href="../tokens/p.html#pweight">pweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="14" title="tab"><!-- -->
    14</a>&nbsp;<a onclick='toggle("cmd_-1555642210");' title="tab">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">tab</span>
  <span class="cmdparameters"><a href="../tokens/o.html#OwnHome">OwnHome</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</span>
<div id="cmd_-1555642210" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">tab OwnHome [aweight=Weight]</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">tab</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/o.html#OwnHome">OwnHome</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *********************************************************** *** STEP 1: Estimate the share of consumers that are excess mass</div></td>
</tr>
<tr class="cmd_importcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="19" title="use"><!-- -->
    19</a>&nbsp;<a onclick='toggle("cmd_1622453513");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_1622453513" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">***********************************************************
*** STEP 1: Estimate the share of consumers that are excess mass
use Calculations/PreppedTESSData.dta, clear	</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="20" title="keep"><!-- -->
    20</a>&nbsp;<a onclick='toggle("cmd_-790668280");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"></span>
if <span class="cmdif">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</span>
  <span class="cmdcomment">// limit entire sample in the same way for consistency</span>
<div id="cmd_-790668280" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">keep if T==1&WTP2!=.&WTP1!=. // limit entire sample in the same way for consistency</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">// limit entire sample in the same way for consistency</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_comment rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="22" title="comment"><!-- -->
    22</a>&nbsp;<a onclick='toggle("cmd_-1122236868");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
  <span class="cmdcomment">	** uncomment these lines to check the weighting
	*gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)
	*replace Weight1 = cond(ExcessArea==0,Weight,Weight/5.1)</span>
<div id="cmd_-1122236868" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	** uncomment these lines to check the weighting
	*gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)
	*replace Weight1 = cond(ExcessArea==0,Weight,Weight/5.1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">	** uncomment these lines to check the weighting
	*gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)
	*replace Weight1 = cond(ExcessArea==0,Weight,Weight/5.1)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="26" title="collapse"><!-- -->
    26</a>&nbsp;<a onclick='toggle("cmd_-1292016491");' title="collapse">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">collapse</span>
  <span class="cmdparameters">(<a href="../tokens/s.html#sum">sum</a>) <a href="../tokens/w.html#Weight">Weight</a></span>
, <span class="cmdoptions"> <a href="../tokens/b.html#by">by(</a><a href="../tokens/w.html#WTP2">WTP2</a>)</span>
<div id="cmd_-1292016491" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">collapse (sum) Weight, by(WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">collapse</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/b.html#by">by(</a><a href="../tokens/w.html#WTP2">WTP2</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/s.html#sum">sum</a>) <a href="../tokens/w.html#Weight">Weight</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="27" title="compress"><!-- -->
    27</a>&nbsp;<a onclick='toggle("cmd_495637461");' title="compress">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">compress</span>
  <span class="cmdparameters"></span>
<div id="cmd_495637461" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">compress</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">compress</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="29" title="sum"><!-- -->
    29</a>&nbsp;<a onclick='toggle("cmd_-358502374");' title="sum">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">sum</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight">Weight</a></span>
, <span class="cmdoptions"> <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#29">meanonly</a></span>
<div id="cmd_-358502374" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">sum Weight, meanonly</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">sum</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#29">meanonly</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight">Weight</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="30" title="replace"><!-- -->
    30</a>&nbsp;<a onclick='toggle("cmd_-756416484");' title="replace">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">replace</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight">Weight</a>=<a href="../tokens/w.html#Weight">Weight</a>/<a href="../tokens/r.html#r">r(</a><a href="../tokens/s.html#sum">sum</a>)</span>
<div id="cmd_-756416484" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">replace Weight=Weight/r(sum)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">replace</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight">Weight</a>=<a href="../tokens/w.html#Weight">Weight</a>/<a href="../tokens/r.html#r">r(</a><a href="../tokens/s.html#sum">sum</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="32" title="drop"><!-- -->
    32</a>&nbsp;<a onclick='toggle("cmd_2018246014");' title="drop">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">drop</span>
  <span class="cmdparameters"></span>
if <span class="cmdif"><a href="../tokens/w.html#WTP2">WTP2</a>==-15|<a href="../tokens/w.html#WTP2">WTP2</a>==15</span>
<div id="cmd_2018246014" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">drop if WTP2==-15|WTP2==15</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">drop</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a>==-15|<a href="../tokens/w.html#WTP2">WTP2</a>==15</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="33" title="gen"><!-- -->
    33</a>&nbsp;<a onclick='toggle("cmd_1296295793");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Width">Width</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#33">inlist(WTP2</a>,-9,-7,-5,5,7,9),2,1)</span>
<div id="cmd_1296295793" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">gen Width = cond(inlist(WTP2,-9,-7,-5,5,7,9),2,1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Width">Width</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#33">inlist(WTP2</a>,-9,-7,-5,5,7,9),2,1)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="34" title="gen"><!-- -->
    34</a>&nbsp;<a onclick='toggle("cmd_601323894");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/e.html#ExcessArea">ExcessArea</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=-2&<a href="../tokens/w.html#WTP2">WTP2</a><=4,1,0)</span>
<div id="cmd_601323894" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessArea">ExcessArea</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=-2&<a href="../tokens/w.html#WTP2">WTP2</a><=4,1,0)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> ** Generate ExcessArea indicators</div></td>
</tr>
<tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="36" title="local"><!-- -->
    36</a>&nbsp;<a onclick='toggle("cmd_1082173605");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters">i = 1</span>
<div id="cmd_1082173605" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	** Generate ExcessArea indicators
	local i = 1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">i = 1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="37" title="foreach"><!-- -->
    37</a>&nbsp;<a onclick='toggle("cmd_-547337003");' title="foreach">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">foreach</span>
  <span class="cmdparameters"><a href="../tokens/w.html#wtp2">wtp2</a></span>
in <span class="cmdin">-1.5 -0.5 0.5 1.5 2.5 3.5 {</span>
<div id="cmd_-547337003" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	foreach wtp2 in -1.5 -0.5 0.5 1.5 2.5 3.5 {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">foreach</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">in</td>
  <td class="colLast">-1.5 -0.5 0.5 1.5 2.5 3.5 {</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#wtp2">wtp2</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="38" title="gen"><!-- -->
    38</a>&nbsp;<a onclick='toggle("cmd_1398596954");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#38">byte</a> <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#38">ExcessArea_WTP2_`i'</a> = <a href="../tokens/e.html#ExcessArea">ExcessArea*(</a><a href="../tokens/w.html#WTP2">WTP2</a>==<a href="../tokens/w.html#wtp2">`wtp2'</a>)</span>
<div id="cmd_1398596954" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		gen byte ExcessArea_WTP2_`i' = ExcessArea*(WTP2==`wtp2')</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Code_TESSExcessMassTest.do.html#38">byte</a> <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#38">ExcessArea_WTP2_`i'</a> = <a href="../tokens/e.html#ExcessArea">ExcessArea*(</a><a href="../tokens/w.html#WTP2">WTP2</a>==<a href="../tokens/w.html#wtp2">`wtp2'</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="39" title="local"><!-- -->
    39</a>&nbsp;<a onclick='toggle("cmd_-1243588994");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters">i = <a href="../tokens/i.html#i">`i'</a> + 1</span>
<div id="cmd_-1243588994" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		local i = `i' + 1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">i = <a href="../tokens/i.html#i">`i'</a> + 1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="40" title="}"><!-- -->
    40</a>&nbsp;<a onclick='toggle("cmd_878495661");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_878495661" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * Basic regression</div></td>
</tr>
<tr class="cmd_estcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="43" title="reg"><!-- -->
    43</a>&nbsp;<a onclick='toggle("cmd_957413573");' title="reg">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">reg</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> <a href="../tokens/e.html#ExcessArea">ExcessArea</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></span>
<div id="cmd_957413573" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* Basic regression
	reg Weight Width ExcessArea, robust nocons</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">reg</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> <a href="../tokens/e.html#ExcessArea">ExcessArea</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * coefficient of 0.064 density over area of 6 suggests a 38% excess mass.</div></td>
</tr>
<tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="45" title="predict"><!-- -->
    45</a>&nbsp;<a onclick='toggle("cmd_-1066644153");' title="predict">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">predict</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WeightHat0">WeightHat0</a></span>
<div id="cmd_-1066644153" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* coefficient of 0.064 density over area of 6 suggests a 38% excess mass.
	predict WeightHat0</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">predict</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WeightHat0">WeightHat0</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="46" title="twoway"><!-- -->
    46</a>&nbsp;<a onclick='toggle("cmd_-351473697");' title="twoway">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">twoway</span>
  <span class="cmdparameters">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat0">WeightHat0</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</span>
<div id="cmd_-351473697" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	twoway (line WeightHat0 Weight WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">twoway</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat0">WeightHat0</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * With ExcessArea dummies</div></td>
</tr>
<tr class="cmd_estcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="49" title="reg"><!-- -->
    49</a>&nbsp;<a onclick='toggle("cmd_-572754507");' title="reg">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">reg</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> <a href="../tokens/e.html#ExcessArea_WTP2_">ExcessArea_WTP2_*</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></span>
<div id="cmd_-572754507" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* With ExcessArea dummies
	reg Weight Width ExcessArea_WTP2_*, robust nocons</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">reg</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> <a href="../tokens/e.html#ExcessArea_WTP2_">ExcessArea_WTP2_*</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="50" title="predict"><!-- -->
    50</a>&nbsp;<a onclick='toggle("cmd_-1157013976");' title="predict">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">predict</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WeightHat1">WeightHat1</a></span>
<div id="cmd_-1157013976" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	predict WeightHat1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">predict</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WeightHat1">WeightHat1</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="51" title="twoway"><!-- -->
    51</a>&nbsp;<a onclick='toggle("cmd_-1175648678");' title="twoway">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">twoway</span>
  <span class="cmdparameters">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat1">WeightHat1</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</span>
<div id="cmd_-1175648678" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	twoway (line WeightHat1 Weight WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">twoway</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat1">WeightHat1</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * With quadratic approximation to demand * The figures show that this is definitely the best approximation.</div></td>
</tr>
<tr class="cmd_estcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="55" title="reg"><!-- -->
    55</a>&nbsp;<a onclick='toggle("cmd_-1372750209");' title="reg">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">reg</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> c.<a href="../tokens/w.html#Width">Width</a>#c.<a href="../tokens/w.html#WTP2">WTP2</a> <a href="../tokens/e.html#ExcessArea_WTP2_">ExcessArea_WTP2_*</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></span>
<div id="cmd_-1372750209" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* With quadratic approximation to demand
		* The figures show that this is definitely the best approximation.
	reg Weight Width c.Width#c.WTP2 ExcessArea_WTP2_*, robust nocons	</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">reg</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#robust">robust</a> <a href="../tokens/n.html#nocons">nocons</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#Width">Width</a> c.<a href="../tokens/w.html#Width">Width</a>#c.<a href="../tokens/w.html#WTP2">WTP2</a> <a href="../tokens/e.html#ExcessArea_WTP2_">ExcessArea_WTP2_*</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="56" title="predict"><!-- -->
    56</a>&nbsp;<a onclick='toggle("cmd_-538014013");' title="predict">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">predict</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WeightHat2">WeightHat2</a></span>
<div id="cmd_-538014013" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	predict WeightHat2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">predict</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WeightHat2">WeightHat2</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="57" title="twoway"><!-- -->
    57</a>&nbsp;<a onclick='toggle("cmd_-760664569");' title="twoway">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">twoway</span>
  <span class="cmdparameters">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</span>
<div id="cmd_-760664569" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	twoway (line WeightHat2 Weight WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">twoway</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/w.html#Weight">Weight</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="60" title="gen"><!-- -->
    60</a>&nbsp;<a onclick='toggle("cmd_1150403153");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a> = <a href="../tokens/_.html#_b">_b</a>[<a href="../tokens/w.html#Width">Width</a>]<a href="../tokens/w.html#Width">*Width</a> + <a href="../tokens/w.html#Width">Width</a>*<a href="../tokens/w.html#WTP2">WTP2</a>*<a href="../tokens/_.html#_b">_b</a>[c.<a href="../tokens/w.html#Width">Width</a>#c.<a href="../tokens/w.html#WTP2">WTP2</a>]</span>
<div id="cmd_1150403153" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen PredictedWeightWithoutExcessMass = _b[Width]*Width + Width*WTP2*_b[c.Width#c.WTP2]</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a> = <a href="../tokens/_.html#_b">_b</a>[<a href="../tokens/w.html#Width">Width</a>]<a href="../tokens/w.html#Width">*Width</a> + <a href="../tokens/w.html#Width">Width</a>*<a href="../tokens/w.html#WTP2">WTP2</a>*<a href="../tokens/_.html#_b">_b</a>[c.<a href="../tokens/w.html#Width">Width</a>#c.<a href="../tokens/w.html#WTP2">WTP2</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="61" title="twoway"><!-- -->
    61</a>&nbsp;<a onclick='toggle("cmd_-745519812");' title="twoway">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">twoway</span>
  <span class="cmdparameters">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</span>
<div id="cmd_-745519812" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	twoway (line WeightHat2 PredictedWeightWithoutExcessMass WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">twoway</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/l.html#line">line</a> <a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a> <a href="../tokens/w.html#WTP2">WTP2</a>)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * Get the difference between predicted and fitted weights * (This is also the sum of \xi in the regression.)</div></td>
</tr>
<tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="65" title="gen"><!-- -->
    65</a>&nbsp;<a onclick='toggle("cmd_868206302");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a> = <a href="../tokens/w.html#WeightHat2">WeightHat2</a>-<a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a></span>
<div id="cmd_868206302" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* Get the difference between predicted and fitted weights
		 * (This is also the sum of \xi in the regression.)
	gen PredictedExcessMass = WeightHat2-PredictedWeightWithoutExcessMass</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a> = <a href="../tokens/w.html#WeightHat2">WeightHat2</a>-<a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> ** This is the share of consumers on interval ExcessArea that are excess mass.</div></td>
</tr>
<tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="68" title="sum"><!-- -->
    68</a>&nbsp;<a onclick='toggle("cmd_564129744");' title="sum">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">sum</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a> <a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a></span>
if <span class="cmdif"><a href="../tokens/e.html#ExcessArea">ExcessArea</a>==1</span>
<div id="cmd_564129744" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	** This is the share of consumers on interval ExcessArea that are excess mass.	
	sum WeightHat2 PredictedExcessMass PredictedWeightWithoutExcessMass if ExcessArea==1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">sum</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessArea">ExcessArea</a>==1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WeightHat2">WeightHat2</a> <a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a> <a href="../tokens/p.html#PredictedWeightWithoutExcessMass">PredictedWeightWithoutExcessMass</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="69" title="display"><!-- -->
    69</a>&nbsp;<a onclick='toggle("cmd_965777631");' title="display">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">display</span>
  <span class="cmdparameters">.0637922 * 6</span>
  <span class="cmdcomment">// share of total Treatment group that is excess mass.</span>
<div id="cmd_965777631" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	display .0637922 * 6 // share of total Treatment group that is excess mass.</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">display</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">// share of total Treatment group that is excess mass.</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">.0637922 * 6</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="70" title="display"><!-- -->
    70</a>&nbsp;<a onclick='toggle("cmd_-1495377064");' title="display">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">display</span>
  <span class="cmdparameters">.0637922 / .0764168</span>
<div id="cmd_-1495377064" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	display .0637922 / .0764168</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">display</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">.0637922 / .0764168</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="71" title="display"><!-- -->
    71</a>&nbsp;<a onclick='toggle("cmd_-1401167741");' title="display">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">display</span>
  <span class="cmdparameters">0.0637922/(0.0764168-0.0637922)</span>
<div id="cmd_-1401167741" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	display 0.0637922/(0.0764168-0.0637922)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">display</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">0.0637922/(0.0764168-0.0637922)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="73" title="gen"><!-- -->
    73</a>&nbsp;<a onclick='toggle("cmd_1915554100");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a> = <a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a>/<a href="../tokens/w.html#WeightHat2">WeightHat2</a></span>
  <span class="cmdcomment">// This is the share of consumers in each WTP2 interval that are excess mass</span>
<div id="cmd_1915554100" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen ExcessMassShare = PredictedExcessMass/WeightHat2 // This is the share of consumers in each WTP2 interval that are excess mass</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">// This is the share of consumers in each WTP2 interval that are excess mass</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a> = <a href="../tokens/p.html#PredictedExcessMass">PredictedExcessMass</a>/<a href="../tokens/w.html#WeightHat2">WeightHat2</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_outputcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="75" title="save"><!-- -->
    75</a>&nbsp;<a onclick='toggle("cmd_-934022371");' title="save">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">save</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/e.html#ExcessMass">ExcessMass</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#replace">replace</a></span>
<div id="cmd_-934022371" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	save Calculations/ExcessMass.dta, replace</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">save</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#replace">replace</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/e.html#ExcessMass">ExcessMass</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *********************************************************** **** STEP 2: Calculate the share of consumers at each WTP1 that represent excess mass on interval ExcessArea</div></td>
</tr>
<tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="79" title="use"><!-- -->
    79</a>&nbsp;<a onclick='toggle("cmd_465732250");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_465732250" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">***********************************************************
**** STEP 2: Calculate the share of consumers at each WTP1 that represent excess mass on interval ExcessArea
use Calculations/PreppedTESSData.dta, clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="80" title="keep"><!-- -->
    80</a>&nbsp;<a onclick='toggle("cmd_-946706762");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"></span>
if <span class="cmdif">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</span>
<div id="cmd_-946706762" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">keep if T==1&WTP2!=.&WTP1!=.</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> * Only some of the excess mass is truly excess: the difference between the predicted and fitted weights:</div></td>
</tr>
<tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="83" title="merge"><!-- -->
    83</a>&nbsp;<a onclick='toggle("cmd_2145014258");' title="merge">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">merge</span>
  <span class="cmdparameters">m:1 <a href="../tokens/w.html#WTP2">WTP2</a></span>
using <span class="cmdusing"><a href="../files/Analysis_Calculations_ExcessMass.dta.html">Calculations/ExcessMass.dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/k.html#keepusing">keepusing(</a><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>) <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#83">nogen</a></span>
<div id="cmd_2145014258" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">* Only some of the excess mass is truly excess: the difference between the predicted and fitted weights:
merge m:1 WTP2 using Calculations/ExcessMass.dta, keepusing(ExcessMassShare) nogen</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">merge</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/k.html#keepusing">keepusing(</a><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>) <a href="../files/Analysis_Code_TESSExcessMassTest.do.html#83">nogen</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">m:1 <a href="../tokens/w.html#WTP2">WTP2</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">using</td>
  <td class="colLast"><a href="../files/Analysis_Calculations_ExcessMass.dta.html">Calculations/ExcessMass.dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="84" title="replace"><!-- -->
    84</a>&nbsp;<a onclick='toggle("cmd_-1637796764");' title="replace">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">replace</span>
  <span class="cmdparameters"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>=0</span>
if <span class="cmdif"><a href="../tokens/w.html#WTP2">WTP2</a>==15|<a href="../tokens/w.html#WTP2">WTP2</a>==-15</span>
<div id="cmd_-1637796764" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">replace ExcessMassShare=0 if WTP2==15|WTP2==-15</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">replace</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a>==15|<a href="../tokens/w.html#WTP2">WTP2</a>==-15</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>=0</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="86" title="collapse"><!-- -->
    86</a>&nbsp;<a onclick='toggle("cmd_104134381");' title="collapse">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">collapse</span>
  <span class="cmdparameters">(<a href="../tokens/m.html#mean">mean</a>) <a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</span>
, <span class="cmdoptions"><a href="../tokens/b.html#by">by(</a><a href="../tokens/w.html#WTP1">WTP1</a>)</span>
<div id="cmd_104134381" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">collapse (mean) ExcessMassShare [aweight=Weight],by(WTP1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">collapse</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"><a href="../tokens/b.html#by">by(</a><a href="../tokens/w.html#WTP1">WTP1</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">(<a href="../tokens/m.html#mean">mean</a>) <a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="87" title="keep"><!-- -->
    87</a>&nbsp;<a onclick='toggle("cmd_-1133142925");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"></span>
if <span class="cmdif"><a href="../tokens/w.html#WTP1">WTP1</a><0</span>
<div id="cmd_-1133142925" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">keep if WTP1<0</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP1">WTP1</a><0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="88" title="gsort"><!-- -->
    88</a>&nbsp;<a onclick='toggle("cmd_400258552");' title="gsort">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gsort</span>
  <span class="cmdparameters">-<a href="../tokens/w.html#WTP1">WTP1</a></span>
<div id="cmd_400258552" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">gsort -WTP1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">gsort</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">-<a href="../tokens/w.html#WTP1">WTP1</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_outputcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="89" title="outsheet"><!-- -->
    89</a>&nbsp;<a onclick='toggle("cmd_-1704511679");' title="outsheet">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">outsheet</span>
  <span class="cmdparameters"></span>
using <span class="cmdusing"><a href="../files/Analysis_Output_ExcessMassShare.csv.html">Output/ExcessMassShare.csv</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#comma">comma</a> <a href="../tokens/n.html#names">names</a> <a href="../tokens/r.html#replace">replace</a></span>
<div id="cmd_-1704511679" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">outsheet using Output/ExcessMassShare.csv, comma names replace</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">outsheet</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#comma">comma</a> <a href="../tokens/n.html#names">names</a> <a href="../tokens/r.html#replace">replace</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">using</td>
  <td class="colLast"><a href="../files/Analysis_Output_ExcessMassShare.csv.html">Output/ExcessMassShare.csv</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> *********************************************************** **** FOR STEP 3: Calculate average WTP after re-weighting to eliminate excess mass</div></td>
</tr>
<tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="94" title="use"><!-- -->
    94</a>&nbsp;<a onclick='toggle("cmd_1563530838");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_1563530838" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">***********************************************************
**** FOR STEP 3: Calculate average WTP after re-weighting to eliminate excess mass
use Calculations/PreppedTESSData.dta, clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="95" title="keep"><!-- -->
    95</a>&nbsp;<a onclick='toggle("cmd_-1425333270");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"></span>
if <span class="cmdif">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</span>
<div id="cmd_-1425333270" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">keep if T==1&WTP2!=.&WTP1!=.</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1&<a href="../tokens/w.html#WTP2">WTP2</a>!=.&<a href="../tokens/w.html#WTP1">WTP1</a>!=.</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="97" title="merge"><!-- -->
    97</a>&nbsp;<a onclick='toggle("cmd_1382607689");' title="merge">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">merge</span>
  <span class="cmdparameters">m:1 <a href="../tokens/w.html#WTP2">WTP2</a></span>
using <span class="cmdusing"><a href="../files/Analysis_Calculations_ExcessMass.dta.html">Calculations/ExcessMass.dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/k.html#keepusing">keepusing(</a><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>)</span>
<div id="cmd_1382607689" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">merge m:1 WTP2 using Calculations/ExcessMass.dta, keepusing(ExcessMassShare)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">merge</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/k.html#keepusing">keepusing(</a><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">m:1 <a href="../tokens/w.html#WTP2">WTP2</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">using</td>
  <td class="colLast"><a href="../files/Analysis_Calculations_ExcessMass.dta.html">Calculations/ExcessMass.dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="98" title="replace"><!-- -->
    98</a>&nbsp;<a onclick='toggle("cmd_26704284");' title="replace">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">replace</span>
  <span class="cmdparameters"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>=0</span>
if <span class="cmdif"><a href="../tokens/w.html#WTP2">WTP2</a>==15|<a href="../tokens/w.html#WTP2">WTP2</a>==-15</span>
<div id="cmd_26704284" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">replace ExcessMassShare=0 if WTP2==15|WTP2==-15</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">replace</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a>==15|<a href="../tokens/w.html#WTP2">WTP2</a>==-15</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>=0</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="100" title="gen"><!-- -->
    100</a>&nbsp;<a onclick='toggle("cmd_987555114");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/w.html#Weight1">Weight1</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/e.html#ExcessArea">ExcessArea</a>==0,<a href="../tokens/w.html#Weight">Weight</a>,<a href="../tokens/w.html#Weight">Weight</a>*(1-<a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>))</span>
<div id="cmd_987555114" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">gen Weight1 = cond(ExcessArea==0,Weight,Weight*(1-ExcessMassShare))</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#Weight1">Weight1</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/e.html#ExcessArea">ExcessArea</a>==0,<a href="../tokens/w.html#Weight">Weight</a>,<a href="../tokens/w.html#Weight">Weight</a>*(1-<a href="../tokens/e.html#ExcessMassShare">ExcessMassShare</a>))</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_comment rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="102" title="comment"><!-- -->
    102</a>&nbsp;<a onclick='toggle("cmd_-60694096");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
  <span class="cmdcomment">	* Check regression to make sure that the reweighting worked
	*collapse (sum) Weight1, by(WTP2)
	*drop if WTP2==15|WTP2==-15
	*twoway (line Weight1 WTP2)</span>
<div id="cmd_-60694096" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	* Check regression to make sure that the reweighting worked
	*collapse (sum) Weight1, by(WTP2)
	*drop if WTP2==15|WTP2==-15
	*twoway (line Weight1 WTP2)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">	* Check regression to make sure that the reweighting worked
	*collapse (sum) Weight1, by(WTP2)
	*drop if WTP2==15|WTP2==-15
	*twoway (line Weight1 WTP2)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="108" title="sum"><!-- -->
    108</a>&nbsp;<a onclick='toggle("cmd_1766238546");' title="sum">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">sum</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WTP2">WTP2</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</span>
if <span class="cmdif">T==1</span>
<div id="cmd_1766238546" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">sum WTP2 [aweight=Weight] if T==1 </pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">sum</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="109" title="sum"><!-- -->
    109</a>&nbsp;<a onclick='toggle("cmd_1325084336");' title="sum">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">sum</span>
  <span class="cmdparameters"><a href="../tokens/w.html#WTP2">WTP2</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight1">Weight1</a>]</span>
if <span class="cmdif">T==1</span>
<div id="cmd_1325084336" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">sum WTP2 [aweight=Weight1] if T==1 </pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">sum</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast">T==1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a> [<a href="../tokens/a.html#aweight">aweight</a>=<a href="../tokens/w.html#Weight1">Weight1</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
</table>
</li>
</ul>


<a name="content"><!--   --></a>
<!-- ========== CONTENT =========== -->
<ul class="blockList">
<li class="blockList">
<ul class="blockList">
<li class="blockList">
<h3>Content</h3>
<pre>
/* TESSExcessMassTest.do */
* This carries out the excess mass test and welfare correction 

/** 
This carries out the excess mass test and welfare correction
@author Allcott and Taubinsky */


***********************************************************
*** PRELIMINARY: Are there more renters in the excess mass region?
use Calculations/PreppedTESSData.dta, clear	
keep if T==1
reg ExcessArea OwnHome [pweight=Weight], robust
tab OwnHome [aweight=Weight]


***********************************************************
*** STEP 1: Estimate the share of consumers that are excess mass
use Calculations/PreppedTESSData.dta, clear	
keep if T==1&WTP2!=.&WTP1!=. // limit entire sample in the same way for consistency

	** uncomment these lines to check the weighting
	*gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)
	*replace Weight1 = cond(ExcessArea==0,Weight,Weight/5.1)

collapse (sum) Weight, by(WTP2)
compress
	
sum Weight, meanonly
replace Weight=Weight/r(sum)
	
drop if WTP2==-15|WTP2==15
gen Width = cond(inlist(WTP2,-9,-7,-5,5,7,9),2,1)
gen ExcessArea = cond(WTP2>=-2&WTP2<=4,1,0)
	** Generate ExcessArea indicators
	local i = 1
	foreach wtp2 in -1.5 -0.5 0.5 1.5 2.5 3.5 {
		gen byte ExcessArea_WTP2_`i' = ExcessArea*(WTP2==`wtp2')
		local i = `i' + 1
	}

	* Basic regression
	reg Weight Width ExcessArea, robust nocons
	* coefficient of 0.064 density over area of 6 suggests a 38% excess mass.
	predict WeightHat0
	twoway (line WeightHat0 Weight WTP2)
	
	* With ExcessArea dummies
	reg Weight Width ExcessArea_WTP2_*, robust nocons
	predict WeightHat1
	twoway (line WeightHat1 Weight WTP2)
	
	* With quadratic approximation to demand
		* The figures show that this is definitely the best approximation.
	reg Weight Width c.Width#c.WTP2 ExcessArea_WTP2_*, robust nocons	
	predict WeightHat2
	twoway (line WeightHat2 Weight WTP2)
	
	
	gen PredictedWeightWithoutExcessMass = _b[Width]*Width + Width*WTP2*_b[c.Width#c.WTP2]
	twoway (line WeightHat2 PredictedWeightWithoutExcessMass WTP2)
	
	* Get the difference between predicted and fitted weights
		 * (This is also the sum of \xi in the regression.)
	gen PredictedExcessMass = WeightHat2-PredictedWeightWithoutExcessMass
	
	** This is the share of consumers on interval ExcessArea that are excess mass.	
	sum WeightHat2 PredictedExcessMass PredictedWeightWithoutExcessMass if ExcessArea==1
	display .0637922 * 6 // share of total Treatment group that is excess mass.
	display .0637922 / .0764168
	display 0.0637922/(0.0764168-0.0637922)
	
	gen ExcessMassShare = PredictedExcessMass/WeightHat2 // This is the share of consumers in each WTP2 interval that are excess mass
	
	save Calculations/ExcessMass.dta, replace
	
***********************************************************
**** STEP 2: Calculate the share of consumers at each WTP1 that represent excess mass on interval ExcessArea
use Calculations/PreppedTESSData.dta, clear
keep if T==1&WTP2!=.&WTP1!=.

* Only some of the excess mass is truly excess: the difference between the predicted and fitted weights:
merge m:1 WTP2 using Calculations/ExcessMass.dta, keepusing(ExcessMassShare) nogen
replace ExcessMassShare=0 if WTP2==15|WTP2==-15

collapse (mean) ExcessMassShare [aweight=Weight],by(WTP1)
keep if WTP1<0
gsort -WTP1
outsheet using Output/ExcessMassShare.csv, comma names replace


***********************************************************
**** FOR STEP 3: Calculate average WTP after re-weighting to eliminate excess mass
use Calculations/PreppedTESSData.dta, clear
keep if T==1&WTP2!=.&WTP1!=.

merge m:1 WTP2 using Calculations/ExcessMass.dta, keepusing(ExcessMassShare)
replace ExcessMassShare=0 if WTP2==15|WTP2==-15

gen Weight1 = cond(ExcessArea==0,Weight,Weight*(1-ExcessMassShare))

	* Check regression to make sure that the reweighting worked
	*collapse (sum) Weight1, by(WTP2)
	*drop if WTP2==15|WTP2==-15
	*twoway (line Weight1 WTP2)
	

sum WTP2 [aweight=Weight] if T==1 
sum WTP2 [aweight=Weight1] if T==1 
	* Mean WTP = 7.66


</pre>
</li>
</ul>
</li>
</ul>


<ul class="blockList">
<li class="blockList">
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== TOKENS =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Tokens</h3>
<span style="font-size: 8pt;"><a class="tokens" href="../tokens/t.html#TESSExcessMassTest">TESSExcessMassTest</a></span>&nbsp;&nbsp;
<span style="font-size: 7pt;"><a class="tokens" href="../files/Analysis_Code_TESSExcessMassTest.do.html">TESSExcessMassTest do</a></span>&nbsp;&nbsp;
</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ========= START OF BOTTOM NAVBAR ========= -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do">Prev</a>	
	</li>
<li>
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do" >Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../index.html?files/Analysis_Code_TESSExcessMassTest.do.html" target="_top">Frames</a></li>
<li><a href="../files/Analysis_Code_TESSExcessMassTest.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ========= END OF BOTTOM NAVBAR ========= -->
</body>
</html>