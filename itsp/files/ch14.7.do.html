<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<!-- Generated by statdoc (version v0.9.2-beta) on 2015-09-23 10:12:38 -->
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<title>itsp</title>
<meta name="date" content="2015-09-23">
<script src="../d3.min.js"></script>
<script src="../statdoc.js"></script>
</head>
<body>

<!-- ========= START OF TOP NAVBAR ========= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/ch14.4.do.html" title="ch14.4.do">Prev</a>	
	</li>
<li>
    <a href="../files/ch14.8.do.html" title="ch14.8.do">Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../compare.html?files/ch14.7.do.html" target="_top">Compare</a></li>
<li><a href="../index.html?files/ch14.7.do.html" target="_top">Frames</a></li>
<li><a href="../files/ch14.7.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= --><!-- ======== START OF FILE DATA ======== -->
<div class="header">
<div class="subTitle">itsp</div>
<h2 title="Statdoc File ch14.7.do" class="title">File ch14.7.do</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>
<table border="0" style="border-collapse: collapse;table-layout: auto;width: auto;">
  <colgroup>
    <col span="1" width="200px">
    <col width="10px" style="text-align:center;">
    <col width="200px">
    <col width="10px" style="text-align:center;">
    <col span="1" width="200px">
  </colgroup>
<tr class="inheritance">
	<!-- DEBUG match81_hash_-1034254598 -->
<!-- DEBUG [usairquality.dta] -->
<td style="text-align:right;">
    

</td>
<td colspan="1" style="text-align:center; background: #ffff99;">

<i>&nbsp;[<a href="../files/ch14.7.do.html#81" title="ch14.7.do:81 (use)">81</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/usairquality.dta.html" title="usairquality.dta"  target="classFrame" >usairquality.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG matchback_ofmatch23_hash_413165329_hash_2113968477 -->
<!-- DEBUG [master.do:23] -->
<td style="text-align:right;">
    

</td>
<td colspan="1" style="text-align:center; background: #ffff99;">

</td>  

      <td style="white-space: nowrap; background: #eeeeee;">
    <a href="../files/master.do.html" title="master.do:23 (do)"  target="classFrame" >master.do</a><b>:</b><a href="../files/master.do.html#23" title="master.do:23 (do)"  target="classFrame" >23</a>
</td>  
</tr>
<tr class="inheritance">
<td style="border: none;"></td>
<td style="text-align:center;background: #ffff99;">&rarr;</td>
<td  style="background: #ffff99;">
<span style="background: #ffff99;"><b>ch14.7.do</b></span>
</td>
<td style="text-align:center;background: #ffff99;">&#8600;</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [mf_nneighbormata] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #ffffff ;" colspan="1">
      <span style="white-space: nowrap; background: #ffffff;">
    <a href="../tokens/m.html#mf_nneighbormata" title="mf_nneighbormata"  target="classFrame" >mf_nneighbormata</a><br>
</span>  
</td> 
<td style="text-align:center; background: #ffff99;">

<i>&nbsp;[<a href="../files/ch14.7.do.html#34" title="ch14.7.do:34 (do)">34</a>]&nbsp;</i>
</td>
<td>

</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [mf_nneighbormata] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #ffffff ;" colspan="1">
      <span style="white-space: nowrap; background: #ffffff;">
    <a href="../tokens/m.html#mf_nneighbormata" title="mf_nneighbormata"  target="classFrame" >mf_nneighbormata</a><br>
</span>  
</td> 
<td style="text-align:center; background: #ffff99;">

<i>&nbsp;[<a href="../files/ch14.7.do.html#80" title="ch14.7.do:80 (do)">80</a>]&nbsp;</i>
</td>
<td>

</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>

<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><span class="strong">ch14.7.do <a href="../ch14.7.do">open</a></span>
file:script:do</pre>
</li>
</ul>

</div>
<ul class="blockList">
<li class="blockList">
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">date</td>
  <td class="colLast">Wed Sep 23 21:31:41 EST 2015</td>
  </tr>
    </tbody>
  </table>
</li>
</ul>




<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Variable Summary table, listing datasets and labels">
<caption><span><a name="variables"><!-- --></a>All commands</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" style="width:30px" scope="col">#</th>
<th class="colLast" width="100%" scope="col">content
<!-- <span style="float: right;">&nbsp;<a title="Raw Source" onclick="toggle('rawframe');setIframeHeight('rawframe');">raw</a> -->
</th>
<!--
<td style="display:none;" id="rawframe" rowspan="32" height="100%">
<iframe scrolling="yes" width="600px" height="100%" src="../files/ch14.7.do.html#content" name="statdocSubFrame_raw" title="Raw File" style="height: 100%; width: 600px; overflow-x:scroll; overflow-y:scroll; -ms-overflow-x:scroll; -ms-overflow-y:scroll;"></iframe>
</td>
-->
</tr>
 <tr class="cmd_comment altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="1" title="comment"><!-- -->
    1</a>&nbsp;<a onclick='toggle("cmd_1544101784");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:${ind}em">
  <span class="cmdcomment">* ITSP 14.7 -</span>
<div id="cmd_1544101784" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">* ITSP 14.7 -</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">* ITSP 14.7 -</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="3" title="mata"><!-- -->
    3</a>&nbsp;<a onclick='toggle("cmd_-141602519");' title="mata">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdprefix"><a href="../tokens/m.html#mata">mata</a>:</span>
 <span class="cmdcommand">mata</span>
  <span class="cmdparameters"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_-141602519" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">mata: mata clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">mata</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">prefix</td>
  <td class="colLast"><a href="../tokens/m.html#mata">mata</a>:</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="4" title="clear"><!-- -->
    4</a>&nbsp;<a onclick='toggle("cmd_1737197214");' title="clear">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">clear</span>
  <span class="cmdparameters"></span>
<div id="cmd_1737197214" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">clear</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="6" title="type"><!-- -->
    6</a>&nbsp;<a onclick='toggle("cmd_2022576787");' title="type">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">type</span>
  <span class="cmdparameters"><a href="../tokens/n.html#nneighbor">nneighbor</a>.<a href="../tokens/a.html#ado">ado</a></span>
<div id="cmd_2022576787" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">type nneighbor.ado</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">type</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/n.html#nneighbor">nneighbor</a>.<a href="../tokens/a.html#ado">ado</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_comment altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="8" title="comment"><!-- -->
    8</a>&nbsp;<a onclick='toggle("cmd_-1505443866");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
  <span class="cmdcomment">
/*
program nneighbor
	version 10.1
	syntax varlist(numeric) [if] [in], Y(string) MATCHOBS(string) MATCHVAL(string)

	marksample touse
	if r(N) == 0 {
		error 2000
	}
// validate new variable names
	confirm numeric variable `y'
	confirm new variable `matchobs'
	confirm new variable `matchval'
	qui	generate long `matchobs' = .
	qui generate `matchval' = .
	mata: mf_nneighbor("`varlist'", "`matchobs'", "`y'", "`matchval'", "`touse'")
	su `y' if `touse', meanonly
	di _n "Nearest neighbors for `r(N)' observations of `y'"
	di    "Based on 2-norm of vars: `varlist'"
	di    "Matched observation numbers: `matchobs'"
	di    "Matched values: `matchval'"
	qui correlate `y' `matchval' if `touse'
	di    "Correlation[ `y', `matchval' ] = " %5.4f `r(rho)'
end
*/</span>
<div id="cmd_-1505443866" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/*
program nneighbor
	version 10.1
	syntax varlist(numeric) [if] [in], Y(string) MATCHOBS(string) MATCHVAL(string)

	marksample touse
	if r(N) == 0 {
		error 2000
	}
// validate new variable names
	confirm numeric variable `y'
	confirm new variable `matchobs'
	confirm new variable `matchval'
	qui	generate long `matchobs' = .
	qui generate `matchval' = .
	mata: mf_nneighbor("`varlist'", "`matchobs'", "`y'", "`matchval'", "`touse'")
	su `y' if `touse', meanonly
	di _n "Nearest neighbors for `r(N)' observations of `y'"
	di    "Based on 2-norm of vars: `varlist'"
	di    "Matched observation numbers: `matchobs'"
	di    "Matched values: `matchval'"
	qui correlate `y' `matchval' if `touse'
	di    "Correlation[ `y', `matchval' ] = " %5.4f `r(rho)'
end
*/</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">
/*
program nneighbor
	version 10.1
	syntax varlist(numeric) [if] [in], Y(string) MATCHOBS(string) MATCHVAL(string)

	marksample touse
	if r(N) == 0 {
		error 2000
	}
// validate new variable names
	confirm numeric variable `y'
	confirm new variable `matchobs'
	confirm new variable `matchval'
	qui	generate long `matchobs' = .
	qui generate `matchval' = .
	mata: mf_nneighbor("`varlist'", "`matchobs'", "`y'", "`matchval'", "`touse'")
	su `y' if `touse', meanonly
	di _n "Nearest neighbors for `r(N)' observations of `y'"
	di    "Based on 2-norm of vars: `varlist'"
	di    "Matched observation numbers: `matchobs'"
	di    "Matched values: `matchval'"
	qui correlate `y' `matchval' if `touse'
	di    "Correlation[ `y', `matchval' ] = " %5.4f `r(rho)'
end
*/</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_runcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="34" title="do"><!-- -->
    34</a>&nbsp;<a onclick='toggle("cmd_1469392960");' title="do">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">do</span>
  <span class="cmdparameters"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></span>
<div id="cmd_1469392960" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">do mf_nneighbor.mata</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">do</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="36" title="type"><!-- -->
    36</a>&nbsp;<a onclick='toggle("cmd_1560681802");' title="type">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">type</span>
  <span class="cmdparameters"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></span>
<div id="cmd_1560681802" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">type mf_nneighbor.mata</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">type</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> /* version 10.1</div></td>
</tr>
<tr class="cmd_mata rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="40" title="mata"><!-- -->
    40</a>&nbsp;<a onclick='toggle("cmd_-1423339134");' title="mata">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">mata</span>
  <span class="cmdcomment">block (38 lines)</span>
<div id="cmd_-1423339134" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
mata:
void function mf_nneighbor(string scalar matchvars,
						   string scalar closest,
						   string scalar response,
						   string scalar match,
						   string scalar touse) 
{
	real matrix X, Z, mc
	real colvector ind
	real colvector w
	real colvector d
	string rowvector vars
	vars = tokens(matchvars)
	v = vars[|1, .|]
	st_view(X, ., v, touse)
// standardize matchvars with mm_meancolvar from moremata
	mc = mm_meancolvar(X)
	Z = (X:- mc[1, .]):/ sqrt(mc[2, .]) 
	n = rows(X)
	k = cols(X)
	st_view(C, ., closest, touse)
	st_view(y, ., response, touse)
	st_view(ystar, ., match, touse)

// loop over observations
	for(i = 1; i <= n; i++) {
// loop over matchvars
		d = J(n, 1, 0)
		for(j = 1; j <= k; j++) {
			d = d + (Z[., j]:- Z[i, j]) :^2
	}
	d = sqrt(d)
	minindex(d, 2, ind, w)
	C[i] = ind[2]
	ystar[i] = y[ind[2]] 
	}
}
end</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">mata</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">block (38 lines)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_comment altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="78" title="comment"><!-- -->
    78</a>&nbsp;<a onclick='toggle("cmd_1864501632");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
  <span class="cmdcomment">*/</span>
<div id="cmd_1864501632" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">*/</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">comment</td>
  <td class="colLast">*/</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_runcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="80" title="do"><!-- -->
    80</a>&nbsp;<a onclick='toggle("cmd_1424129719");' title="do">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">do</span>
  <span class="cmdparameters"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></span>
<div id="cmd_1424129719" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">do mf_nneighbor.mata</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">do</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/m.html#mf_nneighbor">mf_nneighbor</a>.<a href="../tokens/m.html#mata">mata</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="81" title="use"><!-- -->
    81</a>&nbsp;<a onclick='toggle("cmd_467831862");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/u.html#usairquality">usairquality</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_467831862" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">use usairquality, clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/u.html#usairquality">usairquality</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="82" title="sort"><!-- -->
    82</a>&nbsp;<a onclick='toggle("cmd_1567946847");' title="sort">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">sort</span>
  <span class="cmdparameters"><a href="../variables/pop.html">pop</a></span>
<div id="cmd_1567946847" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">sort pop</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">sort</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/pop.html">pop</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="83" title="nneighbor"><!-- -->
    83</a>&nbsp;<a onclick='toggle("cmd_1835748216");' title="nneighbor">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">nneighbor</span>
  <span class="cmdparameters"><a href="../variables/pop.html">pop</a></span>
, <span class="cmdoptions"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../tokens/m.html#mo1">mo1</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../tokens/m.html#mv1">mv1</a>)</span>
<div id="cmd_1835748216" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">nneighbor pop, y(so2) matchobs(mo1) matchval(mv1)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">nneighbor</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../tokens/m.html#mo1">mo1</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../tokens/m.html#mv1">mv1</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/pop.html">pop</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_statcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="84" title="list"><!-- -->
    84</a>&nbsp;<a onclick='toggle("cmd_456368409");' title="list">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">list</span>
  <span class="cmdparameters"><a href="../variables/pop.html">pop</a> <a href="../tokens/m.html#mo1">mo1</a> <a href="../variables/so2.html">so2</a> <a href="../tokens/m.html#mv1">mv1</a></span>
, <span class="cmdoptions"> <a href="../tokens/s.html#sep">sep(</a>0)</span>
<div id="cmd_456368409" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">list pop mo1 so2 mv1, sep(0)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">list</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/s.html#sep">sep(</a>0)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/pop.html">pop</a> <a href="../tokens/m.html#mo1">mo1</a> <a href="../variables/so2.html">so2</a> <a href="../tokens/m.html#mv1">mv1</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="86" title="nneighbor"><!-- -->
    86</a>&nbsp;<a onclick='toggle("cmd_-643528605");' title="nneighbor">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">nneighbor</span>
  <span class="cmdparameters"><a href="../variables/pop.html">pop</a> <a href="../variables/temp.html">temp</a> <a href="../variables/wind.html">wind</a></span>
, <span class="cmdoptions"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../files/ch14.7.do.html#86">mo3</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../files/ch14.7.do.html#86">mv3</a>)</span>
<div id="cmd_-643528605" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">nneighbor pop temp wind, y(so2) matchobs(mo3) matchval(mv3)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">nneighbor</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../files/ch14.7.do.html#86">mo3</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../files/ch14.7.do.html#86">mv3</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/pop.html">pop</a> <a href="../variables/temp.html">temp</a> <a href="../variables/wind.html">wind</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="87" title="nneighbor"><!-- -->
    87</a>&nbsp;<a onclick='toggle("cmd_328335817");' title="nneighbor">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">nneighbor</span>
  <span class="cmdparameters"><a href="../variables/pop.html">pop</a> <a href="../variables/temp.html">temp</a> <a href="../variables/wind.html">wind</a> <a href="../variables/precip.html">precip</a> <a href="../variables/days.html">days</a></span>
, <span class="cmdoptions"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../files/ch14.7.do.html#87">mo5</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../files/ch14.7.do.html#87">mv5</a>)</span>
<div id="cmd_328335817" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">nneighbor pop temp wind precip days, y(so2) matchobs(mo5) matchval(mv5)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">nneighbor</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/y.html#y">y(</a><a href="../variables/so2.html">so2</a>) <a href="../tokens/m.html#matchobs">matchobs(</a><a href="../files/ch14.7.do.html#87">mo5</a>) <a href="../tokens/m.html#matchval">matchval(</a><a href="../files/ch14.7.do.html#87">mv5</a>)</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/pop.html">pop</a> <a href="../variables/temp.html">temp</a> <a href="../variables/wind.html">wind</a> <a href="../variables/precip.html">precip</a> <a href="../variables/days.html">days</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
</table>
</li>
</ul>


<a name="content"><!--   --></a>
<!-- ========== CONTENT =========== -->
<ul class="blockList">
<li class="blockList">
<ul class="blockList">
<li class="blockList">
<h3>Content</h3>
<pre>
* ITSP 14.7 -

mata: mata clear
clear

type nneighbor.ado

/*
program nneighbor
	version 10.1
	syntax varlist(numeric) [if] [in], Y(string) MATCHOBS(string) MATCHVAL(string)

	marksample touse
	if r(N) == 0 {
		error 2000
	}
// validate new variable names
	confirm numeric variable `y'
	confirm new variable `matchobs'
	confirm new variable `matchval'
	qui	generate long `matchobs' = .
	qui generate `matchval' = .
	mata: mf_nneighbor("`varlist'", "`matchobs'", "`y'", "`matchval'", "`touse'")
	su `y' if `touse', meanonly
	di _n "Nearest neighbors for `r(N)' observations of `y'"
	di    "Based on 2-norm of vars: `varlist'"
	di    "Matched observation numbers: `matchobs'"
	di    "Matched values: `matchval'"
	qui correlate `y' `matchval' if `touse'
	di    "Correlation[ `y', `matchval' ] = " %5.4f `r(rho)'
end
*/

do mf_nneighbor.mata

type mf_nneighbor.mata

/*
version 10.1
mata:
void function mf_nneighbor(string scalar matchvars,
						   string scalar closest,
						   string scalar response,
						   string scalar match,
						   string scalar touse) 
{
	real matrix X, Z, mc
	real colvector ind
	real colvector w
	real colvector d
	string rowvector vars
	vars = tokens(matchvars)
	v = vars[|1, .|]
	st_view(X, ., v, touse)
// standardize matchvars with mm_meancolvar from moremata
	mc = mm_meancolvar(X)
	Z = (X:- mc[1, .]):/ sqrt(mc[2, .]) 
	n = rows(X)
	k = cols(X)
	st_view(C, ., closest, touse)
	st_view(y, ., response, touse)
	st_view(ystar, ., match, touse)

// loop over observations
	for(i = 1; i <= n; i++) {
// loop over matchvars
		d = J(n, 1, 0)
		for(j = 1; j <= k; j++) {
			d = d + (Z[., j]:- Z[i, j]) :^2
	}
	d = sqrt(d)
	minindex(d, 2, ind, w)
	C[i] = ind[2]
	ystar[i] = y[ind[2]] 
	}
}
end
*/

do mf_nneighbor.mata
use usairquality, clear
sort pop
nneighbor pop, y(so2) matchobs(mo1) matchval(mv1)
list pop mo1 so2 mv1, sep(0)

nneighbor pop temp wind, y(so2) matchobs(mo3) matchval(mv3)
nneighbor pop temp wind precip days, y(so2) matchobs(mo5) matchval(mv5)

 

</pre>
</li>
</ul>
</li>
</ul>


<ul class="blockList">
<li class="blockList">
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== TOKENS =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Tokens</h3>
</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ========= START OF BOTTOM NAVBAR ========= -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/ch14.4.do.html" title="ch14.4.do">Prev</a>	
	</li>
<li>
    <a href="../files/ch14.8.do.html" title="ch14.8.do" >Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../index.html?files/ch14.7.do.html" target="_top">Frames</a></li>
<li><a href="../files/ch14.7.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ========= END OF BOTTOM NAVBAR ========= -->
</body>
</html>