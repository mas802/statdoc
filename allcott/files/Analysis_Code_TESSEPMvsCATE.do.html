<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<!-- Generated by statdoc (version v0.9.2-beta) on 2015-09-23 10:00:45 -->
<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<title>Lightbulbs</title>
<meta name="date" content="2015-09-23">
<script src="../d3.min.js"></script>
<script src="../statdoc.js"></script>
</head>
<body>

<!-- ========= START OF TOP NAVBAR ========= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/Analysis_Code_TESSDescriptiveStatsandBaselineDemand.do.html" title="Analysis/Code/TESSDescriptiveStatsandBaselineDemand.do">Prev</a>	
	</li>
<li>
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do">Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../compare.html?files/Analysis_Code_TESSEPMvsCATE.do.html" target="_top">Compare</a></li>
<li><a href="../index.html?files/Analysis_Code_TESSEPMvsCATE.do.html" target="_top">Frames</a></li>
<li><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= --><!-- ======== START OF FILE DATA ======== -->
<div class="header">
<div class="subTitle">Lightbulbs</div>
<h2 title="Statdoc File TESSEPMvsCATE.do" class="title">File TESSEPMvsCATE.do</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>
<table border="0" style="border-collapse: collapse;table-layout: auto;width: auto;">
  <colgroup>
    <col span="1" width="200px">
    <col width="10px" style="text-align:center;">
    <col width="200px">
    <col width="10px" style="text-align:center;">
    <col span="1" width="200px">
  </colgroup>
<tr class="inheritance">
	<!-- DEBUG match24_hash_-109725081 -->
<!-- DEBUG [PreppedTESSData.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fffffd;">
    <a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >Analysis/Co..SLightbulbsDataPrep.do</a><b>:</b><a href="../files/Analysis_Code_TESSLightbulbsDataPrep.do.html#510" title="Analysis/Code/TESSLightbulbsDataPrep.do:510 (save)"  target="classFrame" >510</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff9f3;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#24" title="Analysis/Code/TESSEPMvsCATE.do:24 (use)">24</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_PreppedTESSData.dta.html" title="Analysis/Calculations/PreppedTESSData.dta"  target="classFrame" >Analysis/Ca..ns/PreppedTESSData.dta</a>
</td>  
</tr>
<tr class="inheritance">
	<!-- DEBUG match44_hash_-117118718 -->
<!-- DEBUG [EPMvsAMT.dta] -->
<td style="text-align:right;">
    

      <span style="white-space: nowrap; background: #fff9f3;">
    <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do:12 (save)"  target="classFrame" >Analysis/Code/TESSEPMvsCATE.do</a><b>:</b><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#12" title="Analysis/Code/TESSEPMvsCATE.do:12 (save)"  target="classFrame" >12</a><br>
</span>  
      <span style="white-space: nowrap; background: #fff9f3;">
    <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do:50 (save)"  target="classFrame" >Analysis/Code/TESSEPMvsCATE.do</a><b>:</b><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#50" title="Analysis/Code/TESSEPMvsCATE.do:50 (save)"  target="classFrame" >50</a><br>
</span>  
</td>
<td colspan="1" style="text-align:center; background: #fff9f3;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#44" title="Analysis/Code/TESSEPMvsCATE.do:44 (use)">44</a>]&nbsp;</i>
</td>  

      <td style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_EPMvsAMT.dta.html" title="Analysis/Calculations/EPMvsAMT.dta"  target="classFrame" >Analysis/Calculations/EPMvsAMT.dta</a>
</td>  
</tr>
<tr class="inheritance">
<td style="border: none;"></td>
<td style="text-align:center;background: #fff9f3;">&rarr;</td>
<td  style="background: #fff9f3;">
<span style="background: #fff9f3;"><b>Analysis/Code/TESSEPMvsCATE.do</b></span>
</td>
<td style="text-align:center;background: #fff9f3;">&#8600;</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [EPMvsAMT.dta] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #eeeeff ;" colspan="1">
      <span style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_EPMvsAMT.dta.html" title="Analysis/Calculations/EPMvsAMT.dta"  target="classFrame" >Analysis/Calculations/EPMvsAMT.dta</a><br>
</span>  
</td> 
<td style="text-align:center; background: #fff9f3;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#50" title="Analysis/Code/TESSEPMvsCATE.do:50 (save)">50</a>]&nbsp;</i>
</td>
<td>

      <span style="white-space: nowrap; background: #fff9f3;">
    <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do:44 (use)"  target="classFrame" >Analysis/Code/TESSEPMvsCATE.do</a><b>:</b><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#44" title="Analysis/Code/TESSEPMvsCATE.do:44 (use)"  target="classFrame" >44</a><br>
</span>  
</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [EPMvsAMT.csv] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #eeeeff ;" colspan="1">
      <span style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Output_EPMvsAMT.csv.html" title="Analysis/Output/EPMvsAMT.csv"  target="classFrame" >Analysis/Output/EPMvsAMT.csv</a><br>
</span>  
</td> 
<td style="text-align:center; background: #fff9f3;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#54" title="Analysis/Code/TESSEPMvsCATE.do:54 (outsheet)">54</a>]&nbsp;</i>
</td>
<td>

</td>
</tr>
<tr class="inheritance">
<!-- DEBUG [EPMvsAMT.dta] -->
<td colspan="2" style="border: none;"></td>

<td style="text-align:right; background:  #eeeeff ;" colspan="1">
      <span style="white-space: nowrap; background: #eeeeff;">
    <a href="../files/Analysis_Calculations_EPMvsAMT.dta.html" title="Analysis/Calculations/EPMvsAMT.dta"  target="classFrame" >Analysis/Calculations/EPMvsAMT.dta</a><br>
</span>  
</td> 
<td style="text-align:center; background: #fff9f3;">

<i>&nbsp;[<a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#12" title="Analysis/Code/TESSEPMvsCATE.do:12 (save)">12</a>]&nbsp;</i>
</td>
<td>

      <span style="white-space: nowrap; background: #fff9f3;">
    <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" title="Analysis/Code/TESSEPMvsCATE.do:44 (use)"  target="classFrame" >Analysis/Code/TESSEPMvsCATE.do</a><b>:</b><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#44" title="Analysis/Code/TESSEPMvsCATE.do:44 (use)"  target="classFrame" >44</a><br>
</span>  
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>

<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><span class="strong">Analysis/Code/TESSEPMvsCATE.do <a href="../Analysis/Code/TESSEPMvsCATE.do">open</a></span>
file:script:do</pre>
</li>
</ul>

</div>
<ul class="blockList">
<li class="blockList">
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">author</td>
  <td class="colLast">Allcott and Taubinsky</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">date</td>
  <td class="colLast">Wed Sep 16 16:27:00 EST 2015</td>
  </tr>
    </tbody>
  </table>
</li>
</ul>




<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Variable Summary table, listing datasets and labels">
<caption><span><a name="variables"><!-- --></a>All commands</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" style="width:30px" scope="col">#</th>
<th class="colLast" width="100%" scope="col">content
<!-- <span style="float: right;">&nbsp;<a title="Raw Source" onclick="toggle('rawframe');setIframeHeight('rawframe');">raw</a> -->
</th>
<!--
<td style="display:none;" id="rawframe" rowspan="60" height="100%">
<iframe scrolling="yes" width="600px" height="100%" src="../files/Analysis_Code_TESSEPMvsCATE.do.html#content" name="statdocSubFrame_raw" title="Raw File" style="height: 100%; width: 600px; overflow-x:scroll; overflow-y:scroll; -ms-overflow-x:scroll; -ms-overflow-y:scroll;"></iframe>
</td>
-->
</tr>
 <tr class="cmd_comment altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="1" title="comment"><!-- -->
    1</a>&nbsp;<a onclick='toggle("cmd_-132369449");' title="comment">[+]</a>
</td>
<td class="colLast" style="padding-left:${ind}em">
  <span class="cmdcomment">
/* TESSEPMvsCATE.do */</span>
<div id="cmd_-132369449" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* TESSEPMvsCATE.do */</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">
/* TESSEPMvsCATE.do */</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> /* Set up results storage dataset */</div></td>
</tr>
<tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="6" title="global"><!-- -->
    6</a>&nbsp;<a onclick='toggle("cmd_-528827785");' title="global">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">global</span>
  <span class="cmdparameters"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#6">VarList</a> = "<a href="../tokens/v.html#vMax">vMax</a> <a href="../tokens/q.html#QuantityEffect">QuantityEffect</a> <a href="../tokens/q.html#QuantityEffectse">QuantityEffectse</a> <a href="../tokens/s.html#SubsidyEffect">SubsidyEffect</a> <a href="../tokens/s.html#SubsidyEffectse">SubsidyEffectse</a> <a href="../tokens/d.html#DemandSlope">DemandSlope</a> <a href="../tokens/d.html#DemandSlopese">DemandSlopese</a> <a href="../tokens/e.html#EPM">EPM</a> <a href="../tokens/e.html#EPMse">EPMse</a>"</span>
<div id="cmd_-528827785" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* Set up results storage dataset */
global VarList = "vMax QuantityEffect QuantityEffectse SubsidyEffect SubsidyEffectse DemandSlope DemandSlopese EPM EPMse"</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">global</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#6">VarList</a> = "<a href="../tokens/v.html#vMax">vMax</a> <a href="../tokens/q.html#QuantityEffect">QuantityEffect</a> <a href="../tokens/q.html#QuantityEffectse">QuantityEffectse</a> <a href="../tokens/s.html#SubsidyEffect">SubsidyEffect</a> <a href="../tokens/s.html#SubsidyEffectse">SubsidyEffectse</a> <a href="../tokens/d.html#DemandSlope">DemandSlope</a> <a href="../tokens/d.html#DemandSlopese">DemandSlopese</a> <a href="../tokens/e.html#EPM">EPM</a> <a href="../tokens/e.html#EPMse">EPMse</a>"</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="7" title="clear"><!-- -->
    7</a>&nbsp;<a onclick='toggle("cmd_1574191551");' title="clear">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">clear</span>
  <span class="cmdparameters"></span>
<div id="cmd_1574191551" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">clear</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="8" title="foreach"><!-- -->
    8</a>&nbsp;<a onclick='toggle("cmd_785987253");' title="foreach">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">foreach</span>
  <span class="cmdparameters"><a href="../variables/variable.html">variable</a></span>
in <span class="cmdin">$VarList {</span>
<div id="cmd_785987253" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">foreach variable in $VarList {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">foreach</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">in</td>
  <td class="colLast">$VarList {</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/variable.html">variable</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="9" title="gen"><!-- -->
    9</a>&nbsp;<a onclick='toggle("cmd_546283413");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters">`variable' = .</span>
<div id="cmd_546283413" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen `variable' = . </pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">`variable' = .</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="10" title="}"><!-- -->
    10</a>&nbsp;<a onclick='toggle("cmd_1763452118");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_1763452118" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_outputcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="12" title="save"><!-- -->
    12</a>&nbsp;<a onclick='toggle("cmd_1484106027");' title="save">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">save</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/e.html#EPMvsAMT">EPMvsAMT</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#replace">replace</a> <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#12">emptyok</a></span>
<div id="cmd_1484106027" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">save Calculations/EPMvsAMT.dta, replace emptyok</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">save</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#replace">replace</a> <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#12">emptyok</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/e.html#EPMvsAMT">EPMvsAMT</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:0em"><div class="cmd_comment"> /* Estimate EPM function at different points */ *forvalues vMax = 4(-1)-3 { // This code only works for one-dollar increments, otherwise need to code the increment level</div></td>
</tr>
<tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="17" title="foreach"><!-- -->
    17</a>&nbsp;<a onclick='toggle("cmd_-1656437280");' title="foreach">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">foreach</span>
  <span class="cmdparameters"><a href="../tokens/v.html#vMax">vMax</a></span>
in <span class="cmdin">8 6 4 3 2 1 0 -1 -2 {</span>
<div id="cmd_-1656437280" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">
/* Estimate EPM function at different points */
*forvalues vMax = 4(-1)-3 { // This code only works for one-dollar increments, otherwise need to code the increment level
foreach vMax in 8 6 4 3 2 1 0 -1 -2 {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">foreach</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">in</td>
  <td class="colLast">8 6 4 3 2 1 0 -1 -2 {</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/v.html#vMax">vMax</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:2em"><div class="cmd_comment"> *foreach vMax in 0 {</div></td>
</tr>
<tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="19" title="local"><!-- -->
    19</a>&nbsp;<a onclick='toggle("cmd_1355520231");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/s.html#subsidy">subsidy</a> = 1</span>
<div id="cmd_1355520231" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">*foreach vMax in 0 {
	local subsidy = 1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/s.html#subsidy">subsidy</a> = 1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="20" title="if"><!-- -->
    20</a>&nbsp;<a onclick='toggle("cmd_-107586570");' title="if">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">if</span>
  <span class="cmdparameters">`vMax' >= 6 | `vMax' <= -4 {</span>
<div id="cmd_-107586570" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	if `vMax' >= 6 | `vMax' <= -4 {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">if</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">`vMax' >= 6 | `vMax' <= -4 {</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="21" title="local"><!-- -->
    21</a>&nbsp;<a onclick='toggle("cmd_1862084983");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters"><a href="../tokens/s.html#subsidy">subsidy</a> = 2</span>
<div id="cmd_1862084983" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		local subsidy = 2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/s.html#subsidy">subsidy</a> = 2</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="22" title="}"><!-- -->
    22</a>&nbsp;<a onclick='toggle("cmd_805212446");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_805212446" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_importcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="24" title="use"><!-- -->
    24</a>&nbsp;<a onclick='toggle("cmd_1394396049");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_1394396049" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	use Calculations/PreppedTESSData.dta, clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Calculations">Calculations</a>/<a href="../tokens/p.html#PreppedTESSData">PreppedTESSData</a>.<a href="../tokens/d.html#dta">dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="26" title="gen"><!-- -->
    26</a>&nbsp;<a onclick='toggle("cmd_1992534101");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#26">PurchaseCFL0</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=`vMax',1,0)</span>
if <span class="cmdif"><a href="../tokens/w.html#WTP2">WTP2</a>!=.</span>
<div id="cmd_1992534101" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen PurchaseCFL0 = cond(WTP2>=`vMax',1,0) if WTP2!=.</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a>!=.</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#26">PurchaseCFL0</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=`vMax',1,0)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="27" title="gen"><!-- -->
    27</a>&nbsp;<a onclick='toggle("cmd_2059922646");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/p.html#PurchaseCFL1">PurchaseCFL1</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=`vMax'-`subsidy',1,0)</span>
if <span class="cmdif"><a href="../tokens/w.html#WTP2">WTP2</a>!=.</span>
<div id="cmd_2059922646" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen PurchaseCFL1 = cond(WTP2>=`vMax'-`subsidy',1,0) if WTP2!=.</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/w.html#WTP2">WTP2</a>!=.</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/p.html#PurchaseCFL1">PurchaseCFL1</a> = <a href="../tokens/c.html#cond">cond(</a><a href="../tokens/w.html#WTP2">WTP2</a>>=`vMax'-`subsidy',1,0)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="29" title="keep"><!-- -->
    29</a>&nbsp;<a onclick='toggle("cmd_1049432312");' title="keep">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">keep</span>
  <span class="cmdparameters"><a href="../tokens/p.html#PurchaseCFL">PurchaseCFL?</a> T <a href="../tokens/e.html#EndlineOnly">EndlineOnly</a> <a href="../tokens/i.html#ID">ID</a> <a href="../tokens/w.html#Weight">Weight</a></span>
  <span class="cmdcomment">// $DemographicVars WTP1_C*  WTP2</span>
<div id="cmd_1049432312" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	keep PurchaseCFL? T EndlineOnly ID Weight // $DemographicVars WTP1_C*  WTP2</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">keep</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">comment</td>
  <td class="colLast">// $DemographicVars WTP1_C*  WTP2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/p.html#PurchaseCFL">PurchaseCFL?</a> T <a href="../tokens/e.html#EndlineOnly">EndlineOnly</a> <a href="../tokens/i.html#ID">ID</a> <a href="../tokens/w.html#Weight">Weight</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="30" title="reshape"><!-- -->
    30</a>&nbsp;<a onclick='toggle("cmd_229236764");' title="reshape">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">reshape</span>
  <span class="cmdparameters"><a href="../tokens/l.html#long">long</a> <a href="../tokens/p.html#PurchaseCFL">PurchaseCFL</a></span>
, <span class="cmdoptions"> <a href="../tokens/i.html#i">i(</a><a href="../tokens/i.html#ID">ID</a>) <a href="../tokens/j.html#j">j(</a><a href="../tokens/s.html#Subsidy">Subsidy</a>)</span>
<div id="cmd_229236764" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	reshape long PurchaseCFL, i(ID) j(Subsidy)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">reshape</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/i.html#i">i(</a><a href="../tokens/i.html#ID">ID</a>) <a href="../tokens/j.html#j">j(</a><a href="../tokens/s.html#Subsidy">Subsidy</a>)</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/l.html#long">long</a> <a href="../tokens/p.html#PurchaseCFL">PurchaseCFL</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="32" title="gen"><!-- -->
    32</a>&nbsp;<a onclick='toggle("cmd_-1349597425");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../tokens/s.html#SubsidyxT">SubsidyxT</a> = <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#32">Subsidy*T</a></span>
<div id="cmd_-1349597425" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen SubsidyxT = Subsidy*T</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/s.html#SubsidyxT">SubsidyxT</a> = <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#32">Subsidy*T</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="33" title="gen"><!-- -->
    33</a>&nbsp;<a onclick='toggle("cmd_1436376510");' title="gen">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">gen</span>
  <span class="cmdparameters"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#33">SubsidyxC</a> = <a href="../tokens/s.html#Subsidy">Subsidy*(</a>1-T)</span>
<div id="cmd_1436376510" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	gen SubsidyxC = Subsidy*(1-T)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">gen</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#33">SubsidyxC</a> = <a href="../tokens/s.html#Subsidy">Subsidy*(</a>1-T)</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:2em"><div class="cmd_comment"> * Note: The first two variables must be the measure of QuantityEffect and the measure of SubsidyEffect * Use average of slopes: this makes some difference - generally makes EPMs smaller *reg PurchaseCFL T Subsidy [pweight=Weight], cluster(ID) * Exclude EndlineOnly: this makes little difference *reg PurchaseCFL T SubsidyxT SubsidyxC [pweight=Weight], cluster(ID), if EndlineOnly==0</div></td>
</tr>
<tr class="cmd_estcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="39" title="reg"><!-- -->
    39</a>&nbsp;<a onclick='toggle("cmd_-949768606");' title="reg">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">reg</span>
  <span class="cmdparameters"><a href="../tokens/p.html#PurchaseCFL">PurchaseCFL</a> T <a href="../tokens/s.html#Subsidy">Subsidy</a> <a href="../tokens/s.html#SubsidyxT">SubsidyxT</a> [<a href="../tokens/p.html#pweight">pweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</span>
, <span class="cmdoptions"> <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#39">cluster(</a><a href="../tokens/i.html#ID">ID</a>)</span>
<div id="cmd_-949768606" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		* Note: The first two variables must be the measure of QuantityEffect and the measure of SubsidyEffect
		* Use average of slopes: this makes some difference - generally makes EPMs smaller
		*reg PurchaseCFL T Subsidy [pweight=Weight], cluster(ID)
		* Exclude EndlineOnly: this makes little difference
		*reg PurchaseCFL T SubsidyxT SubsidyxC [pweight=Weight], cluster(ID), if EndlineOnly==0
	reg PurchaseCFL T Subsidy SubsidyxT [pweight=Weight], cluster(ID)</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">reg</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../files/Analysis_Code_TESSEPMvsCATE.do.html#39">cluster(</a><a href="../tokens/i.html#ID">ID</a>)</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/p.html#PurchaseCFL">PurchaseCFL</a> T <a href="../tokens/s.html#Subsidy">Subsidy</a> <a href="../tokens/s.html#SubsidyxT">SubsidyxT</a> [<a href="../tokens/p.html#pweight">pweight</a>=<a href="../tokens/w.html#Weight">Weight</a>]</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_other altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="41" title="include"><!-- -->
    41</a>&nbsp;<a onclick='toggle("cmd_197494801");' title="include">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">include</span>
  <span class="cmdparameters"><a href="../tokens/c.html#Code">Code</a>/<a href="../tokens/g.html#GetEPM">GetEPM</a>.<a href="../tokens/d.html#do">do</a></span>
<div id="cmd_197494801" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	include Code/GetEPM.do</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">include</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/c.html#Code">Code</a>/<a href="../tokens/g.html#GetEPM">GetEPM</a>.<a href="../tokens/d.html#do">do</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr>
<td class="colFirst" style="width:30px"></td>
<td class="colLast" style="padding-left:2em"><div class="cmd_comment"> ** Store results</div></td>
</tr>
<tr class="cmd_importcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="44" title="use"><!-- -->
    44</a>&nbsp;<a onclick='toggle("cmd_-1357097242");' title="use">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">use</span>
  <span class="cmdparameters"><a href="../files/Analysis_Calculations_EPMvsAMT.dta.html">Calculations/EPMvsAMT.dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#clear">clear</a></span>
<div id="cmd_-1357097242" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	** Store results
	use Calculations/EPMvsAMT.dta, clear</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">use</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#clear">clear</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Calculations_EPMvsAMT.dta.html">Calculations/EPMvsAMT.dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="45" title="local"><!-- -->
    45</a>&nbsp;<a onclick='toggle("cmd_-267198451");' title="local">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">local</span>
  <span class="cmdparameters">N = <a href="../tokens/_.html#_N">_N</a>+1</span>
<div id="cmd_-267198451" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	local N = _N+1</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">local</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">N = <a href="../tokens/_.html#_N">_N</a>+1</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_systemcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="46" title="set"><!-- -->
    46</a>&nbsp;<a onclick='toggle("cmd_-284299451");' title="set">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">set</span>
  <span class="cmdparameters"><a href="../tokens/o.html#obs">obs</a> `N'</span>
<div id="cmd_-284299451" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	set obs `N'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">set</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../tokens/o.html#obs">obs</a> `N'</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="47" title="foreach"><!-- -->
    47</a>&nbsp;<a onclick='toggle("cmd_82513594");' title="foreach">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">foreach</span>
  <span class="cmdparameters"><a href="../variables/variable.html">variable</a></span>
in <span class="cmdin">$VarList {</span>
<div id="cmd_82513594" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	foreach variable in $VarList {</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">foreach</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">in</td>
  <td class="colLast">$VarList {</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../variables/variable.html">variable</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_manipulate rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="48" title="replace"><!-- -->
    48</a>&nbsp;<a onclick='toggle("cmd_-1405155458");' title="replace">[+]</a>
</td>
<td class="colLast" style="padding-left:4em">
 <span class="cmdcommand">replace</span>
  <span class="cmdparameters">`variable' = ``variable''</span>
if <span class="cmdif"><a href="../tokens/_.html#_n">_n</a> == `N'</span>
<div id="cmd_-1405155458" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">		replace `variable' = ``variable'' if _n == `N'</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">replace</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">if</td>
  <td class="colLast"><a href="../tokens/_.html#_n">_n</a> == `N'</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">2</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast">`variable' = ``variable''</td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="49" title="}"><!-- -->
    49</a>&nbsp;<a onclick='toggle("cmd_1841466528");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_1841466528" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_outputcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="50" title="save"><!-- -->
    50</a>&nbsp;<a onclick='toggle("cmd_-1543304808");' title="save">[+]</a>
</td>
<td class="colLast" style="padding-left:2em">
 <span class="cmdcommand">save</span>
  <span class="cmdparameters"><a href="../files/Analysis_Calculations_EPMvsAMT.dta.html">Calculations/EPMvsAMT.dta</a></span>
, <span class="cmdoptions"> <a href="../tokens/r.html#replace">replace</a></span>
<div id="cmd_-1543304808" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">	save Calculations/EPMvsAMT.dta, replace</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">save</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">1</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/r.html#replace">replace</a></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"><a href="../files/Analysis_Calculations_EPMvsAMT.dta.html">Calculations/EPMvsAMT.dta</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_blockcmd altColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="51" title="}"><!-- -->
    51</a>&nbsp;<a onclick='toggle("cmd_1662479365");' title="}">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">}</span>
  <span class="cmdparameters"></span>
<div id="cmd_1662479365" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">}</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="rowColor">
  <td class="colFirst">command</td>
  <td class="colLast">}</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
 <tr class="cmd_outputcmd rowColor">
<td class="colFirst" style="width:30px;text-align:right;">
<a name="54" title="outsheet"><!-- -->
    54</a>&nbsp;<a onclick='toggle("cmd_-933924916");' title="outsheet">[+]</a>
</td>
<td class="colLast" style="padding-left:0em">
 <span class="cmdcommand">outsheet</span>
  <span class="cmdparameters"></span>
using <span class="cmdusing"><a href="../files/Analysis_Output_EPMvsAMT.csv.html">Output/EPMvsAMT.csv</a></span>
, <span class="cmdoptions"> <a href="../tokens/c.html#comma">comma</a> <a href="../tokens/n.html#names">names</a> <a href="../tokens/r.html#replace">replace</a></span>
<div id="cmd_-933924916" style="display:none">
<ul class="blockList">
<li class="blockList">
<pre class="wrap">outsheet using Output/EPMvsAMT.csv, comma names replace</pre>
</li>
</ul>
  <table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties">
  <caption><span><a name="properties"><!-- --></a>All properties</span><span class="tabEnd">&nbsp;</span></caption>
  <tr>
  <th class="colFirst" scope="col">key</th>
  <th class="colLast"  scope="col">content</th>
  </tr>
  <tbody>
       <tr class="altColor">
  <td class="colFirst">command</td>
  <td class="colLast">outsheet</td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">indent</td>
  <td class="colLast">0</td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">options</td>
  <td class="colLast"> <a href="../tokens/c.html#comma">comma</a> <a href="../tokens/n.html#names">names</a> <a href="../tokens/r.html#replace">replace</a></td>
  </tr>
       <tr class="rowColor">
  <td class="colFirst">parameters</td>
  <td class="colLast"></td>
  </tr>
       <tr class="altColor">
  <td class="colFirst">using</td>
  <td class="colLast"><a href="../files/Analysis_Output_EPMvsAMT.csv.html">Output/EPMvsAMT.csv</a></td>
  </tr>
    </tbody>
  </table>
<br>
</br>

</div>
</td>
</tr>
</table>
</li>
</ul>


<a name="content"><!--   --></a>
<!-- ========== CONTENT =========== -->
<ul class="blockList">
<li class="blockList">
<ul class="blockList">
<li class="blockList">
<h3>Content</h3>
<pre>
/* TESSEPMvsCATE.do */

/** @author Allcott and Taubinsky */

/* Set up results storage dataset */
global VarList = "vMax QuantityEffect QuantityEffectse SubsidyEffect SubsidyEffectse DemandSlope DemandSlopese EPM EPMse"
clear
foreach variable in $VarList {
	gen `variable' = . 
}

save Calculations/EPMvsAMT.dta, replace emptyok


/* Estimate EPM function at different points */
*forvalues vMax = 4(-1)-3 { // This code only works for one-dollar increments, otherwise need to code the increment level
foreach vMax in 8 6 4 3 2 1 0 -1 -2 {
*foreach vMax in 0 {
	local subsidy = 1
	if `vMax' >= 6 | `vMax' <= -4 {
		local subsidy = 2
	}
	
	use Calculations/PreppedTESSData.dta, clear
	
	gen PurchaseCFL0 = cond(WTP2>=`vMax',1,0) if WTP2!=.
	gen PurchaseCFL1 = cond(WTP2>=`vMax'-`subsidy',1,0) if WTP2!=.

	keep PurchaseCFL? T EndlineOnly ID Weight // $DemographicVars WTP1_C*  WTP2
	reshape long PurchaseCFL, i(ID) j(Subsidy)

	gen SubsidyxT = Subsidy*T
	gen SubsidyxC = Subsidy*(1-T)
		* Note: The first two variables must be the measure of QuantityEffect and the measure of SubsidyEffect
		* Use average of slopes: this makes some difference - generally makes EPMs smaller
		*reg PurchaseCFL T Subsidy [pweight=Weight], cluster(ID)
		* Exclude EndlineOnly: this makes little difference
		*reg PurchaseCFL T SubsidyxT SubsidyxC [pweight=Weight], cluster(ID), if EndlineOnly==0
	reg PurchaseCFL T Subsidy SubsidyxT [pweight=Weight], cluster(ID)
	
	include Code/GetEPM.do

	** Store results
	use Calculations/EPMvsAMT.dta, clear
	local N = _N+1
	set obs `N'
	foreach variable in $VarList {
		replace `variable' = ``variable'' if _n == `N'
	}
	save Calculations/EPMvsAMT.dta, replace
}


outsheet using Output/EPMvsAMT.csv, comma names replace


</pre>
</li>
</ul>
</li>
</ul>


<ul class="blockList">
<li class="blockList">
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== TOKENS =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Tokens</h3>
<span style="font-size: 8pt;"><a class="tokens" href="../tokens/t.html#TESSEPMvsCATE">TESSEPMvsCATE</a></span>&nbsp;&nbsp;
<span style="font-size: 7pt;"><a class="tokens" href="../files/Analysis_Code_TESSEPMvsCATE.do.html">TESSEPMvsCATE do</a></span>&nbsp;&nbsp;
</li>
</ul>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ========= START OF BOTTOM NAVBAR ========= -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li ><a href="../overview/overview-summary.html"  target="classFrame">Overview</a></li>
<li ><a href="../variables/variables-summary.html"  target="classFrame">Variables</a></li>
<li  class="navBarCell1Rev"><a href="../files/files-summary.html"  target="classFrame">Files</a></li>
<li ><a href="../tokens/tokens-summary.html"  target="classFrame">Tokens</a></li>
<!-- <li><a href="../flows/flow-summary.html"  target="classFrame">Flows</a></li> -->
<li ><a href="../overview/help-doc.html"  target="classFrame">Help</a></li>
<!-- <li class="navBarCell1Rev">Active</li> -->
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>
	<a href="../files/Analysis_Code_TESSDescriptiveStatsandBaselineDemand.do.html" title="Analysis/Code/TESSDescriptiveStatsandBaselineDemand.do">Prev</a>	
	</li>
<li>
    <a href="../files/Analysis_Code_TESSExcessMassTest.do.html" title="Analysis/Code/TESSExcessMassTest.do" >Next</a>   
    </li>
</ul>
<ul class="navList">
<li><a href="../index.html?files/Analysis_Code_TESSEPMvsCATE.do.html" target="_top">Frames</a></li>
<li><a href="../files/Analysis_Code_TESSEPMvsCATE.do.html" target="_top">No Frames</a></li>
</ul>


<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ========= END OF BOTTOM NAVBAR ========= -->
</body>
</html>